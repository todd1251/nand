var NAND=function(b){function f(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}f.prototype.render=function(a){var e=this.model.heavyStrokeWidth,B=this.model.lightStrokeWidth,n=this.model.width/2,g=this.model.height/2,k=this.model.x-n,d=this.model.y-g,m="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(k,d).lineTo(k+n,d).arc(1,1,0,0,1,k+n,d+this.model.height).lineTo(k,d+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":e*(m?.5:1),"stroke-dasharray":m?
"-":""}).drag(b.makeMove(this),b.start,b.up(this));var m=.05*this.model.width,e=k+n+g+m+e/2,g=d+g,n=.2*this.model.height,l=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k,d+n).lineTo(k-l,d+n).toPath(a).attr("stroke-width",B);var h="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-l,d+n,7.5).attr("fill","white").attr("stroke",h);this.labels[0]=a.text(k-l,d+n,this.model.inputs[0]).attr("stroke",h);this.labels[0].node.setAttribute("class",
"intermediate");this.paths[3]=(new b.PathBuilder).moveTo(k,d+this.model.height-n).lineTo(k-l,d+this.model.height-n).toPath(a).attr("stroke-width",B);h="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(k-l,d+this.model.height-n,7.5).attr("fill","white").attr("stroke",h);this.labels[1]=a.text(k-l,d+this.model.height-n,this.model.inputs[1]).attr("stroke",h);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:e+l,y:g};this.outlines[3]=
(new b.PathBuilder).moveTo(e+m,g).lineTo(e+l,g).toPath(a).attr("stroke-width",B);null!=this.model.output&&(h="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(e+l,g,7.5).attr("fill","white").attr("stroke",h),this.labels[2]=a.text(e+l,g,this.model.output).attr("stroke",h),this.labels[2].node.setAttribute("class","intermediate"))};b.AndView=f;return b}(NAND||{});NAND=function(b){function f(a){this.id=a;this.inputs=[];this.outputs=[];this.wires=[]}function a(a,b){this.x=a;this.y=b}function e(){this.grid=[];this.height=this.width=0}f.prototype.traverse=function(a){this.inputs.map(function(b,g){b.traverse(a,g,0)})};f.prototype.layout=function(a,n){var g=null,k=null;this.traverse(function(a,b,d){if(null==g||b>g)g=b;if(null==k||d>k)k=d});var d=[];this.traverse(function(a,b,e){a.seen||(a.seen=!0,d.push({node:a,row:b,column:e,dx:0,dy:0}))});for(var m=0,l=0;l<d.length;l++){var h=
d[l],e=h.node;h.row+=m;if(null!=e.inputs){var f=function(a){if(null!=a)for(var b=0;b<d.length;b++){var e=d[b];if(e.node.id==a.id)return e}return null},p=f(e.inputs[0]),e=f(e.inputs[1]);null!=p&&null!=e?(h.row=Math.round((p.row+e.row)/2),m++):null!=p&&null==e&&(h.row=p.row)}}for(e=!0;e;)for(e=!1,m=[],l=0;l<d.length;l++){h=d[l];for(p=0;p<m.length;p++)if(m[p].row==h.row&&m[p].column==h.column&&m[p].node.id!=h.node.id){h.column++;e=!0;break}if(e)break;m.push(h)}for(var q=this,t=[],l=0;l<d.length;l++){h=
d[l];e=h.node;m=null;switch(e.kind){case "source":p={viewModel:h,value:h.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();n(q,t,k)}};m=new b.SourceView(e,p);h.options=p;break;case "sink":p={viewModel:h,value:e.evaluate()?"1":"0"};m=new b.SinkView(p);h.options=p;break;case "delay":m=new b.DelayView({viewModel:h});break;case "fanout":m=new b.FanOutView({viewModel:h,node:e});break;case "gate":p={viewModel:h,id:e.id,width:60,height:40,heavyStrokeWidth:2,
lightStrokeWidth:1.25,inputs:"not"==e.gate?[e.inputs[0].evaluate()?"1":"0"]:[e.inputs[0].evaluate()?"1":"0",e.inputs[1].evaluate()?"1":"0"],output:e.evaluate()?"1":"0"};h.options=p;switch(e.gate){case "not":m=new b.GateView(new b.NotView(p));break;case "nand":m=new b.NandView(p);break;case "and":m=new b.GateView(new b.AndView(p));break;case "nor":m=new b.NorView(p);break;case "or":m=new b.OrView(p);break;case "xor":m=new b.GateView(new b.XorView(p));break;default:throw"gate";}break;default:throw"kind";
}null!=m&&t.push({node:e,view:m})}f=p=null;for(l=0;l<t.length;l++){m=t[l].view;h=m.bounds();if(null==p||h.width>p)p=h.width;if(null==f||h.height>f)f=h.height}var p=p+10,f=f+10,u=a.width/2-(k-1)*p/2,v=a.height/2-(g-1)*f/2;this.dx=p;this.dy=f;this.cx=u;this.cy=v;for(l=0;l<t.length;l++)e=t[l].node,m=t[l].view,h=m.model.viewModel,e=v+h.row*f,m.model.x=u+h.column*p,m.model.y=e,m.render(a);this.models=d;this.layoutWires(a);return{nodeViews:t,maxDepth:k}};f.prototype.layoutWires=function(a){for(var e=0;e<
this.wires.length;e++)this.wires[e].remove();this.wires=[];for(var g=this.dx,k=this.dy,d=this.cx,m=this.cy,l=this,e=0;e<this.models.length;e++){var h=this.models[e],f=h.node;null!=f.outputs&&f.outputs.map(function(e,n){for(var q=[],t=0;t<l.models.length;t++){var u=l.models[t];u.node.id==e.id&&q.push(u)}if(1!=q.length)throw console.log(q),"outputs";var q=q[0],v=h.options?h.options.x+h.dx:d+h.column*g,x=h.options?h.options.y+h.dy:m+h.row*k,y=q.options?q.options.x+q.dx:d+q.column*g,w=q.options?q.options.y+
q.dy:m+q.row*k,t="gate"==q.node.kind?-48:0,u="gate"==q.node.kind?-5:0,C="gate"==q.node.kind?-48:0,z="gate"==q.node.kind?-12:0;"fanout"==f.kind&&0<n?e.inputs.map(function(e,d){e.id==f.id&&l.wires.push((new b.PathBuilder).moveTo(v,x).lineTo(v+(0==d?20:0),x).lineTo(v+(0==d?20:0),0==d?w+z:w-z).lineTo(y+C,0==d?w+z:w-z).toPath(a).toBack())}):l.wires.push((new b.PathBuilder).moveTo(v,x).lineTo(y+t,x).lineTo(y+t,w<x?w-u:w+u).toPath(a).toBack())})}};f.prototype.layout2=function(a,e){function g(a){for(var b=
0;b<h.length;b++)if(h[b].node.id==a.id)return h[b];throw"node";}var k=a.width/2,d=a.height/2;c.Expression.fromConstant(0);c.Expression.fromConstant(0);c.Expression.fromConstant(a.width);c.Expression.fromConstant(a.height);var m=[],l=0,h=[],f=null;this.traverse(function(a,b,e){a.seen||(a.seen=!0,a={node:a,dx:0,dy:0,constraints:{x:new c.Variable({name:a.kind+a.id+".x"}),y:new c.Variable({name:a.kind+a.id+".y"})}},h.push(a));if(null==l||e>l)l=e});var r=new c.SimplexSolver;h.map(function(a){var b=a.node.inputs;
if(null!=b&&0<b.length){for(var e=0;e<b.length;e++){var d=g(b[e]);r.addConstraint(new c.Inequality(c.plus(d.constraints.x,110),c.LEQ,a.constraints.x));if(0<e){var h=g(b[e-1]);r.addConstraint(new c.Inequality(c.plus(h.constraints.y,80),c.LEQ,d.constraints.y))}}e=g(b[0]);1==b.length?r.addConstraint(new c.Equation(a.constraints.y,e.constraints.y)):(b=g(b[b.length-1]),b=c.plus(c.divide(c.minus(b.constraints.y,e.constraints.y),2),e.constraints.y),r.addConstraint(new c.Equation(a.constraints.y,b)))}else r.addConstraint(new c.Equation(a.constraints.x,
0))});f=null;this.inputs.map(function(a){a=g(a);null!=f&&r.addConstraint(new c.Inequality(c.plus(f.constraints.y,30),c.LEQ,a.constraints.y));f=a});r.solve();for(var p=null,q=null,t=null,u=null,v=0;v<h.length;v++){var x=h[v],y=x.constraints.x.value,w=x.constraints.y.value;if(null==p||y<p)p=y;if(null==q||w<q)q=w;if(null==t||y>t)t=y;if(null==u||w>u)u=w;for(var C=v+1;C<h.length;C++){var z=h[C],p=z.constraints.x.value,q=z.constraints.y.value;p==y&&q==w&&(console.log("conflict between "+x.node.id+" and "+
z.node.id),z.constraints.y.value+=80)}}var p=k-(t+p)/2,q=d-(u+q)/2,D=this;h.map(function(d){var h=d.node,k=d.constraints,g=null;switch(h.kind){case "source":d.options={viewModel:d,value:d.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();e(D,m,l)},x:p+k.x.value,y:q+k.y.value};g=new b.SourceView(h,d.options);break;case "gate":d.options={viewModel:d,id:h.id,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:[h.inputs[0].evaluate()?
"1":"0",h.inputs[1].evaluate()?"1":"0"],output:h.evaluate()?"1":"0",x:p+k.x.value,y:q+k.y.value};g=new b.GateView(new b.NandView(d.options));switch(h.gate){case "not":g=new b.GateView(new b.NotView(d.options));break;case "nand":g=new b.GateView(new b.NandView(d.options));break;case "and":g=new b.GateView(new b.AndView(d.options));break;case "nor":g=new b.GateView(new b.NorView(d.options));break;case "or":g=new b.GateView(new b.OrView(d.options));break;case "xor":g=new b.GateView(new b.XorView(d.options));
break;default:throw"gate";}break;case "sink":d.options={viewModel:d,value:h.evaluate()?"1":"0",x:p+k.x.value,y:q+k.y.value};g=new b.SinkView(d.options);break;case "fanout":d.options={viewModel:d,x:p+k.x.value,y:q+k.y.value};g=new b.FanOutView(d.options);break;default:throw"kind";}null!=g&&(g.render(a),m.push({node:h,view:g}))});this.models=h;this.layoutWires(a);return{nodeViews:m,maxDepth:l}};e.prototype.place=function(b,e){b>this.width-1&&(this.width=b+1);e>this.height-1&&(this.height=e+1);for(var g=
0;g<this.grid.length;g++)for(;this.grid[g].length<this.width;)this.grid[g].push(null);for(;this.grid.length<this.height;){for(g=[];g.length<this.width;)g.push(null);this.grid.push(g)}if(null==this.grid[e][b])this.grid[e][b]=new a(b,e);else{if(e+1>=this.height||null==this.grid[e+1][b])return this.place(b,e+1);for(g=[];g.length<this.width;)g.push(null);this.grid.splice(e,0,g);this.grid[e][b]=new a(b,e);this.height++;for(var k=0;k<this.height;k++)for(g=0;g<this.width;g++){var d=this.grid[k][g];null!=
d&&(d.x=g,d.y=k)}}return this.grid[e][b]};f.prototype.layout3=function(a,f){var g=a.width/2,k=a.height/2,d=[],m=0,l=[];this.traverse(function(a,b,e){if(a.seen){a:{for(var d=0;d<l.length;d++)if(l[d].node.id==a.id){a=l[d];break a}throw"node";}if(e>a.depth||b>a.breadth)a.depth=e,a.breadth=b}else a.seen=!0,a={node:a,dx:0,dy:0,depth:e,breadth:b},l.push(a);if(null==m||e>m)m=e});var h=new e;l.map(function(a){a.location=h.place(a.depth,a.breadth)});l.map(function(a){a.x=120*a.location.x;a.y=100*a.location.y});
for(var A=null,r=null,p=0;p<l.length;p++){var q=l[p],t=q.x,q=q.y;if(null==A||t>A)A=t;if(null==r||q>r)r=q}var u=g-A/2,v=k-r/2,x=this;l.map(function(e){var h=e.node,g=null;switch(h.kind){case "source":e.options={viewModel:e,value:e.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();f(x,d,m)},x:u+e.x,y:v+e.y};g=new b.SourceView(h,e.options);break;case "gate":e.options={viewModel:e,id:h.id,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,
inputs:[h.inputs[0].evaluate()?"1":"0",h.inputs[1].evaluate()?"1":"0"],output:h.evaluate()?"1":"0",x:u+e.x,y:v+e.y};g=new b.GateView(new b.NandView(e.options));switch(h.gate){case "not":g=new b.GateView(new b.NotView(e.options));break;case "nand":g=new b.GateView(new b.NandView(e.options));break;case "and":g=new b.GateView(new b.AndView(e.options));break;case "nor":g=new b.GateView(new b.NorView(e.options));break;case "or":g=new b.GateView(new b.OrView(e.options));break;case "xor":g=new b.GateView(new b.XorView(e.options));
break;default:throw"gate";}break;case "sink":e.options={viewModel:e,value:h.evaluate()?"1":"0",x:u+e.x,y:v+e.y};g=new b.SinkView(e.options);break;case "fanout":e.options={viewModel:e,x:u+e.x,y:v+e.y};g=new b.FanOutView(e.options);break;default:throw"kind";}null!=g&&(g.render(a),d.push({node:h,view:g}))});this.models=l;this.layoutWires(a);return{nodeViews:d,maxDepth:m}};b.Circuit=f;return b}(NAND||{});NAND=function(b){function f(a){this.id=a;this.kind="delay";this.inputs=[];this.outputs=[]}f.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};f.prototype.traverse=function(a,b,f){a(this,b,f);this.outputs.map(function(n){n.traverse(a,b,f+1)})};f.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.Delay=f;return b}(NAND||{});NAND=function(b){function f(a){this.model=a}f.prototype.render=function(a){};b.DelayView=f;return b}(NAND||{});NAND=function(b){function f(a){this.id=a;this.kind="fanout";this.inputs=[];this.outputs=[]}f.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};f.prototype.traverse=function(a,b,f){a(this,b,f);this.outputs.map(function(n){n.traverse(a,b,f+1)})};f.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.FanOut=f;return b}(NAND||{});NAND=function(b){function f(a){this.model=a}f.prototype.render=function(a){};f.prototype.bounds=function(){return{width:10,height:10}};b.FanOutView=f;return b}(NAND||{});NAND=function(b){function f(a,b,f){this.id=a;this.kind="gate";this.gate=b;this.logic=f;this.inputs=[];this.outputs=[]}f.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};f.prototype.traverse=function(a,b,f){a(this,b,f);this.outputs.map(function(n){n.traverse(a,b,f+1)})};f.prototype.evaluate=function(){if("not"==this.gate&&1!=this.inputs.length||"not"!=this.gate&&2>this.inputs.length)throw"inputs";var a=[];this.inputs.map(function(b){a.push(b.evaluate())});return this.logic(a)};
b.Gate=f;return b}(NAND||{});NAND=function(b){function f(a){this.delegate=a;this.model=a.model}f.prototype.render=function(a){this.delegate.render(a)};f.prototype.update=function(){for(var a=this.delegate.model.inputs,b=this.delegate.model.output,f=this.delegate.labels,n=this.delegate.outlines,g=this.delegate.paths,k="?"==a[0],d=0;d<a.length;d++){var m="?"==a[d]?"black":"0"==a[d]?"#a00":"#0a0";f[d].attr("text",a[d]).attr("stroke",m);n[d].attr("stroke",m)}f[a.length].attr("text",b).attr("stroke","?"==b?"black":"0"==b?"#a00":"#0a0");
n[a.length].attr("stroke","?"==b?"black":"0"==b?"#a00":"#0a0");for(d=0;d<g.length;d++)null!=g[d]&&g[d].attr("stroke-dasharray",k?"-":"")};f.prototype.bounds=function(){return{width:1.4*this.delegate.model.width,height:1.1*this.delegate.model.height}};b.GateView=f;return b}(NAND||{});NAND=function(b){function f(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}f.prototype.render=function(a){var e=this.model.heavyStrokeWidth,f=this.model.lightStrokeWidth,n=this.model.width/2,g=this.model.height/2,k=this.model.x-n,d=this.model.y-g,m="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(k,d).lineTo(k+n,d).arc(1,1,0,0,1,k+n,d+this.model.height).lineTo(k,d+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":e*(m?.5:1),"stroke-dasharray":m?
"-":""}).drag(b.makeMove(this),b.start,b.up(this));var l=.05*this.model.width,e=k+n+g+l+e/2,g=d+g;this.paths[1]=a.circle(e,g,l).attr({fill:"white","stroke-width":f*(m?.5:1),"stroke-dasharray":m?"-":""});m=.2*this.model.height;n=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k,d+m).lineTo(k-n,d+m).toPath(a).attr("stroke-width",f);var h="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-n,d+m,7.5).attr("fill","white").attr("stroke",h);
this.labels[0]=a.text(k-n,d+m,this.model.inputs[0]).attr("stroke",h);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(k,d+this.model.height-m).lineTo(k-n,d+this.model.height-m).toPath(a).attr("stroke-width",f);h="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(k-n,d+this.model.height-m,7.5).attr("fill","white").attr("stroke",h);this.labels[1]=a.text(k-n,d+this.model.height-m,this.model.inputs[1]).attr("stroke",
h);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:e+n,y:g};this.paths[4]=(new b.PathBuilder).moveTo(e+l,g).lineTo(e+n,g).toPath(a).attr("stroke-width",f);null!=this.model.output&&(h="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(e+n,g,7.5).attr("fill","white").attr("stroke",h),this.labels[2]=a.text(e+n,g,this.model.output).attr("stroke",h),this.labels[2].node.setAttribute("class","intermediate"))};b.NandView=f;return b}(NAND||
{});NAND=function(b){function f(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}f.prototype.render=function(a){var e=this.model.heavyStrokeWidth,f=this.model.lightStrokeWidth,n=this.model.width/2,g=this.model.height/2,k=this.model.x-n,d=this.model.y-g,m="?"==this.model.inputs[0],l=.4*this.model.width,h=2*this.model.width/3,A=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(k,d).lineTo(k+l,d).arc(h,h,0,0,1,k+this.model.width-A,d+g).arc(h,h,0,0,1,k+l,d+this.model.height).lineTo(k,
d+this.model.height).toPath(a).attr({fill:"white","stroke-width":e*(m?.5:1),"stroke-dasharray":m?"-":""});this.paths[1]=(new b.PathBuilder).moveTo(k,d).arc(l,l,0,0,1,k,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":e*(m?.5:1),"stroke-dasharray":m?"-":""});l=.05*this.model.width;e=k+n+g+l+e/2;g=d+g;a.circle(e,g,l).attr({fill:"white","stroke-width":f*(m?.5:1),"stroke-dasharray":m?"-":""});m=.2*this.model.height;n=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k+n-1-.5*
n,d+m).lineTo(k-n,d+m).toPath(a).attr("stroke-width",f);h="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-n,d+m,7.5).attr("fill","white").attr("stroke",h);this.labels[0]=a.text(k-n,d+m,this.model.inputs[0]).attr("stroke",h);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(k+n-1-.5*n,d+this.model.height-m).lineTo(k-n,d+this.model.height-m).toPath(a).attr("stroke-width",f);h="?"==this.model.inputs[1]?
"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(k-n,d+this.model.height-m,7.5).attr("fill","white").attr("stroke",h);this.labels[1]=a.text(k-n,d+this.model.height-m,this.model.inputs[1]).attr("stroke",h);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:e+n,y:g};(new b.PathBuilder).moveTo(e+l,g).lineTo(e+n,g).toPath(a).attr("stroke-width",f);null!=this.model.output&&(h="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=
a.circle(e+n,g,7.5).attr("fill","white").attr("stroke",h),this.labels[2]=a.text(e+n,g,this.model.output).attr("stroke",h),this.labels[2].node.setAttribute("class","intermediate"))};f.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",
a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.NorView=f;return b}(NAND||{});NAND=function(b){function f(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}f.prototype.render=function(a){var e=this.model.heavyStrokeWidth,f=this.model.lightStrokeWidth,n=this.model.width/2,g=this.model.height/2,k=this.model.x-n,d=this.model.y-g,m="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(k,d).lineTo(k+this.model.width-20,d+g).lineTo(k,d+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":e*(m?.5:1),"stroke-dasharray":m?"-":""}).drag(b.makeMove(this),
b.start,b.up(this));var l=.05*this.model.width,e=k+n+g+l+e/2-11,n=d+g;this.paths[1]=a.circle(e,n,l).attr({fill:"white","stroke-width":f*(m?.5:1),"stroke-dasharray":m?"-":""});m=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k,d+g).lineTo(k-m,d+g).toPath(a).attr("stroke-width",f);var h="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-m,d+g,7.5).attr("fill","white").attr("stroke",h);this.labels[0]=a.text(k-m,d+g,this.model.inputs[0]).attr("stroke",
h);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(e+l,n).lineTo(e+m,n).toPath(a).attr("stroke-width",f);null!=this.model.output&&(h="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[1]=a.circle(e+m,n,7.5).attr("fill","white").attr("stroke",h),this.labels[1]=a.text(e+m,n,this.model.output).attr("stroke",h),this.labels[1].node.setAttribute("class","intermediate"))};b.NotView=f;return b}(NAND||{});NAND=function(b){function f(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}f.prototype.render=function(a){var e=this.model.heavyStrokeWidth,f=this.model.lightStrokeWidth,n=this.model.width/2,g=this.model.height/2,k=this.model.x-n,d=this.model.y-g,m="?"==this.model.inputs[0],l=.4*this.model.width,h=2*this.model.width/3,A=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(k,d).lineTo(k+l,d).arc(h,h,0,0,1,k+this.model.width-A,d+g).arc(h,h,0,0,1,k+l,d+this.model.height).lineTo(k,
d+this.model.height).toPath(a).attr({fill:"white","stroke-width":e*(m?.5:1),"stroke-dasharray":m?"-":""}).drag(b.makeMove(this),b.start,b.up(this));this.paths[1]=(new b.PathBuilder).moveTo(k,d).arc(l,l,0,0,1,k,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":e*(m?.5:1),"stroke-dasharray":m?"-":""});m=.05*this.model.width;e=k+n+g+m+e/2;g=d+g;n=.2*this.model.height;l=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k+l-1-.5*l,d+n).lineTo(k-l,d+n).toPath(a).attr("stroke-width",
f);h="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-l,d+n,7.5).attr("fill","white").attr("stroke",h);this.labels[0]=a.text(k-l,d+n,this.model.inputs[0]).attr("stroke",h);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(k+l-1-.5*l,d+this.model.height-n).lineTo(k-l,d+this.model.height-n).toPath(a).attr("stroke-width",f);h="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=
a.circle(k-l,d+this.model.height-n,7.5).attr("fill","white").attr("stroke",h);this.labels[1]=a.text(k-l,d+this.model.height-n,this.model.inputs[1]).attr("stroke",h);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:e+l,y:g};this.outlines[3]=(new b.PathBuilder).moveTo(e+m,g).lineTo(e+l,g).toPath(a).attr("stroke-width",f);null!=this.model.output&&(h="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(e+l,g,7.5).attr("fill","white").attr("stroke",
h),this.labels[2]=a.text(e+l,g,this.model.output).attr("stroke",h),this.labels[2].node.setAttribute("class","intermediate"))};f.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",
a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.OrView=f;return b}(NAND||{});NAND=function(b){function f(){this.commands=[]}f.prototype.moveTo=function(a,b){this.commands.push("M"+a+","+b);return this};f.prototype.lineTo=function(a,b){this.commands.push("L"+a+","+b);return this};f.prototype.arc=function(a,b,f,n,g,k,d){this.commands.push("A"+a+","+b+" "+f+" "+n+" "+g+" "+k+","+d);return this};f.prototype.close=function(){this.commands.push("Z");return this};f.prototype.toPath=function(a){return a.path(this.commands.join(" "))};b.PathBuilder=f;return b}(NAND||{});NAND=function(b){function f(a){this.id=a;this.kind="sink";this.inputs=[]}f.prototype.connect=function(a){this.inputs.push(a);a.outputs.push(this)};f.prototype.traverse=function(a,b,f){a(this,b,f)};f.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.Sink=f;return b}(NAND||{});NAND=function(b){function f(a){this.model=a;this.paths=[];this.outlines=[];this.labels=[]}f.prototype.render=function(a){var e=this.model.value,f=this.model.x,n=this.model.y,g="?"==e?"black":"0"==e?"#a00":"#0a0";this.outlines[0]=a.rect(f-7,n-7,14,14).attr("stroke",g).attr("fill","white").drag(b.makeMove(this),b.start,b.up(this));this.labels[0]=a.text(f,n,e).attr("stroke",g).drag(b.makeMove(this),b.start,b.up(this));this.labels[0].node.setAttribute("class","output")};f.prototype.update=function(){var a=
this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};f.prototype.bounds=function(){return{width:14,height:14}};b.SinkView=f;return b}(NAND||{});NAND=function(b){function f(a,b){this.id=a;this.kind="source";this.value=b;this.outputs=[]}f.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};f.prototype.traverse=function(a,b,f){a(this,b,f);this.outputs.map(function(n){n.traverse(a,b,f+1)})};f.prototype.evaluate=function(){return this.value};f.prototype.toggle=function(){this.value=!this.value};b.Source=f;return b}(NAND||{});NAND=function(b){function f(a,b){this.node=a;this.model=b;this.paths=[];this.labels=[];this.outlines=[]}f.prototype.render=function(a){var e=this.model.value,f=this.model.x,n=this.model.y,g="?"==e?"black":"0"==e?"#a00":"#0a0";this.outlines[0]=a.rect(f-7,n-7,14,14).attr("stroke",g).attr("fill","white").drag(b.makeMove(this),b.start,b.up(this));this.labels[0]=a.text(f,n,e).attr("stroke",g).click(this.model.click.bind(this)).drag(b.makeMove(this),b.start,b.up(this));this.labels[0].node.setAttribute("class",
"input")};f.prototype.update=function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};f.prototype.bounds=function(){return{width:14,height:14}};b.SourceView=f;return b}(NAND||{});NAND=function(b){function f(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}f.prototype.render=function(a){var e=this.model.heavyStrokeWidth,f=this.model.lightStrokeWidth,n=this.model.width/2,g=this.model.height/2,k=this.model.x-n,d=this.model.y-g,m="?"==this.model.inputs[0],l=.4*this.model.width,h=2*this.model.width/3,A=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(k,d).lineTo(k+l,d).arc(h,h,0,0,1,k+this.model.width-A,d+g).arc(h,h,0,0,1,k+l,d+this.model.height).lineTo(k,
d+this.model.height).toPath(a).attr({fill:"white","stroke-width":e*(m?.5:1),"stroke-dasharray":m?"-":""}).drag(b.makeMove(this),b.start,b.up(this));this.paths[1]=(new b.PathBuilder).moveTo(k,d).arc(l,l,0,0,1,k,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":e*(m?.5:1),"stroke-dasharray":m?"-":""});this.paths[2]=(new b.PathBuilder).moveTo(k-5,d).arc(l,l,0,0,1,k-5,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":e*(m?.5:1),"stroke-dasharray":m?"-":""});m=.05*this.model.width;
e=k+n+g+m+e/2;g=d+g;n=.2*this.model.height;l=.3*this.model.width;this.paths[3]=(new b.PathBuilder).moveTo(k+l-1-.5*l,d+n).lineTo(k-l,d+n).toPath(a).attr("stroke-width",f);h="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-l,d+n,7.5).attr("fill","white").attr("stroke",h);this.labels[0]=a.text(k-l,d+n,this.model.inputs[0]).attr("stroke",h);this.labels[0].node.setAttribute("class","intermediate");this.paths[4]=(new b.PathBuilder).moveTo(k+l-1-.5*l,
d+this.model.height-n).lineTo(k-l,d+this.model.height-n).toPath(a).attr("stroke-width",f);h="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(k-l,d+this.model.height-n,7.5).attr("fill","white").attr("stroke",h);this.labels[1]=a.text(k-l,d+this.model.height-n,this.model.inputs[1]).attr("stroke",h);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:e+l,y:g};this.outlines[3]=(new b.PathBuilder).moveTo(e+m,g).lineTo(e+l,g).toPath(a).attr("stroke-width",
f);null!=this.model.output&&(h="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(e+l,g,7.5).attr("fill","white").attr("stroke",h),this.labels[2]=a.text(e+l,g,this.model.output).attr("stroke",h),this.labels[2].node.setAttribute("class","intermediate"))};b.XorView=f;return b}(NAND||{});NAND=function(b){function f(a){return!a.reduce(function(a,b){return a&&b})}function a(a){return a.reduce(function(a,b){return a&&b})}function e(a){return a.reduce(function(a,b){return a^b})}function B(a,b,e){0>d?d=0:d>=e&&(d=e-1);a.traverse(function(a,f,h){b.map(function(b){var f=b.node,g=b.view;if(f.id==a.id){var k=h>d;switch(f.kind){case "gate":f.inputs.map(function(a,b){g.model.inputs[b]=k?"?":a.evaluate()?"1":"0"});g.model.output=k?"?":f.evaluate()?"1":"0";g.update();break;case "sink":g.model.value=
d<e-1?"?":f.evaluate()?"1":"0",g.update()}}})});document.getElementById("time").textContent="t = "+d}function n(n){g=new Raphael(0,0,window.innerWidth,window.innerHeight);var r=document.getElementById("controls");r.style.left=g.width/2-r.clientWidth/2+"px";r.style.top=g.height/2-r.clientHeight/2-200+"px";var r=0,p=new b.Source(r++,!1),q=new b.Source(r++,!1);new b.Source(r++,!1);var t=new b.Sink(r++),u=new b.Sink(r++);new b.Sink(r++);new b.Delay(r++);new b.Delay(r++);new b.Delay(r++);var v=new b.FanOut(r++),
x=new b.FanOut(r++),y=new b.FanOut(r++);new b.Gate(r++,"xor",e);new b.Gate(r++,"and",a);var w=new b.Gate(r++,"nand",f),C=new b.Gate(r++,"nand",f),z=new b.Gate(r++,"nand",f),D=new b.Gate(r++,"nand",f),F=new b.Gate(r++,"nand",f);k=new b.Circuit(r++);p.connect(v);q.connect(x);v.connect(C);v.connect(w);x.connect(w);x.connect(z);w.connect(y);y.connect(C);y.connect(z);y.connect(F);y.connect(F);C.connect(D);z.connect(D);D.connect(t);F.connect(u);k.inputs=[p,q];k.outputs=[t,u];m=k.layout3(g,B);h=m.nodeViews;
l=m.maxDepth;d=l-1;B(k,h,l);var E=document.getElementById("slider");E.max=l-1;E.value=d;n&&(document.getElementById("forward").addEventListener("click",function(){d++;B(k,h,l);E.value=d},!1),document.getElementById("backward").addEventListener("click",function(){d--;B(k,h,l);E.value=d},!1),document.getElementById("slider").addEventListener("input",function(){d=this.value;B(k,h,l);E.value=d}))}var g,k;b.makeMove=function(a){return function(b,e){for(var d=0;d<a.paths.length;d++){var f=a.paths[d];null!=
f&&f.translate(b-this.tx,e-this.ty)}for(d=0;d<a.labels.length;d++)f=a.labels[d],null!=f&&f.translate(b-this.tx,e-this.ty);for(d=0;d<a.outlines.length;d++)f=a.outlines[d],null!=f&&f.translate(b-this.tx,e-this.ty);this.tx=b;this.ty=e;a.model.viewModel.dx=b;a.model.viewModel.dy=e;k.layoutWires(g)}};b.start=function(){this.ty=this.tx=0};b.up=function(a){return function(){a.model.x+=a.model.viewModel.dx;a.model.y+=a.model.viewModel.dy;a.model.viewModel.dx=0;a.model.viewModel.dy=0}};var d=0,m,l,h;window.addEventListener("load",
function(){n(!0)});window.addEventListener("resize",function(){g.clear();n(!1)});return b}(NAND||{});
