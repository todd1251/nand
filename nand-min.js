var NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var n=this.model.heavyStrokeWidth,t=this.model.lightStrokeWidth,g=this.model.width/2,m=this.model.height/2,k=this.model.x-g,e=this.model.y-m,l="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(k,e).lineTo(k+g,e).arc(1,1,0,0,1,k+g,e+this.model.height).lineTo(k,e+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":n*(l?.5:1),"stroke-dasharray":l?
"-":""}).drag(b.makeMove(this),b.start,b.up(this));var l=.05*this.model.width,n=k+g+m+l+n/2,m=e+m,g=.2*this.model.height,h=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k,e+g).lineTo(k-h,e+g).toPath(a).attr("stroke-width",t);var f="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-h,e+g,7.5).attr("fill","white").attr("stroke",f);this.labels[0]=a.text(k-h,e+g,this.model.inputs[0]).attr("stroke",f);this.labels[0].node.setAttribute("class",
"intermediate");this.paths[3]=(new b.PathBuilder).moveTo(k,e+this.model.height-g).lineTo(k-h,e+this.model.height-g).toPath(a).attr("stroke-width",t);f="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(k-h,e+this.model.height-g,7.5).attr("fill","white").attr("stroke",f);this.labels[1]=a.text(k-h,e+this.model.height-g,this.model.inputs[1]).attr("stroke",f);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:n+h,y:m};this.outlines[3]=
(new b.PathBuilder).moveTo(n+l,m).lineTo(n+h,m).toPath(a).attr("stroke-width",t);null!=this.model.output&&(f="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(n+h,m,7.5).attr("fill","white").attr("stroke",f),this.labels[2]=a.text(n+h,m,this.model.output).attr("stroke",f),this.labels[2].node.setAttribute("class","intermediate"))};b.AndView=d;return b}(NAND||{});NAND=function(b){function d(a){this.id=a;this.inputs=[];this.outputs=[];this.wires=[]}function a(a,b){this.x=a;this.y=b}function n(){this.grid=[];this.height=this.width=0}d.prototype.traverse=function(a){this.inputs.map(function(b,n){b.traverse(a,n,0)})};d.prototype.layout=function(a,g){var n=null,k=null;this.traverse(function(a,b,e){if(null==n||b>n)n=b;if(null==k||e>k)k=e});var e=[];this.traverse(function(a,b,g){a.seen||(a.seen=!0,e.push({node:a,row:b,column:g,dx:0,dy:0}))});for(var l=0,h=0;h<e.length;h++){var f=
e[h],d=f.node;f.row+=l;if(null!=d.inputs){var q=function(a){if(null!=a)for(var b=0;b<e.length;b++){var g=e[b];if(g.node.id==a.id)return g}return null},p=q(d.inputs[0]),d=q(d.inputs[1]);null!=p&&null!=d?(f.row=Math.round((p.row+d.row)/2),l++):null!=p&&null==d&&(f.row=p.row)}}for(d=!0;d;)for(d=!1,l=[],h=0;h<e.length;h++){f=e[h];for(p=0;p<l.length;p++)if(l[p].row==f.row&&l[p].column==f.column&&l[p].node.id!=f.node.id){f.column++;d=!0;break}if(d)break;l.push(f)}for(var r=this,u=[],h=0;h<e.length;h++){f=
e[h];d=f.node;l=null;switch(d.kind){case "source":p={viewModel:f,value:f.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();g(r,u,k)}};l=new b.SourceView(d,p);f.options=p;break;case "sink":p={viewModel:f,value:d.evaluate()?"1":"0"};l=new b.SinkView(p);f.options=p;break;case "delay":l=new b.DelayView({viewModel:f});break;case "fanout":l=new b.FanOutView({viewModel:f,node:d});break;case "gate":p={viewModel:f,id:d.id,width:60,height:40,heavyStrokeWidth:2,
lightStrokeWidth:1.25,inputs:"not"==d.gate?[d.inputs[0].evaluate()?"1":"0"]:[d.inputs[0].evaluate()?"1":"0",d.inputs[1].evaluate()?"1":"0"],output:d.evaluate()?"1":"0"};f.options=p;switch(d.gate){case "not":l=new b.GateView(new b.NotView(p));break;case "nand":l=new b.NandView(p);break;case "and":l=new b.GateView(new b.AndView(p));break;case "nor":l=new b.NorView(p);break;case "or":l=new b.OrView(p);break;case "xor":l=new b.GateView(new b.XorView(p));break;default:throw"gate";}break;default:throw"kind";
}null!=l&&u.push({node:d,view:l})}q=p=null;for(h=0;h<u.length;h++){l=u[h].view;f=l.bounds();if(null==p||f.width>p)p=f.width;if(null==q||f.height>q)q=f.height}var p=p+10,q=q+10,v=a.width/2-(k-1)*p/2,w=a.height/2-(n-1)*q/2;this.dx=p;this.dy=q;this.cx=v;this.cy=w;for(h=0;h<u.length;h++)d=u[h].node,l=u[h].view,f=l.model.viewModel,d=w+f.row*q,l.model.x=v+f.column*p,l.model.y=d,l.render(a);this.models=e;this.layoutWires(a);return{nodeViews:u,maxDepth:k}};d.prototype.layoutWires=function(a){for(var g=0;g<
this.wires.length;g++)this.wires[g].remove();this.wires=[];for(var n=this.dx,k=this.dy,e=this.cx,d=this.cy,h=this,g=0;g<this.models.length;g++){var f=this.models[g],x=f.node;null!=x.outputs&&x.outputs.map(function(g,p){for(var r=[],u=0;u<h.models.length;u++){var v=h.models[u];v.node.id==g.id&&r.push(v)}if(1!=r.length)throw console.log(r),"outputs";var r=r[0],w=f.options?f.options.x+f.dx:e+f.column*n,z=f.options?f.options.y+f.dy:d+f.row*k,A=r.options?r.options.x+r.dx:e+r.column*n,y=r.options?r.options.y+
r.dy:d+r.row*k,u="gate"==r.node.kind?-48:0,v="gate"==r.node.kind?-5:0,B="gate"==r.node.kind?-48:0,C="gate"==r.node.kind?-12:0;"fanout"==x.kind&&0<p?g.inputs.map(function(e,g){e.id==x.id&&h.wires.push((new b.PathBuilder).moveTo(w,z).lineTo(w+(0==g?20:0),z).lineTo(w+(0==g?20:0),0==g?y+C:y-C).lineTo(A+B,0==g?y+C:y-C).toPath(a).toBack())}):h.wires.push((new b.PathBuilder).moveTo(w,z).lineTo(A+u,z).lineTo(A+u,y<z?y-v:y+v).toPath(a).toBack())})}};d.prototype.layout2=function(a,g){function n(a){for(var b=
0;b<f.length;b++)if(f[b].node.id==a.id)return f[b];throw"node";}var d=a.width/2,e=a.height/2;c.Expression.fromConstant(0);c.Expression.fromConstant(0);c.Expression.fromConstant(a.width);c.Expression.fromConstant(a.height);var l=[],h=0,f=[],x=null;this.traverse(function(a,b,e){a.seen||(a.seen=!0,a={node:a,dx:0,dy:0,constraints:{x:new c.Variable({name:a.kind+a.id+".x"}),y:new c.Variable({name:a.kind+a.id+".y"})}},f.push(a));if(null==h||e>h)h=e});var q=new c.SimplexSolver;f.map(function(a){var b=a.node.inputs;
if(null!=b&&0<b.length){for(var e=0;e<b.length;e++){var g=n(b[e]);q.addConstraint(new c.Inequality(c.plus(g.constraints.x,110),c.LEQ,a.constraints.x));if(0<e){var f=n(b[e-1]);q.addConstraint(new c.Inequality(c.plus(f.constraints.y,80),c.LEQ,g.constraints.y))}}e=n(b[0]);1==b.length?q.addConstraint(new c.Equation(a.constraints.y,e.constraints.y)):(b=n(b[b.length-1]),b=c.plus(c.divide(c.minus(b.constraints.y,e.constraints.y),2),e.constraints.y),q.addConstraint(new c.Equation(a.constraints.y,b)))}else q.addConstraint(new c.Equation(a.constraints.x,
0))});x=null;this.inputs.map(function(a){a=n(a);null!=x&&q.addConstraint(new c.Inequality(c.plus(x.constraints.y,30),c.LEQ,a.constraints.y));x=a});q.solve();for(var p=null,r=null,u=null,v=null,w=0;w<f.length;w++){var z=f[w],A=z.constraints.x.value,y=z.constraints.y.value;if(null==p||A<p)p=A;if(null==r||y<r)r=y;if(null==u||A>u)u=A;if(null==v||y>v)v=y;for(var B=w+1;B<f.length;B++){var C=f[B],p=C.constraints.x.value,r=C.constraints.y.value;p==A&&r==y&&(console.log("conflict between "+z.node.id+" and "+
C.node.id),C.constraints.y.value+=80)}}var p=d-(u+p)/2,r=e-(v+r)/2,D=this;f.map(function(e){var n=e.node,f=e.constraints,d=null;switch(n.kind){case "source":e.options={viewModel:e,value:e.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();g(D,l,h)},x:p+f.x.value,y:r+f.y.value};d=new b.SourceView(n,e.options);break;case "gate":e.options={viewModel:e,id:n.id,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:[n.inputs[0].evaluate()?
"1":"0",n.inputs[1].evaluate()?"1":"0"],output:n.evaluate()?"1":"0",x:p+f.x.value,y:r+f.y.value};d=new b.GateView(new b.NandView(e.options));switch(n.gate){case "not":d=new b.GateView(new b.NotView(e.options));break;case "nand":d=new b.GateView(new b.NandView(e.options));break;case "and":d=new b.GateView(new b.AndView(e.options));break;case "nor":d=new b.GateView(new b.NorView(e.options));break;case "or":d=new b.GateView(new b.OrView(e.options));break;case "xor":d=new b.GateView(new b.XorView(e.options));
break;default:throw"gate";}break;case "sink":e.options={viewModel:e,value:n.evaluate()?"1":"0",x:p+f.x.value,y:r+f.y.value};d=new b.SinkView(e.options);break;case "fanout":e.options={viewModel:e,x:p+f.x.value,y:r+f.y.value};d=new b.FanOutView(e.options);break;default:throw"kind";}null!=d&&(d.render(a),l.push({node:n,view:d}))});this.models=f;this.layoutWires(a);return{nodeViews:l,maxDepth:h}};n.prototype.place=function(b,g){b>this.width-1&&(this.width=b+1);g>this.height-1&&(this.height=g+1);for(var n=
0;n<this.grid.length;n++)for(;this.grid[n].length<this.width;)this.grid[n].push(null);for(;this.grid.length<this.height;){for(n=[];n.length<this.width;)n.push(null);this.grid.push(n)}if(null==this.grid[g][b])this.grid[g][b]=new a(b,g);else{console.log("conflict");if(g+1>=this.height||null==this.grid[g+1][b])return console.log("nothing at y+1"),this.place(b,g+1);throw"insert";}return this.grid[g][b]};d.prototype.layout3=function(a,g){var d=a.width/2,k=a.height/2,e=[],l=0,h=[],f=new n;this.traverse(function(a,
b,e){console.log(a.kind+a.id+": breadth="+b+", depth="+e);a.seen||(a.seen=!0,a={node:a,dx:0,dy:0,location:f.place(e,b)},h.push(a));if(null==l||e>l)l=e});h.map(function(a){a.x=80*a.location.x;a.y=60*a.location.y});for(var x=null,q=null,p=0;p<h.length;p++){var r=h[p],u=r.x,r=r.y;if(null==x||u>x)x=u;if(null==q||r>q)q=r}var v=d-x/2,w=k-q/2,z=this;h.map(function(n){var f=n.node,d=null;switch(f.kind){case "source":n.options={viewModel:n,value:n.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=
this.node.value?"1":"0";this.update();g(z,e,l)},x:v+n.x,y:w+n.y};d=new b.SourceView(f,n.options);break;case "gate":n.options={viewModel:n,id:f.id,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:[f.inputs[0].evaluate()?"1":"0",f.inputs[1].evaluate()?"1":"0"],output:f.evaluate()?"1":"0",x:v+n.x,y:w+n.y};d=new b.GateView(new b.NandView(n.options));switch(f.gate){case "not":d=new b.GateView(new b.NotView(n.options));break;case "nand":d=new b.GateView(new b.NandView(n.options));break;
case "and":d=new b.GateView(new b.AndView(n.options));break;case "nor":d=new b.GateView(new b.NorView(n.options));break;case "or":d=new b.GateView(new b.OrView(n.options));break;case "xor":d=new b.GateView(new b.XorView(n.options));break;default:throw"gate";}break;case "sink":n.options={viewModel:n,value:f.evaluate()?"1":"0",x:v+n.x,y:w+n.y};d=new b.SinkView(n.options);break;case "fanout":n.options={viewModel:n,x:v+n.x,y:w+n.y};d=new b.FanOutView(n.options);break;default:throw"kind";}null!=d&&(d.render(a),
e.push({node:f,view:d}))});this.models=h;this.layoutWires(a);return{nodeViews:e,maxDepth:l}};b.Circuit=d;return b}(NAND||{});NAND=function(b){function d(a){this.id=a;this.kind="delay";this.inputs=[];this.outputs=[]}d.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d);this.outputs.map(function(g){g.traverse(a,b,d+1)})};d.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.Delay=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a}d.prototype.render=function(a){};b.DelayView=d;return b}(NAND||{});NAND=function(b){function d(a){this.id=a;this.kind="fanout";this.inputs=[];this.outputs=[]}d.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d);this.outputs.map(function(g){g.traverse(a,b,d+1)})};d.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.FanOut=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a}d.prototype.render=function(a){};d.prototype.bounds=function(){return{width:10,height:10}};b.FanOutView=d;return b}(NAND||{});NAND=function(b){function d(a,b,d){this.id=a;this.kind="gate";this.gate=b;this.logic=d;this.inputs=[];this.outputs=[]}d.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d);this.outputs.map(function(g){g.traverse(a,b,d+1)})};d.prototype.evaluate=function(){if("not"==this.gate&&1!=this.inputs.length||"not"!=this.gate&&2>this.inputs.length)throw"inputs";var a=[];this.inputs.map(function(b){a.push(b.evaluate())});return this.logic(a)};
b.Gate=d;return b}(NAND||{});NAND=function(b){function d(a){this.delegate=a;this.model=a.model}d.prototype.render=function(a){this.delegate.render(a)};d.prototype.update=function(){for(var a=this.delegate.model.inputs,b=this.delegate.model.output,d=this.delegate.labels,g=this.delegate.outlines,m=this.delegate.paths,k="?"==a[0],e=0;e<a.length;e++){var l="?"==a[e]?"black":"0"==a[e]?"#a00":"#0a0";d[e].attr("text",a[e]).attr("stroke",l);g[e].attr("stroke",l)}d[a.length].attr("text",b).attr("stroke","?"==b?"black":"0"==b?"#a00":"#0a0");
g[a.length].attr("stroke","?"==b?"black":"0"==b?"#a00":"#0a0");for(e=0;e<m.length;e++)null!=m[e]&&m[e].attr("stroke-dasharray",k?"-":"")};d.prototype.bounds=function(){return{width:1.4*this.delegate.model.width,height:1.1*this.delegate.model.height}};b.GateView=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var d=this.model.heavyStrokeWidth,t=this.model.lightStrokeWidth,g=this.model.width/2,m=this.model.height/2,k=this.model.x-g,e=this.model.y-m,l="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(k,e).lineTo(k+g,e).arc(1,1,0,0,1,k+g,e+this.model.height).lineTo(k,e+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?
"-":""}).drag(b.makeMove(this),b.start,b.up(this));var h=.05*this.model.width,d=k+g+m+h+d/2,m=e+m;this.paths[1]=a.circle(d,m,h).attr({fill:"white","stroke-width":t*(l?.5:1),"stroke-dasharray":l?"-":""});l=.2*this.model.height;g=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k,e+l).lineTo(k-g,e+l).toPath(a).attr("stroke-width",t);var f="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-g,e+l,7.5).attr("fill","white").attr("stroke",f);
this.labels[0]=a.text(k-g,e+l,this.model.inputs[0]).attr("stroke",f);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(k,e+this.model.height-l).lineTo(k-g,e+this.model.height-l).toPath(a).attr("stroke-width",t);f="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(k-g,e+this.model.height-l,7.5).attr("fill","white").attr("stroke",f);this.labels[1]=a.text(k-g,e+this.model.height-l,this.model.inputs[1]).attr("stroke",
f);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+g,y:m};this.paths[4]=(new b.PathBuilder).moveTo(d+h,m).lineTo(d+g,m).toPath(a).attr("stroke-width",t);null!=this.model.output&&(f="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(d+g,m,7.5).attr("fill","white").attr("stroke",f),this.labels[2]=a.text(d+g,m,this.model.output).attr("stroke",f),this.labels[2].node.setAttribute("class","intermediate"))};b.NandView=d;return b}(NAND||
{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var d=this.model.heavyStrokeWidth,t=this.model.lightStrokeWidth,g=this.model.width/2,m=this.model.height/2,k=this.model.x-g,e=this.model.y-m,l="?"==this.model.inputs[0],h=.4*this.model.width,f=2*this.model.width/3,x=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(k,e).lineTo(k+h,e).arc(f,f,0,0,1,k+this.model.width-x,e+m).arc(f,f,0,0,1,k+h,e+this.model.height).lineTo(k,
e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""});this.paths[1]=(new b.PathBuilder).moveTo(k,e).arc(h,h,0,0,1,k,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""});h=.05*this.model.width;d=k+g+m+h+d/2;m=e+m;a.circle(d,m,h).attr({fill:"white","stroke-width":t*(l?.5:1),"stroke-dasharray":l?"-":""});l=.2*this.model.height;g=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k+g-1-.5*
g,e+l).lineTo(k-g,e+l).toPath(a).attr("stroke-width",t);f="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-g,e+l,7.5).attr("fill","white").attr("stroke",f);this.labels[0]=a.text(k-g,e+l,this.model.inputs[0]).attr("stroke",f);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(k+g-1-.5*g,e+this.model.height-l).lineTo(k-g,e+this.model.height-l).toPath(a).attr("stroke-width",t);f="?"==this.model.inputs[1]?
"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(k-g,e+this.model.height-l,7.5).attr("fill","white").attr("stroke",f);this.labels[1]=a.text(k-g,e+this.model.height-l,this.model.inputs[1]).attr("stroke",f);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+g,y:m};(new b.PathBuilder).moveTo(d+h,m).lineTo(d+g,m).toPath(a).attr("stroke-width",t);null!=this.model.output&&(f="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=
a.circle(d+g,m,7.5).attr("fill","white").attr("stroke",f),this.labels[2]=a.text(d+g,m,this.model.output).attr("stroke",f),this.labels[2].node.setAttribute("class","intermediate"))};d.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",
a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.NorView=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var d=this.model.heavyStrokeWidth,t=this.model.lightStrokeWidth,g=this.model.width/2,m=this.model.height/2,k=this.model.x-g,e=this.model.y-m,l="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(k,e).lineTo(k+this.model.width-20,e+m).lineTo(k,e+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""}).drag(b.makeMove(this),
b.start,b.up(this));var h=.05*this.model.width,d=k+g+m+h+d/2-11,g=e+m;this.paths[1]=a.circle(d,g,h).attr({fill:"white","stroke-width":t*(l?.5:1),"stroke-dasharray":l?"-":""});l=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k,e+m).lineTo(k-l,e+m).toPath(a).attr("stroke-width",t);var f="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-l,e+m,7.5).attr("fill","white").attr("stroke",f);this.labels[0]=a.text(k-l,e+m,this.model.inputs[0]).attr("stroke",
f);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(d+h,g).lineTo(d+l,g).toPath(a).attr("stroke-width",t);null!=this.model.output&&(f="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[1]=a.circle(d+l,g,7.5).attr("fill","white").attr("stroke",f),this.labels[1]=a.text(d+l,g,this.model.output).attr("stroke",f),this.labels[1].node.setAttribute("class","intermediate"))};b.NotView=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var d=this.model.heavyStrokeWidth,t=this.model.lightStrokeWidth,g=this.model.width/2,m=this.model.height/2,k=this.model.x-g,e=this.model.y-m,l="?"==this.model.inputs[0],h=.4*this.model.width,f=2*this.model.width/3,x=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(k,e).lineTo(k+h,e).arc(f,f,0,0,1,k+this.model.width-x,e+m).arc(f,f,0,0,1,k+h,e+this.model.height).lineTo(k,
e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""}).drag(b.makeMove(this),b.start,b.up(this));this.paths[1]=(new b.PathBuilder).moveTo(k,e).arc(h,h,0,0,1,k,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""});l=.05*this.model.width;d=k+g+m+l+d/2;m=e+m;g=.2*this.model.height;h=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k+h-1-.5*h,e+g).lineTo(k-h,e+g).toPath(a).attr("stroke-width",
t);f="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-h,e+g,7.5).attr("fill","white").attr("stroke",f);this.labels[0]=a.text(k-h,e+g,this.model.inputs[0]).attr("stroke",f);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(k+h-1-.5*h,e+this.model.height-g).lineTo(k-h,e+this.model.height-g).toPath(a).attr("stroke-width",t);f="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=
a.circle(k-h,e+this.model.height-g,7.5).attr("fill","white").attr("stroke",f);this.labels[1]=a.text(k-h,e+this.model.height-g,this.model.inputs[1]).attr("stroke",f);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+h,y:m};this.outlines[3]=(new b.PathBuilder).moveTo(d+l,m).lineTo(d+h,m).toPath(a).attr("stroke-width",t);null!=this.model.output&&(f="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(d+h,m,7.5).attr("fill","white").attr("stroke",
f),this.labels[2]=a.text(d+h,m,this.model.output).attr("stroke",f),this.labels[2].node.setAttribute("class","intermediate"))};d.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",
a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.OrView=d;return b}(NAND||{});NAND=function(b){function d(){this.commands=[]}d.prototype.moveTo=function(a,b){this.commands.push("M"+a+","+b);return this};d.prototype.lineTo=function(a,b){this.commands.push("L"+a+","+b);return this};d.prototype.arc=function(a,b,d,g,m,k,e){this.commands.push("A"+a+","+b+" "+d+" "+g+" "+m+" "+k+","+e);return this};d.prototype.close=function(){this.commands.push("Z");return this};d.prototype.toPath=function(a){return a.path(this.commands.join(" "))};b.PathBuilder=d;return b}(NAND||{});NAND=function(b){function d(a){this.id=a;this.kind="sink";this.inputs=[]}d.prototype.connect=function(a){this.inputs.push(a);a.outputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d)};d.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.Sink=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.paths=[];this.outlines=[];this.labels=[]}d.prototype.render=function(a){var d=this.model.value,t=this.model.x,g=this.model.y,m="?"==d?"black":"0"==d?"#a00":"#0a0";this.outlines[0]=a.rect(t-7,g-7,14,14).attr("stroke",m).attr("fill","white").drag(b.makeMove(this),b.start,b.up(this));this.labels[0]=a.text(t,g,d).attr("stroke",m).drag(b.makeMove(this),b.start,b.up(this));this.labels[0].node.setAttribute("class","output")};d.prototype.update=function(){var a=
this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};d.prototype.bounds=function(){return{width:14,height:14}};b.SinkView=d;return b}(NAND||{});NAND=function(b){function d(a,b){this.id=a;this.kind="source";this.value=b;this.outputs=[]}d.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d);this.outputs.map(function(g){g.traverse(a,b,d+1)})};d.prototype.evaluate=function(){return this.value};d.prototype.toggle=function(){this.value=!this.value};b.Source=d;return b}(NAND||{});NAND=function(b){function d(a,b){this.node=a;this.model=b;this.paths=[];this.labels=[];this.outlines=[]}d.prototype.render=function(a){var d=this.model.value,t=this.model.x,g=this.model.y,m="?"==d?"black":"0"==d?"#a00":"#0a0";this.outlines[0]=a.rect(t-7,g-7,14,14).attr("stroke",m).attr("fill","white").drag(b.makeMove(this),b.start,b.up(this));this.labels[0]=a.text(t,g,d).attr("stroke",m).click(this.model.click.bind(this)).drag(b.makeMove(this),b.start,b.up(this));this.labels[0].node.setAttribute("class",
"input")};d.prototype.update=function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};d.prototype.bounds=function(){return{width:14,height:14}};b.SourceView=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var d=this.model.heavyStrokeWidth,t=this.model.lightStrokeWidth,g=this.model.width/2,m=this.model.height/2,k=this.model.x-g,e=this.model.y-m,l="?"==this.model.inputs[0],h=.4*this.model.width,f=2*this.model.width/3,x=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(k,e).lineTo(k+h,e).arc(f,f,0,0,1,k+this.model.width-x,e+m).arc(f,f,0,0,1,k+h,e+this.model.height).lineTo(k,
e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""}).drag(b.makeMove(this),b.start,b.up(this));this.paths[1]=(new b.PathBuilder).moveTo(k,e).arc(h,h,0,0,1,k,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""});this.paths[2]=(new b.PathBuilder).moveTo(k-5,e).arc(h,h,0,0,1,k-5,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""});l=.05*this.model.width;
d=k+g+m+l+d/2;m=e+m;g=.2*this.model.height;h=.3*this.model.width;this.paths[3]=(new b.PathBuilder).moveTo(k+h-1-.5*h,e+g).lineTo(k-h,e+g).toPath(a).attr("stroke-width",t);f="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-h,e+g,7.5).attr("fill","white").attr("stroke",f);this.labels[0]=a.text(k-h,e+g,this.model.inputs[0]).attr("stroke",f);this.labels[0].node.setAttribute("class","intermediate");this.paths[4]=(new b.PathBuilder).moveTo(k+h-1-.5*h,
e+this.model.height-g).lineTo(k-h,e+this.model.height-g).toPath(a).attr("stroke-width",t);f="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(k-h,e+this.model.height-g,7.5).attr("fill","white").attr("stroke",f);this.labels[1]=a.text(k-h,e+this.model.height-g,this.model.inputs[1]).attr("stroke",f);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+h,y:m};this.outlines[3]=(new b.PathBuilder).moveTo(d+l,m).lineTo(d+h,m).toPath(a).attr("stroke-width",
t);null!=this.model.output&&(f="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(d+h,m,7.5).attr("fill","white").attr("stroke",f),this.labels[2]=a.text(d+h,m,this.model.output).attr("stroke",f),this.labels[2].node.setAttribute("class","intermediate"))};b.XorView=d;return b}(NAND||{});NAND=function(b){function d(a){return!a.reduce(function(a,b){return a&&b})}function a(a){return a.reduce(function(a,b){return a&&b})}function n(a){return a.reduce(function(a,b){return a^b})}function t(a,b,d){0>e?e=0:e>=d&&(e=d-1);a.traverse(function(a,f,g){b.map(function(b){var f=b.node,h=b.view;if(f.id==a.id){var k=g>e;switch(f.kind){case "gate":f.inputs.map(function(a,b){h.model.inputs[b]=k?"?":a.evaluate()?"1":"0"});h.model.output=k?"?":f.evaluate()?"1":"0";h.update();break;case "sink":h.model.value=
e<d-1?"?":f.evaluate()?"1":"0",h.update()}}})});document.getElementById("time").textContent="t = "+e}function g(g){m=new Raphael(0,0,window.innerWidth,window.innerHeight);var q=document.getElementById("controls");q.style.left=m.width/2-q.clientWidth/2+"px";q.style.top=m.height/2-q.clientHeight/2-150+"px";var q=0,p=new b.Source(q++,!1),r=new b.Source(q++,!1);new b.Source(q++,!1);var u=new b.Sink(q++),v=new b.Sink(q++);new b.Sink(q++);new b.Delay(q++);new b.Delay(q++);new b.Delay(q++);var w=new b.FanOut(q++),
z=new b.FanOut(q++);new b.FanOut(q++);var A=new b.Gate(q++,"xor",n),y=new b.Gate(q++,"and",a);new b.Gate(q++,"nand",d);new b.Gate(q++,"nand",d);new b.Gate(q++,"nand",d);new b.Gate(q++,"nand",d);k=new b.Circuit(q++);p.connect(w);r.connect(z);w.connect(A);w.connect(y);z.connect(A);z.connect(y);A.connect(u);y.connect(v);k.inputs=[p,r];k.outputs=[u,v];l=k.layout3(m,t);f=l.nodeViews;h=l.maxDepth;e=h-1;t(k,f,h);var B=document.getElementById("slider");B.max=h-1;B.value=e;g&&(document.getElementById("forward").addEventListener("click",
function(){e++;t(k,f,h);B.value=e},!1),document.getElementById("backward").addEventListener("click",function(){e--;t(k,f,h);B.value=e},!1),document.getElementById("slider").addEventListener("input",function(){e=this.value;t(k,f,h);B.value=e}))}var m,k;b.makeMove=function(a){return function(b,d){for(var e=0;e<a.paths.length;e++){var f=a.paths[e];null!=f&&f.translate(b-this.tx,d-this.ty)}for(e=0;e<a.labels.length;e++)f=a.labels[e],null!=f&&f.translate(b-this.tx,d-this.ty);for(e=0;e<a.outlines.length;e++)f=
a.outlines[e],null!=f&&f.translate(b-this.tx,d-this.ty);this.tx=b;this.ty=d;a.model.viewModel.dx=b;a.model.viewModel.dy=d;k.layoutWires(m)}};b.start=function(){this.ty=this.tx=0};b.up=function(a){return function(){a.model.x+=a.model.viewModel.dx;a.model.y+=a.model.viewModel.dy;a.model.viewModel.dx=0;a.model.viewModel.dy=0}};var e=0,l,h,f;window.addEventListener("load",function(){g(!0)});window.addEventListener("resize",function(){m.clear();g(!1)});return b}(NAND||{});
