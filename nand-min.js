var NAND=function(l){function q(c){this.model=c;this.outlines=[];this.labels=[];this.paths=[]}q.prototype.render=function(c){var x=this.model.heavyStrokeWidth,q=this.model.lightStrokeWidth,p=this.model.width/2,v=this.model.height/2,n=this.model.x-p,k=this.model.y-v,t="?"==this.model.inputs[0];this.paths[0]=(new l.PathBuilder).moveTo(n,k).lineTo(n+p,k).arc(1,1,0,0,1,n+p,k+this.model.height).lineTo(n,k+this.model.height).close().toPath(c).attr({fill:"white","stroke-width":x*(t?.5:1),"stroke-dasharray":t?
"-":""}).drag(l.makeMove(this),l.start,l.up(this));var t=.05*this.model.width,x=n+p+v+t+x/2,v=k+v,p=.2*this.model.height,w=.3*this.model.width;this.paths[2]=(new l.PathBuilder).moveTo(n,k+p).lineTo(n-w,k+p).toPath(c).attr("stroke-width",q);var r="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=c.circle(n-w,k+p,7.5).attr("fill","white").attr("stroke",r);this.labels[0]=c.text(n-w,k+p,this.model.inputs[0]).attr("stroke",r);this.labels[0].node.setAttribute("class",
"intermediate");this.paths[3]=(new l.PathBuilder).moveTo(n,k+this.model.height-p).lineTo(n-w,k+this.model.height-p).toPath(c).attr("stroke-width",q);r="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=c.circle(n-w,k+this.model.height-p,7.5).attr("fill","white").attr("stroke",r);this.labels[1]=c.text(n-w,k+this.model.height-p,this.model.inputs[1]).attr("stroke",r);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:x+w,y:v};this.outlines[3]=
(new l.PathBuilder).moveTo(x+t,v).lineTo(x+w,v).toPath(c).attr("stroke-width",q);null!=this.model.output&&(r="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=c.circle(x+w,v,7.5).attr("fill","white").attr("stroke",r),this.labels[2]=c.text(x+w,v,this.model.output).attr("stroke",r),this.labels[2].node.setAttribute("class","intermediate"))};q.prototype.update=function(){var c="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",
this.model.inputs[0]).attr("stroke",c);this.outlines[0].attr("stroke",c);c="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",c);this.outlines[1].attr("stroke",c);c="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",c);this.outlines[2].attr("stroke",c);c="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",c?"-":"");this.paths[2].attr("stroke-dasharray",
c?"-":"");this.paths[3].attr("stroke-dasharray",c?"-":"")};l.AndView=q;return l}(NAND||{});NAND=function(l){function q(c){this.model=c;this.outlines=[];this.labels=[];this.paths=[]}q.prototype.render=function(c){var l=this.model.heavyStrokeWidth,q=this.model.lightStrokeWidth,p=this.model.width/2,v=this.model.height/2,n=this.model.x-p,k=this.model.y-v,t="?"==this.model.inputs[0];this.paths[0]=(new PathBuilder).moveTo(n,k).lineTo(n+p,k).arc(1,1,0,0,1,n+p,k+this.model.height).lineTo(n,k+this.model.height).close().toPath(c).attr({fill:"white","stroke-width":l*(t?.5:1),"stroke-dasharray":t?
"-":""});var w=.05*this.model.width,l=n+p+v+w+l/2,v=k+v;c.circle(l,v,w).attr({fill:"white","stroke-width":q*(t?.5:1),"stroke-dasharray":t?"-":""});t=.2*this.model.height;p=.3*this.model.width;this.paths[2]=(new PathBuilder).moveTo(n,k+t).lineTo(n-p,k+t).toPath(c).attr("stroke-width",q);var r="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=c.circle(n-p,k+t,7.5).attr("fill","white").attr("stroke",r);this.labels[0]=c.text(n-p,k+t,this.model.inputs[0]).attr("stroke",
r);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new PathBuilder).moveTo(n,k+this.model.height-t).lineTo(n-p,k+this.model.height-t).toPath(c).attr("stroke-width",q);r="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=c.circle(n-p,k+this.model.height-t,7.5).attr("fill","white").attr("stroke",r);this.labels[1]=c.text(n-p,k+this.model.height-t,this.model.inputs[1]).attr("stroke",r);this.labels[1].node.setAttribute("class","intermediate");
this.outputWire={x:l+p,y:v};(new PathBuilder).moveTo(l+w,v).lineTo(l+p,v).toPath(c).attr("stroke-width",q);null!=this.model.output&&(r="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=c.circle(l+p,v,7.5).attr("fill","white").attr("stroke",r),this.labels[2]=c.text(l+p,v,this.model.output).attr("stroke",r),this.labels[2].node.setAttribute("class","intermediate"))};q.prototype.update=function(){var c="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":
"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",c);this.outlines[0].attr("stroke",c);c="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",c);this.outlines[1].attr("stroke",c);c="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",c);this.outlines[2].attr("stroke",c);c="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",
c?"-":"");this.paths[2].attr("stroke-dasharray",c?"-":"");this.paths[3].attr("stroke-dasharray",c?"-":"")};l.NandView=q;return l}(NAND||{});NAND=function(l){function q(c){this.model=c;this.outlines=[];this.labels=[];this.paths=[]}q.prototype.render=function(c){var q=this.model.heavyStrokeWidth,A=this.model.lightStrokeWidth,p=this.model.width/2,v=this.model.height/2,n=this.model.x-p,k=this.model.y-v,t="?"==this.model.inputs[0];this.paths[0]=(new l.PathBuilder).moveTo(n,k).lineTo(n+this.model.width-20,k+v).lineTo(n,k+this.model.height).close().toPath(c).attr({fill:"white","stroke-width":q*(t?.5:1),"stroke-dasharray":t?"-":""});var w=.05*
this.model.width,q=n+p+v+w+q/2-11,p=k+v;c.circle(q,p,w).attr({fill:"white","stroke-width":A*(t?.5:1),"stroke-dasharray":t?"-":""});t=.3*this.model.width;this.paths[1]=(new l.PathBuilder).moveTo(n,k+v).lineTo(n-t,k+v).toPath(c).attr("stroke-width",A);var r="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=c.circle(n-t,k+v,7.5).attr("fill","white").attr("stroke",r);this.labels[0]=c.text(n-t,k+v,this.model.inputs[0]).attr("stroke",r);this.labels[0].node.setAttribute("class",
"intermediate");this.outputWire={x:q+t,y:p};(new l.PathBuilder).moveTo(q+w,p).lineTo(q+t,p).toPath(c).attr("stroke-width",A);null!=this.model.output&&(r="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[1]=c.circle(q+t,p,7.5).attr("fill","white").attr("stroke",r),this.labels[1]=c.text(q+t,p,this.model.output).attr("stroke",r),this.labels[1].node.setAttribute("class","intermediate"))};q.prototype.update=function(){var c="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?
"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",c);this.outlines[0].attr("stroke",c);c="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[1].attr("text",this.model.output).attr("stroke",c);this.outlines[1].attr("stroke",c);c="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",c?"-":"");this.paths[1].attr("stroke-dasharray",c?"-":"")};l.NotView=q;return l}(NAND||{});NAND=function(l){function q(){this.commands=[]}q.prototype.moveTo=function(c,l){this.commands.push("M"+c+","+l);return this};q.prototype.lineTo=function(c,l){this.commands.push("L"+c+","+l);return this};q.prototype.arc=function(c,l,q,p,v,n,k){this.commands.push("A"+c+","+l+" "+q+" "+p+" "+v+" "+n+","+k);return this};q.prototype.close=function(){this.commands.push("Z");return this};q.prototype.toPath=function(c){return c.path(this.commands.join(" "))};l.PathBuilder=q;return l}(NAND||{});NAND=function(l){function q(){this.ty=this.tx=0}function c(a){return function(b,c){for(var h=0;h<a.paths.length;h++){var m=a.paths[h];null!=m&&m.translate(b-this.tx,c-this.ty)}for(h=0;h<a.labels.length;h++)m=a.labels[h],null!=m&&m.translate(b-this.tx,c-this.ty);for(h=0;h<a.outlines.length;h++)m=a.outlines[h],null!=m&&m.translate(b-this.tx,c-this.ty);this.tx=b;this.ty=c;a.model.viewModel.dx=b;a.model.viewModel.dy=c;z.layoutWires()}}function x(a){return function(){a.model.x+=a.model.viewModel.dx;a.model.y+=
a.model.viewModel.dy;a.model.viewModel.dx=0;a.model.viewModel.dy=0}}function A(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}function p(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}function v(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}function n(a,b,c){this.id=a;this.kind="gate";this.gate=b;this.logic=c;this.inputs=[];this.outputs=[]}function k(a,b){this.id=a;this.kind="source";this.value=b;this.outputs=[]}function t(a){this.id=a;this.kind="sink";
this.inputs=[]}function w(a){this.id=a;this.kind="delay";this.inputs=[];this.outputs=[]}function r(a){this.id=a;this.kind="fanout";this.inputs=[];this.outputs=[]}function M(a){return a.reduce(function(a,c){return a&&c})}function P(a){return a.reduce(function(a,c){return a||c})}function N(a){return a.reduce(function(a,c){return a^c})}function G(a,b){this.node=a;this.model=b;this.paths=[];this.labels=[];this.outlines=[]}function H(a){this.model=a;this.paths=[];this.outlines=[];this.labels=[]}function J(a){this.model=
a}function K(a){this.model=a}function E(a){this.id=a;this.inputs=[];this.outputs=[];this.wires=[]}function B(a,b,c){0>y?y=0:y>=c&&(y=c-1);a.traverse(function(a,m,d){b.map(function(b){var g=b.node,e=b.view;if(g.id==a.id){var m=d>y;switch(g.kind){case "gate":g.inputs.map(function(a,b){e.model.inputs[b]=m?"?":a.evaluate()?"1":"0"});e.model.output=m?"?":g.evaluate()?"1":"0";e.update();break;case "sink":e.model.value=y<c-1?"?":g.evaluate()?"1":"0",e.update()}}})});document.getElementById("time").textContent=
"t = "+y}function O(a){C=new Raphael(0,0,window.innerWidth,window.innerHeight);var b=document.getElementById("controls");b.style.left=C.width/2-b.clientWidth/2+"px";b.style.top=C.height/2-b.clientHeight/2-150+"px";var b=0,c=new k(b++,!1),h=new k(b++,!1),m=new k(b++,!1),d=new t(b++),f=new t(b++),g=new t(b++);new w(b++);new w(b++);new w(b++);var e=new r(b++),l=new r(b++);new r(b++);new r(b++);var q=new n(b++,"xor",N),p=new n(b++,"and",M);new n(b++,"xor",N);new n(b++,"and",M);new n(b++,"or",P);c.connect(e);
e.connect(d);h.connect(l);l.connect(f);e.connect(p);l.connect(p);p.connect(q);m.connect(q);q.connect(g);z=new E(b++);z.inputs=[c,h,m];z.outputs=[d,f];L=z.layout2(C);F=L.nodeViews;D=L.maxDepth;B(z,F,D);var I=document.getElementById("slider");I.max=D-1;a&&(document.getElementById("forward").addEventListener("click",function(){y++;B(z,F,D);I.value=y},!1),document.getElementById("backward").addEventListener("click",function(){y--;B(z,F,D);I.value=y},!1),document.getElementById("slider").addEventListener("input",
function(){y=this.value;B(z,F,D);I.value=y}))}var C,z;l.makeMove=c;l.start=q;l.up=x;A.prototype.render=function(a){var b=this.model.heavyStrokeWidth,c=this.model.lightStrokeWidth,h=this.model.width/2,m=this.model.height/2,d=this.model.x-h,f=this.model.y-m,g="?"==this.model.inputs[0],e=.4*this.model.width,u=2*this.model.width/3,q=.15*this.model.width;this.paths[0]=(new l.PathBuilder).moveTo(d,f).lineTo(d+e,f).arc(u,u,0,0,1,d+this.model.width-q,f+m).arc(u,u,0,0,1,d+e,f+this.model.height).lineTo(d,f+
this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""});this.paths[1]=(new l.PathBuilder).moveTo(d,f).arc(e,e,0,0,1,d,f+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""});e=.05*this.model.width;b=d+h+m+e+b/2;m=f+m;a.circle(b,m,e).attr({fill:"white","stroke-width":c*(g?.5:1),"stroke-dasharray":g?"-":""});g=.2*this.model.height;h=.3*this.model.width;this.paths[2]=(new l.PathBuilder).moveTo(d+h-1-.5*
h,f+g).lineTo(d-h,f+g).toPath(a).attr("stroke-width",c);u="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(d-h,f+g,7.5).attr("fill","white").attr("stroke",u);this.labels[0]=a.text(d-h,f+g,this.model.inputs[0]).attr("stroke",u);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new l.PathBuilder).moveTo(d+h-1-.5*h,f+this.model.height-g).lineTo(d-h,f+this.model.height-g).toPath(a).attr("stroke-width",c);u="?"==this.model.inputs[1]?
"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(d-h,f+this.model.height-g,7.5).attr("fill","white").attr("stroke",u);this.labels[1]=a.text(d-h,f+this.model.height-g,this.model.inputs[1]).attr("stroke",u);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:b+h,y:m};(new l.PathBuilder).moveTo(b+e,m).lineTo(b+h,m).toPath(a).attr("stroke-width",c);null!=this.model.output&&(u="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=
a.circle(b+h,m,7.5).attr("fill","white").attr("stroke",u),this.labels[2]=a.text(b+h,m,this.model.output).attr("stroke",u),this.labels[2].node.setAttribute("class","intermediate"))};A.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",
a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};p.prototype.render=function(a){var b=this.model.heavyStrokeWidth,p=this.model.lightStrokeWidth,
h=this.model.width/2,m=this.model.height/2,d=this.model.x-h,f=this.model.y-m,g="?"==this.model.inputs[0],e=.4*this.model.width,u=2*this.model.width/3,n=.15*this.model.width;this.paths[0]=(new l.PathBuilder).moveTo(d,f).lineTo(d+e,f).arc(u,u,0,0,1,d+this.model.width-n,f+m).arc(u,u,0,0,1,d+e,f+this.model.height).lineTo(d,f+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""}).drag(c(this),q,x(this));this.paths[1]=(new l.PathBuilder).moveTo(d,f).arc(e,
e,0,0,1,d,f+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""});g=.05*this.model.width;b=d+h+m+g+b/2;m=f+m;h=.2*this.model.height;e=.3*this.model.width;this.paths[2]=(new l.PathBuilder).moveTo(d+e-1-.5*e,f+h).lineTo(d-e,f+h).toPath(a).attr("stroke-width",p);u="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(d-e,f+h,7.5).attr("fill","white").attr("stroke",u);this.labels[0]=a.text(d-e,f+h,this.model.inputs[0]).attr("stroke",
u);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new l.PathBuilder).moveTo(d+e-1-.5*e,f+this.model.height-h).lineTo(d-e,f+this.model.height-h).toPath(a).attr("stroke-width",p);u="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(d-e,f+this.model.height-h,7.5).attr("fill","white").attr("stroke",u);this.labels[1]=a.text(d-e,f+this.model.height-h,this.model.inputs[1]).attr("stroke",u);this.labels[1].node.setAttribute("class",
"intermediate");this.outputWire={x:b+e,y:m};this.outlines[3]=(new l.PathBuilder).moveTo(b+g,m).lineTo(b+e,m).toPath(a).attr("stroke-width",p);null!=this.model.output&&(u="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(b+e,m,7.5).attr("fill","white").attr("stroke",u),this.labels[2]=a.text(b+e,m,this.model.output).attr("stroke",u),this.labels[2].node.setAttribute("class","intermediate"))};p.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":
"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];
this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};v.prototype.render=function(a){var b=this.model.heavyStrokeWidth,p=this.model.lightStrokeWidth,h=this.model.width/2,m=this.model.height/2,d=this.model.x-h,f=this.model.y-m,g="?"==this.model.inputs[0],e=.4*this.model.width,u=2*this.model.width/3,n=.15*this.model.width;this.paths[0]=(new l.PathBuilder).moveTo(d,
f).lineTo(d+e,f).arc(u,u,0,0,1,d+this.model.width-n,f+m).arc(u,u,0,0,1,d+e,f+this.model.height).lineTo(d,f+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""}).drag(c(this),q,x(this));this.paths[1]=(new l.PathBuilder).moveTo(d,f).arc(e,e,0,0,1,d,f+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""});this.paths[2]=(new l.PathBuilder).moveTo(d-5,f).arc(e,e,0,0,1,d-5,f+this.model.height).toPath(a).attr({fill:"white",
"stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""});g=.05*this.model.width;b=d+h+m+g+b/2;m=f+m;h=.2*this.model.height;e=.3*this.model.width;this.paths[3]=(new l.PathBuilder).moveTo(d+e-1-.5*e,f+h).lineTo(d-e,f+h).toPath(a).attr("stroke-width",p);u="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(d-e,f+h,7.5).attr("fill","white").attr("stroke",u);this.labels[0]=a.text(d-e,f+h,this.model.inputs[0]).attr("stroke",u);this.labels[0].node.setAttribute("class",
"intermediate");this.paths[4]=(new l.PathBuilder).moveTo(d+e-1-.5*e,f+this.model.height-h).lineTo(d-e,f+this.model.height-h).toPath(a).attr("stroke-width",p);u="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(d-e,f+this.model.height-h,7.5).attr("fill","white").attr("stroke",u);this.labels[1]=a.text(d-e,f+this.model.height-h,this.model.inputs[1]).attr("stroke",u);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:b+e,y:m};
this.outlines[3]=(new l.PathBuilder).moveTo(b+g,m).lineTo(b+e,m).toPath(a).attr("stroke-width",p);null!=this.model.output&&(u="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(b+e,m,7.5).attr("fill","white").attr("stroke",u),this.labels[2]=a.text(b+e,m,this.model.output).attr("stroke",u),this.labels[2].node.setAttribute("class","intermediate"))};v.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";
this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",
a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"");this.paths[4].attr("stroke-dasharray",a?"-":"")};n.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};n.prototype.traverse=function(a,b,c){a(this,b,c);this.outputs.map(function(h){h.traverse(a,b,c+1)})};n.prototype.evaluate=function(){if("not"==this.gate&&1!=this.inputs.length||"not"!=this.gate&&2>this.inputs.length)throw"inputs";
var a=[];this.inputs.map(function(b){a.push(b.evaluate())});return this.logic(a)};k.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};k.prototype.traverse=function(a,b,c){a(this,b,c);this.outputs.map(function(h){h.traverse(a,b,c+1)})};k.prototype.evaluate=function(){return this.value};k.prototype.toggle=function(){this.value=!this.value};t.prototype.connect=function(a){this.inputs.push(a);a.outputs.push(this)};t.prototype.traverse=function(a,b,c){a(this,b,c)};t.prototype.evaluate=
function(){return this.inputs[0].evaluate()};w.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};w.prototype.traverse=function(a,b,c){a(this,b,c);this.outputs.map(function(h){h.traverse(a,b,c+1)})};w.prototype.evaluate=function(){return this.inputs[0].evaluate()};r.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};r.prototype.traverse=function(a,b,c){a(this,b,c);this.outputs.map(function(h){h.traverse(a,b,c+1)})};r.prototype.evaluate=function(){return this.inputs[0].evaluate()};
G.prototype.render=function(a){var b=this.model.value,l=this.model.x,h=this.model.y,m="?"==b?"black":"0"==b?"#a00":"#0a0";this.outlines[0]=a.rect(l-7,h-7,14,14).attr("stroke",m).attr("fill","white").drag(c(this),q,x(this));this.labels[0]=a.text(l,h,b).attr("stroke",m).click(this.model.click.bind(this)).drag(c(this),q,x(this));this.labels[0].node.setAttribute("class","input")};G.prototype.update=function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",
b);this.outlines[0].attr("stroke",b)};H.prototype.render=function(a){var b=this.model.value,l=this.model.x,h=this.model.y,m="?"==b?"black":"0"==b?"#a00":"#0a0";this.outlines[0]=a.rect(l-7,h-7,14,14).attr("stroke",m).attr("fill","white").drag(c(this),q,x(this));this.labels[0]=a.text(l,h,b).attr("stroke",m).drag(c(this),q,x(this));this.labels[0].node.setAttribute("class","output")};H.prototype.update=function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",
a).attr("stroke",b);this.outlines[0].attr("stroke",b)};J.prototype.render=function(a){};K.prototype.render=function(a){var b=this.model.x,c=this.model.y;(new l.PathBuilder).moveTo(b+42,c).lineTo(b+42,c+10).toPath(a)};E.prototype.traverse=function(a){this.inputs.map(function(b,c){b.traverse(a,c,0)})};E.prototype.layout=function(a){var b=[],c=null;this.traverse(function(a,e,d){e>=b.length&&(b[e]=[]);b[e][d]={node:a};if(null==c||d>c)c=d});for(var h=a.width/2-90*(b[0].length-1)/2,m=a.height/2-60*(b.length-
1)/2,d=0;d<b.length;d++)for(var f=0;f<b[d].length;f++){var g=b[d][f],e=g.node;g.x=h+90*f;g.y=m+60*d;0<d&&b[d-1][f].node.id==e.id&&(b[d-1][f].skip=!0,null==b[d-1][f].skipCount&&(b[d-1][f].skipCount=1),g.skipCount=b[d-1][f].skipCount+1,g.x=b[d-1][f].x+g.x,g.y=b[d-1][f].y+g.y)}for(d=0;d<b.length;d++)for(f=0;f<b[d].length;f++)g=b[d][f],null!=g.skipCount&&(g.x/=g.skipCount,g.y/=g.skipCount);for(d=0;d<b.length;d++)for(f=0;f<b[d].length;f++)g=b[d][f],e=g.node,g.skip||null==e.outputs||e.outputs.map(function(c){for(var e=
[],d=0;d<b.length;d++)for(var f=0;f<b[d].length;f++){var h=b[d][f];h.node.id!=c.id||h.skip||e.push(h)}if(1!=e.length)throw console.log(e),"outputs";c=e[0];e="gate"==c.node.kind?-48:0;d="gate"==c.node.kind?-5:0;(new l.PathBuilder).moveTo(g.x,g.y).lineTo(c.x+e,g.y).lineTo(c.x+e,c.y<g.y?c.y-d:c.y+d).toPath(a)});var q=this,n=[];b.map(function(b){b.map(function(b){if(!b.skip){var e=b.x,d=b.y,f=b.node;b=null;switch(f.kind){case "source":b=new G({x:e,y:d,value:f.value?"1":"0",click:function(){f.toggle();
this.model.value=f.value?"1":"0";this.update();B(q,n,c)}});b.render(a);break;case "sink":b=new H({x:e,y:d,value:f.evaluate()?"1":"0"});b.render(a);break;case "delay":b=new J({x:e,y:d});b.render(a);break;case "fanout":b=new K({x:e,y:d});b.render(a);break;case "gate":e={id:f.id,x:e,y:d,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:"not"==f.gate?[f.inputs[0].evaluate()?"1":"0"]:[f.inputs[0].evaluate()?"1":"0",f.inputs[1].evaluate()?"1":"0"],output:f.evaluate()?"1":"0"};switch(f.gate){case "not":b=
new NotView(e);break;case "nand":b=new NandView(e);break;case "and":b=new l.AndView(e);break;case "nor":b=new A(e);break;case "or":b=new p(e);break;case "xor":b=new v(e);break;default:throw"gate";}b.render(a);break;default:throw"kind";}null!=b&&n.push({node:f,view:b})}})});return{nodeViews:n,maxDepth:c}};E.prototype.layout2=function(a){var b=null,c=null;this.traverse(function(a,e,d){console.log(a.kind+"["+a.id+"]: breadth="+e+", depth="+d);if(null==b||e>b)b=e;if(null==c||d>c)c=d});console.log("maxBreadth="+
b+", maxDepth="+c);var h=[];this.traverse(function(a,b,c){a.seen||(console.log(a.kind+"["+a.id+"]: breadth="+b+", depth="+c),a.seen=!0,a={node:a,row:b,column:c,dx:0,dy:0},console.log(a),h.push(a))});for(var m=!0;m;)for(var m=!1,d=[],f=0;f<h.length;f++){for(var g=h[f],e=0;e<d.length;e++)if(d[e].row==g.row&&d[e].column==g.column&&d[e].node.id!=g.node.id){console.log("conflict at "+g.row+","+g.column);g.row++;g.column++;m=!0;break}if(m)break;d.push(g)}m=a.width/2-90*(c-1)/2;d=a.height/2-60*(b-1)/2;this.dx=
90;this.dy=60;this.cx=m;this.cy=d;this.models=h;this.layoutWires();for(var q=this,n=[],f=0;f<h.length;f++){var g=h[f],k=m+90*g.column,t=d+60*g.row,e=g.node,r=null;switch(e.kind){case "source":k={viewModel:g,x:k,y:t,value:g.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();B(q,n,c)}};r=new G(e,k);g.options=k;r.render(a);break;case "sink":k={viewModel:g,x:k,y:t,value:e.evaluate()?"1":"0"};r=new H(k);g.options=k;r.render(a);break;case "delay":r=
new J({x:k,y:t});r.render(a);break;case "fanout":r=new K({x:k,y:t});r.render(a);break;case "gate":k={viewModel:g,id:e.id,x:k,y:t,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:"not"==e.gate?[e.inputs[0].evaluate()?"1":"0"]:[e.inputs[0].evaluate()?"1":"0",e.inputs[1].evaluate()?"1":"0"],output:e.evaluate()?"1":"0"};g.options=k;switch(e.gate){case "not":r=new NotView(k);break;case "nand":r=new NandView(k);break;case "and":r=new l.AndView(k);break;case "nor":r=new A(k);break;case "or":r=
new p(k);break;case "xor":r=new v(k);break;default:throw"gate";}r.render(a);break;default:throw"kind";}null!=r&&n.push({node:e,view:r})}return{nodeViews:n,maxDepth:c}};E.prototype.layoutWires=function(){for(var a=0;a<this.wires.length;a++)this.wires[a].remove();this.wires=[];for(var b=this.dx,c=this.dy,h=this.cx,m=this.cy,d=this,a=0;a<this.models.length;a++){var f=this.models[a],g=f.node;null!=g.outputs&&g.outputs.map(function(a){for(var g=[],k=0;k<d.models.length;k++){var n=d.models[k];n.node.id==
a.id&&g.push(n)}if(1!=g.length)throw console.log(g),"outputs";a=g[0];var g=f.options?f.options.x+f.dx:h+f.column*b,k=f.options?f.options.y+f.dy:m+f.row*c,n=a.options?a.options.x+a.dx:h+a.column*b,p=a.options?a.options.y+a.dy:m+a.row*c,q="gate"==a.node.kind?-48:0;a="gate"==a.node.kind?-5:0;d.wires.push((new l.PathBuilder).moveTo(g,k).lineTo(n+q,k).lineTo(n+q,p<k?p-a:p+a).toPath(C).toBack())})}};var y=0,L,D,F;window.addEventListener("load",function(){O(!0)});window.addEventListener("resize",function(){C.clear();
O(!1)});return l}(NAND||{});
