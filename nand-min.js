var NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var p=this.model.heavyStrokeWidth,d=this.model.lightStrokeWidth,l=this.model.width/2,m=this.model.height/2,f=this.model.x-l,e=this.model.y-m,k="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(f,e).lineTo(f+l,e).arc(1,1,0,0,1,f+l,e+this.model.height).lineTo(f,e+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":p*(k?.5:1),"stroke-dasharray":k?
"-":""}).drag(b.makeMove(this),b.start,b.up(this));var k=.05*this.model.width,p=f+l+m+k+p/2,m=e+m,l=.2*this.model.height,h=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(f,e+l).lineTo(f-h,e+l).toPath(a).attr("stroke-width",d);var g="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-h,e+l,7.5).attr("fill","white").attr("stroke",g);this.labels[0]=a.text(f-h,e+l,this.model.inputs[0]).attr("stroke",g);this.labels[0].node.setAttribute("class",
"intermediate");this.paths[3]=(new b.PathBuilder).moveTo(f,e+this.model.height-l).lineTo(f-h,e+this.model.height-l).toPath(a).attr("stroke-width",d);g="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(f-h,e+this.model.height-l,7.5).attr("fill","white").attr("stroke",g);this.labels[1]=a.text(f-h,e+this.model.height-l,this.model.inputs[1]).attr("stroke",g);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:p+h,y:m};this.outlines[3]=
(new b.PathBuilder).moveTo(p+k,m).lineTo(p+h,m).toPath(a).attr("stroke-width",d);null!=this.model.output&&(g="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(p+h,m,7.5).attr("fill","white").attr("stroke",g),this.labels[2]=a.text(p+h,m,this.model.output).attr("stroke",g),this.labels[2].node.setAttribute("class","intermediate"))};b.AndView=d;return b}(NAND||{});NAND=function(b){function d(a){this.id=a;this.inputs=[];this.outputs=[];this.wires=[]}d.prototype.traverse=function(a){this.inputs.map(function(b,d){b.traverse(a,d,0)})};d.prototype.layout=function(a,p){var d=null,l=null;this.traverse(function(a,b,e){if(null==d||b>d)d=b;if(null==l||e>l)l=e});var m=[];this.traverse(function(a,b,e){a.seen||(a.seen=!0,m.push({node:a,row:b,column:e,dx:0,dy:0}))});for(var f=0,e=0;e<m.length;e++){var k=m[e],h=k.node;k.row+=f;if(null!=h.inputs){var g=function(a){if(null!=
a)for(var b=0;b<m.length;b++){var e=m[b];if(e.node.id==a.id)return e}return null},n=g(h.inputs[0]),h=g(h.inputs[1]);null!=n&&null!=h?(k.row=Math.round((n.row+h.row)/2),f++):null!=n&&null==h&&(k.row=n.row)}}for(h=!0;h;)for(h=!1,f=[],e=0;e<m.length;e++){k=m[e];for(n=0;n<f.length;n++)if(f[n].row==k.row&&f[n].column==k.column&&f[n].node.id!=k.node.id){k.column++;h=!0;break}if(h)break;f.push(k)}for(var u=this,r=[],e=0;e<m.length;e++){k=m[e];h=k.node;f=null;switch(h.kind){case "source":n={viewModel:k,value:k.node.value?
"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();p(u,r,l)}};f=new b.SourceView(h,n);k.options=n;break;case "sink":n={viewModel:k,value:h.evaluate()?"1":"0"};f=new b.SinkView(n);k.options=n;break;case "delay":f=new b.DelayView({viewModel:k});break;case "fanout":f=new b.FanOutView({viewModel:k,node:h});break;case "gate":n={viewModel:k,id:h.id,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:"not"==h.gate?[h.inputs[0].evaluate()?"1":
"0"]:[h.inputs[0].evaluate()?"1":"0",h.inputs[1].evaluate()?"1":"0"],output:h.evaluate()?"1":"0"};k.options=n;switch(h.gate){case "not":f=new b.GateView(new b.NotView(n));break;case "nand":f=new b.NandView(n);break;case "and":f=new b.GateView(new b.AndView(n));break;case "nor":f=new b.NorView(n);break;case "or":f=new b.OrView(n);break;case "xor":f=new b.GateView(new b.XorView(n));break;default:throw"gate";}break;default:throw"kind";}null!=f&&r.push({node:h,view:f})}g=n=null;for(e=0;e<r.length;e++){f=
r[e].view;k=f.bounds();if(null==n||k.width>n)n=k.width;if(null==g||k.height>g)g=k.height}var n=n+10,g=g+10,t=a.width/2-(l-1)*n/2,v=a.height/2-(d-1)*g/2;this.dx=n;this.dy=g;this.cx=t;this.cy=v;for(e=0;e<r.length;e++)h=r[e].node,f=r[e].view,k=f.model.viewModel,h=v+k.row*g,f.model.x=t+k.column*n,f.model.y=h,f.render(a);this.models=m;this.layoutWires(a);return{nodeViews:r,maxDepth:l}};d.prototype.layoutWires=function(a){for(var p=0;p<this.wires.length;p++)this.wires[p].remove();this.wires=[];for(var d=
this.dx,l=this.dy,m=this.cx,f=this.cy,e=this,p=0;p<this.models.length;p++){var k=this.models[p],h=k.node;null!=h.outputs&&h.outputs.map(function(g){for(var h=[],p=0;p<e.models.length;p++){var r=e.models[p];r.node.id==g.id&&h.push(r)}if(1!=h.length)throw console.log(h),"outputs";g=h[0];var h=k.options?k.options.x+k.dx:m+k.column*d,p=k.options?k.options.y+k.dy:f+k.row*l,r=g.options?g.options.x+g.dx:m+g.column*d,t=g.options?g.options.y+g.dy:f+g.row*l,v="gate"==g.node.kind?-48:0;g="gate"==g.node.kind?
-5:0;e.wires.push((new b.PathBuilder).moveTo(h,p).lineTo(r+v,p).lineTo(r+v,t<p?t-g:t+g).toPath(a).toBack())})}};d.prototype.layout2=function(a,p){function d(a){for(var b=0;b<k.length;b++)if(k[b].node.id==a.id)return k[b];throw"node";}var l=a.width/2,m=a.height/2;c.Expression.fromConstant(0);c.Expression.fromConstant(0);c.Expression.fromConstant(a.width);c.Expression.fromConstant(a.height);var f=[],e=0,k=[],h=null;this.traverse(function(a,b,h){a.seen||(a.seen=!0,a={node:a,dx:0,dy:0,constraints:{x:new c.Variable({name:a.kind+
a.id+".x"}),y:new c.Variable({name:a.kind+a.id+".y"})}},k.push(a));if(null==e||h>e)e=h});var g=new c.SimplexSolver;k.map(function(a){var b=a.node.inputs;if(null!=b&&0<b.length){for(var e=0;e<b.length;e++){var h=d(b[e]);g.addConstraint(new c.Inequality(c.plus(h.constraints.x,110),c.LEQ,a.constraints.x));if(0<e){var f=d(b[e-1]);g.addConstraint(new c.Inequality(c.plus(f.constraints.y,80),c.LEQ,h.constraints.y))}}e=d(b[0]);1==b.length?g.addConstraint(new c.Equation(a.constraints.y,e.constraints.y)):(b=
d(b[b.length-1]),b=c.plus(c.divide(c.minus(b.constraints.y,e.constraints.y),2),e.constraints.y),g.addConstraint(new c.Equation(a.constraints.y,b)))}else g.addConstraint(new c.Equation(a.constraints.x,0))});h=null;this.inputs.map(function(a){a=d(a);null!=h&&g.addConstraint(new c.Inequality(c.plus(h.constraints.y,30),c.LEQ,a.constraints.y));h=a});g.solve();var n=null,u=null,r=null,t=null;k.map(function(a){var b=a.constraints.x.value;a=a.constraints.y.value;if(null==n||b<n)n=b;if(null==u||a<u)u=a;if(null==
r||b>r)r=b;if(null==t||a>t)t=a});var r=r+n,t=t+u,n=l-r/2,u=m-t/2,v=this;k.map(function(h){var g=h.node,k=h.constraints,l=null;switch(g.kind){case "source":h.options={viewModel:h,value:h.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();p(v,f,e)},x:n+k.x.value,y:u+k.y.value};l=new b.SourceView(g,h.options);break;case "gate":h.options={viewModel:h,id:g.id,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:[g.inputs[0].evaluate()?
"1":"0",g.inputs[1].evaluate()?"1":"0"],output:g.evaluate()?"1":"0",x:n+k.x.value,y:u+k.y.value};l=new b.GateView(new b.NandView(h.options));break;case "sink":h.options={viewModel:h,value:g.evaluate()?"1":"0",x:n+k.x.value,y:u+k.y.value},l=new b.SinkView(h.options)}null!=l&&(l.render(a),f.push({node:g,view:l}))});this.models=k;this.layoutWires(a);return{nodeViews:f,maxDepth:e}};b.Circuit=d;return b}(NAND||{});NAND=function(b){function d(a){this.id=a;this.kind="delay";this.inputs=[];this.outputs=[]}d.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d);this.outputs.map(function(l){l.traverse(a,b,d+1)})};d.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.Delay=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a}d.prototype.render=function(a){};b.DelayView=d;return b}(NAND||{});NAND=function(b){function d(a){this.id=a;this.kind="fanout";this.inputs=[];this.outputs=[]}d.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d);this.outputs.map(function(l){l.traverse(a,b,d+1)})};d.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.FanOut=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a}d.prototype.render=function(a){};d.prototype.bounds=function(){return{width:10,height:10}};b.FanOutView=d;return b}(NAND||{});NAND=function(b){function d(a,b,d){this.id=a;this.kind="gate";this.gate=b;this.logic=d;this.inputs=[];this.outputs=[]}d.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d);this.outputs.map(function(l){l.traverse(a,b,d+1)})};d.prototype.evaluate=function(){if("not"==this.gate&&1!=this.inputs.length||"not"!=this.gate&&2>this.inputs.length)throw"inputs";var a=[];this.inputs.map(function(b){a.push(b.evaluate())});return this.logic(a)};
b.Gate=d;return b}(NAND||{});NAND=function(b){function d(a){this.delegate=a;this.model=a.model}d.prototype.render=function(a){this.delegate.render(a)};d.prototype.update=function(){for(var a=this.delegate.model.inputs,b=this.delegate.model.output,d=this.delegate.labels,l=this.delegate.outlines,m=this.delegate.paths,f="?"==a[0],e=0;e<a.length;e++){var k="?"==a[e]?"black":"0"==a[e]?"#a00":"#0a0";d[e].attr("text",a[e]).attr("stroke",k);l[e].attr("stroke",k)}d[a.length].attr("text",b).attr("stroke","?"==b?"black":"0"==b?"#a00":"#0a0");
l[a.length].attr("stroke","?"==b?"black":"0"==b?"#a00":"#0a0");for(e=0;e<m.length;e++)null!=m[e]&&m[e].attr("stroke-dasharray",f?"-":"")};d.prototype.bounds=function(){return{width:1.4*this.delegate.model.width,height:1.1*this.delegate.model.height}};b.GateView=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var d=this.model.heavyStrokeWidth,q=this.model.lightStrokeWidth,l=this.model.width/2,m=this.model.height/2,f=this.model.x-l,e=this.model.y-m,k="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(f,e).lineTo(f+l,e).arc(1,1,0,0,1,f+l,e+this.model.height).lineTo(f,e+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":d*(k?.5:1),"stroke-dasharray":k?
"-":""}).drag(b.makeMove(this),b.start,b.up(this));var h=.05*this.model.width,d=f+l+m+h+d/2,m=e+m;this.paths[1]=a.circle(d,m,h).attr({fill:"white","stroke-width":q*(k?.5:1),"stroke-dasharray":k?"-":""});k=.2*this.model.height;l=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(f,e+k).lineTo(f-l,e+k).toPath(a).attr("stroke-width",q);var g="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-l,e+k,7.5).attr("fill","white").attr("stroke",g);
this.labels[0]=a.text(f-l,e+k,this.model.inputs[0]).attr("stroke",g);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(f,e+this.model.height-k).lineTo(f-l,e+this.model.height-k).toPath(a).attr("stroke-width",q);g="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(f-l,e+this.model.height-k,7.5).attr("fill","white").attr("stroke",g);this.labels[1]=a.text(f-l,e+this.model.height-k,this.model.inputs[1]).attr("stroke",
g);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+l,y:m};this.paths[4]=(new b.PathBuilder).moveTo(d+h,m).lineTo(d+l,m).toPath(a).attr("stroke-width",q);null!=this.model.output&&(g="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(d+l,m,7.5).attr("fill","white").attr("stroke",g),this.labels[2]=a.text(d+l,m,this.model.output).attr("stroke",g),this.labels[2].node.setAttribute("class","intermediate"))};b.NandView=d;return b}(NAND||
{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var d=this.model.heavyStrokeWidth,q=this.model.lightStrokeWidth,l=this.model.width/2,m=this.model.height/2,f=this.model.x-l,e=this.model.y-m,k="?"==this.model.inputs[0],h=.4*this.model.width,g=2*this.model.width/3,n=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(f,e).lineTo(f+h,e).arc(g,g,0,0,1,f+this.model.width-n,e+m).arc(g,g,0,0,1,f+h,e+this.model.height).lineTo(f,
e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(k?.5:1),"stroke-dasharray":k?"-":""});this.paths[1]=(new b.PathBuilder).moveTo(f,e).arc(h,h,0,0,1,f,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(k?.5:1),"stroke-dasharray":k?"-":""});h=.05*this.model.width;d=f+l+m+h+d/2;m=e+m;a.circle(d,m,h).attr({fill:"white","stroke-width":q*(k?.5:1),"stroke-dasharray":k?"-":""});k=.2*this.model.height;l=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(f+l-1-.5*
l,e+k).lineTo(f-l,e+k).toPath(a).attr("stroke-width",q);g="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-l,e+k,7.5).attr("fill","white").attr("stroke",g);this.labels[0]=a.text(f-l,e+k,this.model.inputs[0]).attr("stroke",g);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(f+l-1-.5*l,e+this.model.height-k).lineTo(f-l,e+this.model.height-k).toPath(a).attr("stroke-width",q);g="?"==this.model.inputs[1]?
"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(f-l,e+this.model.height-k,7.5).attr("fill","white").attr("stroke",g);this.labels[1]=a.text(f-l,e+this.model.height-k,this.model.inputs[1]).attr("stroke",g);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+l,y:m};(new b.PathBuilder).moveTo(d+h,m).lineTo(d+l,m).toPath(a).attr("stroke-width",q);null!=this.model.output&&(g="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=
a.circle(d+l,m,7.5).attr("fill","white").attr("stroke",g),this.labels[2]=a.text(d+l,m,this.model.output).attr("stroke",g),this.labels[2].node.setAttribute("class","intermediate"))};d.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",
a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.NorView=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var d=this.model.heavyStrokeWidth,q=this.model.lightStrokeWidth,l=this.model.width/2,m=this.model.height/2,f=this.model.x-l,e=this.model.y-m,k="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(f,e).lineTo(f+this.model.width-20,e+m).lineTo(f,e+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":d*(k?.5:1),"stroke-dasharray":k?"-":""}).drag(b.makeMove(this),
b.start,b.up(this));var h=.05*this.model.width,d=f+l+m+h+d/2-11,l=e+m;this.paths[1]=a.circle(d,l,h).attr({fill:"white","stroke-width":q*(k?.5:1),"stroke-dasharray":k?"-":""});k=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(f,e+m).lineTo(f-k,e+m).toPath(a).attr("stroke-width",q);var g="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-k,e+m,7.5).attr("fill","white").attr("stroke",g);this.labels[0]=a.text(f-k,e+m,this.model.inputs[0]).attr("stroke",
g);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(d+h,l).lineTo(d+k,l).toPath(a).attr("stroke-width",q);null!=this.model.output&&(g="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[1]=a.circle(d+k,l,7.5).attr("fill","white").attr("stroke",g),this.labels[1]=a.text(d+k,l,this.model.output).attr("stroke",g),this.labels[1].node.setAttribute("class","intermediate"))};b.NotView=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var d=this.model.heavyStrokeWidth,q=this.model.lightStrokeWidth,l=this.model.width/2,m=this.model.height/2,f=this.model.x-l,e=this.model.y-m,k="?"==this.model.inputs[0],h=.4*this.model.width,g=2*this.model.width/3,n=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(f,e).lineTo(f+h,e).arc(g,g,0,0,1,f+this.model.width-n,e+m).arc(g,g,0,0,1,f+h,e+this.model.height).lineTo(f,
e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(k?.5:1),"stroke-dasharray":k?"-":""}).drag(b.makeMove(this),b.start,b.up(this));this.paths[1]=(new b.PathBuilder).moveTo(f,e).arc(h,h,0,0,1,f,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(k?.5:1),"stroke-dasharray":k?"-":""});k=.05*this.model.width;d=f+l+m+k+d/2;m=e+m;l=.2*this.model.height;h=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(f+h-1-.5*h,e+l).lineTo(f-h,e+l).toPath(a).attr("stroke-width",
q);g="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-h,e+l,7.5).attr("fill","white").attr("stroke",g);this.labels[0]=a.text(f-h,e+l,this.model.inputs[0]).attr("stroke",g);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(f+h-1-.5*h,e+this.model.height-l).lineTo(f-h,e+this.model.height-l).toPath(a).attr("stroke-width",q);g="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=
a.circle(f-h,e+this.model.height-l,7.5).attr("fill","white").attr("stroke",g);this.labels[1]=a.text(f-h,e+this.model.height-l,this.model.inputs[1]).attr("stroke",g);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+h,y:m};this.outlines[3]=(new b.PathBuilder).moveTo(d+k,m).lineTo(d+h,m).toPath(a).attr("stroke-width",q);null!=this.model.output&&(g="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(d+h,m,7.5).attr("fill","white").attr("stroke",
g),this.labels[2]=a.text(d+h,m,this.model.output).attr("stroke",g),this.labels[2].node.setAttribute("class","intermediate"))};d.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",
a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.OrView=d;return b}(NAND||{});NAND=function(b){function d(){this.commands=[]}d.prototype.moveTo=function(a,b){this.commands.push("M"+a+","+b);return this};d.prototype.lineTo=function(a,b){this.commands.push("L"+a+","+b);return this};d.prototype.arc=function(a,b,d,l,m,f,e){this.commands.push("A"+a+","+b+" "+d+" "+l+" "+m+" "+f+","+e);return this};d.prototype.close=function(){this.commands.push("Z");return this};d.prototype.toPath=function(a){return a.path(this.commands.join(" "))};b.PathBuilder=d;return b}(NAND||{});NAND=function(b){function d(a){this.id=a;this.kind="sink";this.inputs=[]}d.prototype.connect=function(a){this.inputs.push(a);a.outputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d)};d.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.Sink=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.paths=[];this.outlines=[];this.labels=[]}d.prototype.render=function(a){var d=this.model.value,q=this.model.x,l=this.model.y,m="?"==d?"black":"0"==d?"#a00":"#0a0";this.outlines[0]=a.rect(q-7,l-7,14,14).attr("stroke",m).attr("fill","white").drag(b.makeMove(this),b.start,b.up(this));this.labels[0]=a.text(q,l,d).attr("stroke",m).drag(b.makeMove(this),b.start,b.up(this));this.labels[0].node.setAttribute("class","output")};d.prototype.update=function(){var a=
this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};d.prototype.bounds=function(){return{width:14,height:14}};b.SinkView=d;return b}(NAND||{});NAND=function(b){function d(a,b){this.id=a;this.kind="source";this.value=b;this.outputs=[]}d.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d);this.outputs.map(function(l){l.traverse(a,b,d+1)})};d.prototype.evaluate=function(){return this.value};d.prototype.toggle=function(){this.value=!this.value};b.Source=d;return b}(NAND||{});NAND=function(b){function d(a,b){this.node=a;this.model=b;this.paths=[];this.labels=[];this.outlines=[]}d.prototype.render=function(a){var d=this.model.value,q=this.model.x,l=this.model.y,m="?"==d?"black":"0"==d?"#a00":"#0a0";this.outlines[0]=a.rect(q-7,l-7,14,14).attr("stroke",m).attr("fill","white").drag(b.makeMove(this),b.start,b.up(this));this.labels[0]=a.text(q,l,d).attr("stroke",m).click(this.model.click.bind(this)).drag(b.makeMove(this),b.start,b.up(this));this.labels[0].node.setAttribute("class",
"input")};d.prototype.update=function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};d.prototype.bounds=function(){return{width:14,height:14}};b.SourceView=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var d=this.model.heavyStrokeWidth,q=this.model.lightStrokeWidth,l=this.model.width/2,m=this.model.height/2,f=this.model.x-l,e=this.model.y-m,k="?"==this.model.inputs[0],h=.4*this.model.width,g=2*this.model.width/3,n=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(f,e).lineTo(f+h,e).arc(g,g,0,0,1,f+this.model.width-n,e+m).arc(g,g,0,0,1,f+h,e+this.model.height).lineTo(f,
e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(k?.5:1),"stroke-dasharray":k?"-":""}).drag(b.makeMove(this),b.start,b.up(this));this.paths[1]=(new b.PathBuilder).moveTo(f,e).arc(h,h,0,0,1,f,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(k?.5:1),"stroke-dasharray":k?"-":""});this.paths[2]=(new b.PathBuilder).moveTo(f-5,e).arc(h,h,0,0,1,f-5,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(k?.5:1),"stroke-dasharray":k?"-":""});k=.05*this.model.width;
d=f+l+m+k+d/2;m=e+m;l=.2*this.model.height;h=.3*this.model.width;this.paths[3]=(new b.PathBuilder).moveTo(f+h-1-.5*h,e+l).lineTo(f-h,e+l).toPath(a).attr("stroke-width",q);g="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-h,e+l,7.5).attr("fill","white").attr("stroke",g);this.labels[0]=a.text(f-h,e+l,this.model.inputs[0]).attr("stroke",g);this.labels[0].node.setAttribute("class","intermediate");this.paths[4]=(new b.PathBuilder).moveTo(f+h-1-.5*h,
e+this.model.height-l).lineTo(f-h,e+this.model.height-l).toPath(a).attr("stroke-width",q);g="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(f-h,e+this.model.height-l,7.5).attr("fill","white").attr("stroke",g);this.labels[1]=a.text(f-h,e+this.model.height-l,this.model.inputs[1]).attr("stroke",g);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+h,y:m};this.outlines[3]=(new b.PathBuilder).moveTo(d+k,m).lineTo(d+h,m).toPath(a).attr("stroke-width",
q);null!=this.model.output&&(g="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(d+h,m,7.5).attr("fill","white").attr("stroke",g),this.labels[2]=a.text(d+h,m,this.model.output).attr("stroke",g),this.labels[2].node.setAttribute("class","intermediate"))};b.XorView=d;return b}(NAND||{});NAND=function(b){function d(a){return!a.reduce(function(a,b){return a&&b})}function a(a,b,d){0>m?m=0:m>=d&&(m=d-1);a.traverse(function(a,e,h){b.map(function(b){var e=b.node,g=b.view;if(e.id==a.id){var f=h>m;switch(e.kind){case "gate":e.inputs.map(function(a,b){g.model.inputs[b]=f?"?":a.evaluate()?"1":"0"});g.model.output=f?"?":e.evaluate()?"1":"0";g.update();break;case "sink":g.model.value=m<d-1?"?":e.evaluate()?"1":"0",g.update()}}})});document.getElementById("time").textContent="t = "+m}function p(h){q=
new Raphael(0,0,window.innerWidth,window.innerHeight);var g=document.getElementById("controls");g.style.left=q.width/2-g.clientWidth/2+"px";g.style.top=q.height/2-g.clientHeight/2-150+"px";var g=0,n=new b.Source(g++,!1),p=new b.Source(g++,!1),r=new b.Source(g++,!1),t=new b.Source(g++,!1),v=new b.Sink(g++);new b.Sink(g++);new b.Sink(g++);new b.Delay(g++);new b.Delay(g++);new b.Delay(g++);new b.FanOut(g++);new b.FanOut(g++);new b.FanOut(g++);var x=new b.Gate(g++,"nand",d),y=new b.Gate(g++,"nand",d),
z=new b.Gate(g++,"nand",d);n.connect(x);p.connect(x);r.connect(y);t.connect(y);x.connect(z);y.connect(z);z.connect(v);l=new b.Circuit(g++);l.inputs=[n,p,r,t];l.outputs=[v];f=l.layout2(q,a);k=f.nodeViews;e=f.maxDepth;m=e-1;a(l,k,e);var w=document.getElementById("slider");w.max=e-1;w.value=m;h&&(document.getElementById("forward").addEventListener("click",function(){m++;a(l,k,e);w.value=m},!1),document.getElementById("backward").addEventListener("click",function(){m--;a(l,k,e);w.value=m},!1),document.getElementById("slider").addEventListener("input",
function(){m=this.value;a(l,k,e);w.value=m}))}var q,l;b.makeMove=function(a){return function(b,d){for(var e=0;e<a.paths.length;e++){var f=a.paths[e];null!=f&&f.translate(b-this.tx,d-this.ty)}for(e=0;e<a.labels.length;e++)f=a.labels[e],null!=f&&f.translate(b-this.tx,d-this.ty);for(e=0;e<a.outlines.length;e++)f=a.outlines[e],null!=f&&f.translate(b-this.tx,d-this.ty);this.tx=b;this.ty=d;a.model.viewModel.dx=b;a.model.viewModel.dy=d;l.layoutWires(q)}};b.start=function(){this.ty=this.tx=0};b.up=function(a){return function(){a.model.x+=
a.model.viewModel.dx;a.model.y+=a.model.viewModel.dy;a.model.viewModel.dx=0;a.model.viewModel.dy=0}};var m=0,f,e,k;window.addEventListener("load",function(){p(!0)});window.addEventListener("resize",function(){q.clear();p(!1)});return b}(NAND||{});
