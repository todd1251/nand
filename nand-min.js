var NAND=function(b){function f(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}f.prototype.render=function(a){var d=this.model.heavyStrokeWidth,A=this.model.lightStrokeWidth,m=this.model.width/2,h=this.model.height/2,k=this.model.x-m,e=this.model.y-h,l="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(k,e).lineTo(k+m,e).arc(1,1,0,0,1,k+m,e+this.model.height).lineTo(k,e+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?
"-":""}).drag(b.makeMove(this),b.start,b.up(this));var l=.05*this.model.width,d=k+m+h+l+d/2,h=e+h,m=.2*this.model.height,n=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k,e+m).lineTo(k-n,e+m).toPath(a).attr("stroke-width",A);var g="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-n,e+m,7.5).attr("fill","white").attr("stroke",g);this.labels[0]=a.text(k-n,e+m,this.model.inputs[0]).attr("stroke",g);this.labels[0].node.setAttribute("class",
"intermediate");this.paths[3]=(new b.PathBuilder).moveTo(k,e+this.model.height-m).lineTo(k-n,e+this.model.height-m).toPath(a).attr("stroke-width",A);g="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(k-n,e+this.model.height-m,7.5).attr("fill","white").attr("stroke",g);this.labels[1]=a.text(k-n,e+this.model.height-m,this.model.inputs[1]).attr("stroke",g);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+n,y:h};this.outlines[3]=
(new b.PathBuilder).moveTo(d+l,h).lineTo(d+n,h).toPath(a).attr("stroke-width",A);null!=this.model.output&&(g="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(d+n,h,7.5).attr("fill","white").attr("stroke",g),this.labels[2]=a.text(d+n,h,this.model.output).attr("stroke",g),this.labels[2].node.setAttribute("class","intermediate"))};b.AndView=f;return b}(NAND||{});NAND=function(b){function f(a){this.id=a;this.inputs=[];this.outputs=[];this.wires=[]}function a(a,b){this.x=a;this.y=b}function d(){this.grid=[];this.height=this.width=0}f.prototype.traverse=function(a){this.inputs.map(function(b,h){b.traverse(a,h,0)})};f.prototype.paths=function(){var a=[],b=[];this.traverse(function(h,k,e){b.splice(e);b.push(h);null==h.outputs&&a.push(b.slice())});return a};f.prototype.layout=function(a,m){var h=null,k=null;this.traverse(function(a,b,d){if(null==h||b>h)h=b;if(null==
k||d>k)k=d});var e=[];this.traverse(function(a,b,d){a.seen||(a.seen=!0,e.push({node:a,row:b,column:d,dx:0,dy:0}))});for(var l=0,n=0;n<e.length;n++){var g=e[n],d=g.node;g.row+=l;if(null!=d.inputs){var f=function(a){if(null!=a)for(var b=0;b<e.length;b++){var d=e[b];if(d.node.id==a.id)return d}return null},p=f(d.inputs[0]),d=f(d.inputs[1]);null!=p&&null!=d?(g.row=Math.round((p.row+d.row)/2),l++):null!=p&&null==d&&(g.row=p.row)}}for(d=!0;d;)for(d=!1,l=[],n=0;n<e.length;n++){g=e[n];for(p=0;p<l.length;p++)if(l[p].row==
g.row&&l[p].column==g.column&&l[p].node.id!=g.node.id){g.column++;d=!0;break}if(d)break;l.push(g)}for(var q=this,r=[],n=0;n<e.length;n++){g=e[n];d=g.node;l=null;switch(d.kind){case "source":p={viewModel:g,value:g.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();m(q,r,k)}};l=new b.SourceView(d,p);g.options=p;break;case "sink":p={viewModel:g,value:d.evaluate()?"1":"0"};l=new b.SinkView(p);g.options=p;break;case "delay":l=new b.DelayView({viewModel:g});
break;case "fanout":l=new b.FanOutView({viewModel:g,node:d});break;case "gate":p={viewModel:g,id:d.id,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:"not"==d.gate?[d.inputs[0].evaluate()?"1":"0"]:[d.inputs[0].evaluate()?"1":"0",d.inputs[1].evaluate()?"1":"0"],output:d.evaluate()?"1":"0"};g.options=p;switch(d.gate){case "not":l=new b.GateView(new b.NotView(p));break;case "nand":l=new b.NandView(p);break;case "and":l=new b.GateView(new b.AndView(p));break;case "nor":l=new b.NorView(p);
break;case "or":l=new b.OrView(p);break;case "xor":l=new b.GateView(new b.XorView(p));break;default:throw"gate";}break;default:throw"kind";}null!=l&&r.push({node:d,view:l})}f=p=null;for(n=0;n<r.length;n++){l=r[n].view;g=l.bounds();if(null==p||g.width>p)p=g.width;if(null==f||g.height>f)f=g.height}var p=p+10,f=f+10,t=a.width/2-(k-1)*p/2,u=a.height/2-(h-1)*f/2;this.dx=p;this.dy=f;this.cx=t;this.cy=u;for(n=0;n<r.length;n++)d=r[n].node,l=r[n].view,g=l.model.viewModel,d=u+g.row*f,l.model.x=t+g.column*p,
l.model.y=d,l.render(a);this.models=e;this.layoutWires(a);return{nodeViews:r,maxDepth:k}};f.prototype.layoutWires=function(a){for(var d=0;d<this.wires.length;d++)this.wires[d].remove();this.wires=[];for(var h=this.dx,k=this.dy,e=this.cx,l=this.cy,n=this,d=0;d<this.models.length;d++){var g=this.models[d],f=g.node;null!=f.outputs&&f.outputs.map(function(d,m){for(var q=[],r=0;r<n.models.length;r++){var t=n.models[r];t.node.id==d.id&&q.push(t)}if(1!=q.length)throw console.log(q),"outputs";var q=q[0],
u=g.options?g.options.x+g.dx:e+g.column*h,w=g.options?g.options.y+g.dy:l+g.row*k,z=q.options?q.options.x+q.dx:e+q.column*h,v=q.options?q.options.y+q.dy:l+q.row*k,r="gate"==q.node.kind?-48:0,t="gate"==q.node.kind?-5:0,B="gate"==q.node.kind?-48:0,y="gate"==q.node.kind?-12:0;"fanout"==f.kind&&0<m?d.inputs.map(function(d,e){d.id==f.id&&n.wires.push((new b.PathBuilder).moveTo(u,w).lineTo(u+(0==e?20:0),w).lineTo(u+(0==e?20:0),0==e?v+y:v-y).lineTo(z+B,0==e?v+y:v-y).toPath(a).toBack())}):n.wires.push((new b.PathBuilder).moveTo(u,
w).lineTo(z+r,w).lineTo(z+r,v<w?v-t:v+t).toPath(a).toBack())})}};f.prototype.layout2=function(a,d){function h(a){for(var b=0;b<g.length;b++)if(g[b].node.id==a.id)return g[b];throw"node";}var k=a.width/2,e=a.height/2;c.Expression.fromConstant(0);c.Expression.fromConstant(0);c.Expression.fromConstant(a.width);c.Expression.fromConstant(a.height);var l=[],n=0,g=[],f=null;this.traverse(function(a,b,d){a.seen||(a.seen=!0,a={node:a,dx:0,dy:0,constraints:{x:new c.Variable({name:a.kind+a.id+".x"}),y:new c.Variable({name:a.kind+
a.id+".y"})}},g.push(a));if(null==n||d>n)n=d});var x=new c.SimplexSolver;g.map(function(a){var b=a.node.inputs;if(null!=b&&0<b.length){for(var d=0;d<b.length;d++){var e=h(b[d]);x.addConstraint(new c.Inequality(c.plus(e.constraints.x,110),c.LEQ,a.constraints.x));if(0<d){var g=h(b[d-1]);x.addConstraint(new c.Inequality(c.plus(g.constraints.y,80),c.LEQ,e.constraints.y))}}d=h(b[0]);1==b.length?x.addConstraint(new c.Equation(a.constraints.y,d.constraints.y)):(b=h(b[b.length-1]),b=c.plus(c.divide(c.minus(b.constraints.y,
d.constraints.y),2),d.constraints.y),x.addConstraint(new c.Equation(a.constraints.y,b)))}else x.addConstraint(new c.Equation(a.constraints.x,0))});f=null;this.inputs.map(function(a){a=h(a);null!=f&&x.addConstraint(new c.Inequality(c.plus(f.constraints.y,30),c.LEQ,a.constraints.y));f=a});x.solve();for(var p=null,q=null,r=null,t=null,u=0;u<g.length;u++){var w=g[u],z=w.constraints.x.value,v=w.constraints.y.value;if(null==p||z<p)p=z;if(null==q||v<q)q=v;if(null==r||z>r)r=z;if(null==t||v>t)t=v;for(var B=
u+1;B<g.length;B++){var y=g[B],p=y.constraints.x.value,q=y.constraints.y.value;p==z&&q==v&&(console.log("conflict between "+w.node.id+" and "+y.node.id),y.constraints.y.value+=80)}}var p=k-(r+p)/2,q=e-(t+q)/2,D=this;g.map(function(e){var g=e.node,h=e.constraints,k=null;switch(g.kind){case "source":e.options={viewModel:e,value:e.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();d(D,l,n)},x:p+h.x.value,y:q+h.y.value};k=new b.SourceView(g,e.options);
break;case "gate":e.options={viewModel:e,id:g.id,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:[g.inputs[0].evaluate()?"1":"0",g.inputs[1].evaluate()?"1":"0"],output:g.evaluate()?"1":"0",x:p+h.x.value,y:q+h.y.value};k=new b.GateView(new b.NandView(e.options));switch(g.gate){case "not":k=new b.GateView(new b.NotView(e.options));break;case "nand":k=new b.GateView(new b.NandView(e.options));break;case "and":k=new b.GateView(new b.AndView(e.options));break;case "nor":k=new b.GateView(new b.NorView(e.options));
break;case "or":k=new b.GateView(new b.OrView(e.options));break;case "xor":k=new b.GateView(new b.XorView(e.options));break;default:throw"gate";}break;case "sink":e.options={viewModel:e,value:g.evaluate()?"1":"0",x:p+h.x.value,y:q+h.y.value};k=new b.SinkView(e.options);break;case "fanout":e.options={viewModel:e,x:p+h.x.value,y:q+h.y.value};k=new b.FanOutView(e.options);break;default:throw"kind";}null!=k&&(k.render(a),l.push({node:g,view:k}))});this.models=g;this.layoutWires(a);return{nodeViews:l,
maxDepth:n}};d.prototype.place=function(b,d){b>this.width-1&&(this.width=b+1);d>this.height-1&&(this.height=d+1);for(var h=0;h<this.grid.length;h++)for(;this.grid[h].length<this.width;)this.grid[h].push(null);for(;this.grid.length<this.height;){for(h=[];h.length<this.width;)h.push(null);this.grid.push(h)}if(null==this.grid[d][b])this.grid[d][b]=new a(b,d);else{if(d+1>=this.height||null==this.grid[d+1][b])return this.place(b,d+1);for(h=[];h.length<this.width;)h.push(null);this.grid.splice(d,0,h);this.grid[d][b]=
new a(b,d);this.height++;for(var k=0;k<this.height;k++)for(h=0;h<this.width;h++){var e=this.grid[k][h];null!=e&&(e.x=h,e.y=k)}}return this.grid[d][b]};f.prototype.layout3=function(a,m){var h=a.width/2,k=a.height/2,e=[],l=0,n=[];this.traverse(function(a,b,d){if(a.seen){a:{for(var e=0;e<n.length;e++)if(n[e].node.id==a.id){a=n[e];break a}throw"node";}if(d>a.depth||b>a.breadth)a.depth=d,a.breadth=b}else a.seen=!0,a={node:a,dx:0,dy:0,depth:d,breadth:b},n.push(a);if(null==l||d>l)l=d});var g=new d;n.map(function(a){a.location=
g.place(a.depth,a.breadth)});n.map(function(a){a.x=120*a.location.x;a.y=100*a.location.y});for(var f=null,x=null,p=0;p<n.length;p++){var q=n[p],r=q.x,q=q.y;if(null==f||r>f)f=r;if(null==x||q>x)x=q}var t=h-f/2,u=k-x/2,w=this;n.map(function(d){var g=d.node,h=null;switch(g.kind){case "source":d.options={viewModel:d,value:d.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();m(w,e,l)},x:t+d.x,y:u+d.y};h=new b.SourceView(g,d.options);break;case "gate":d.options=
{viewModel:d,id:g.id,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:[g.inputs[0].evaluate()?"1":"0",g.inputs[1].evaluate()?"1":"0"],output:g.evaluate()?"1":"0",x:t+d.x,y:u+d.y};h=new b.GateView(new b.NandView(d.options));switch(g.gate){case "not":h=new b.GateView(new b.NotView(d.options));break;case "nand":h=new b.GateView(new b.NandView(d.options));break;case "and":h=new b.GateView(new b.AndView(d.options));break;case "nor":h=new b.GateView(new b.NorView(d.options));break;case "or":h=
new b.GateView(new b.OrView(d.options));break;case "xor":h=new b.GateView(new b.XorView(d.options));break;default:throw"gate";}break;case "sink":d.options={viewModel:d,value:g.evaluate()?"1":"0",x:t+d.x,y:u+d.y};h=new b.SinkView(d.options);break;case "fanout":d.options={viewModel:d,x:t+d.x,y:u+d.y};h=new b.FanOutView(d.options);break;default:throw"kind";}null!=h&&(h.render(a),e.push({node:g,view:h}))});this.models=n;this.layoutWires(a);return{nodeViews:e,maxDepth:l}};b.Circuit=f;return b}(NAND||{});NAND=function(b){function f(a){this.id=a;this.kind="delay";this.inputs=[];this.outputs=[]}f.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};f.prototype.traverse=function(a,b,f){a(this,b,f);this.outputs.map(function(m){m.traverse(a,b,f+1)})};f.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.Delay=f;return b}(NAND||{});NAND=function(b){function f(a){this.model=a}f.prototype.render=function(a){};b.DelayView=f;return b}(NAND||{});NAND=function(b){function f(a){this.id=a;this.kind="fanout";this.inputs=[];this.outputs=[]}f.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};f.prototype.traverse=function(a,b,f){a(this,b,f);this.outputs.map(function(m){m.traverse(a,b,f+1)})};f.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.FanOut=f;return b}(NAND||{});NAND=function(b){function f(a){this.model=a}f.prototype.render=function(a){a.circle(this.model.x,this.model.y,3).attr("fill","black")};f.prototype.bounds=function(){return{width:10,height:10}};b.FanOutView=f;return b}(NAND||{});NAND=function(b){function f(a,b,f){this.id=a;this.kind="gate";this.gate=b;this.logic=f;this.inputs=[];this.outputs=[]}f.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};f.prototype.traverse=function(a,b,f){a(this,b,f);this.outputs.map(function(m){m.traverse(a,b,f+1)})};f.prototype.evaluate=function(){if("not"==this.gate&&1!=this.inputs.length||"not"!=this.gate&&2>this.inputs.length)throw"inputs";var a=[];this.inputs.map(function(b){a.push(b.evaluate())});return this.logic(a)};
b.Gate=f;return b}(NAND||{});NAND=function(b){function f(a){this.delegate=a;this.model=a.model}f.prototype.render=function(a){this.delegate.render(a)};f.prototype.update=function(){for(var a=this.delegate.model.inputs,b=this.delegate.model.output,f=this.delegate.labels,m=this.delegate.outlines,h=this.delegate.paths,k="?"==a[0],e=0;e<a.length;e++){var l="?"==a[e]?"black":"0"==a[e]?"#a00":"#0a0";f[e].attr("text",a[e]).attr("stroke",l);m[e].attr("stroke",l)}f[a.length].attr("text",b).attr("stroke","?"==b?"black":"0"==b?"#a00":"#0a0");
m[a.length].attr("stroke","?"==b?"black":"0"==b?"#a00":"#0a0");for(e=0;e<h.length;e++)null!=h[e]&&h[e].attr("stroke-dasharray",k?"-":"")};f.prototype.bounds=function(){return{width:1.4*this.delegate.model.width,height:1.1*this.delegate.model.height}};b.GateView=f;return b}(NAND||{});NAND=function(b){function f(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}f.prototype.render=function(a){var d=this.model.heavyStrokeWidth,f=this.model.lightStrokeWidth,m=this.model.width/2,h=this.model.height/2,k=this.model.x-m,e=this.model.y-h,l="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(k,e).lineTo(k+m,e).arc(1,1,0,0,1,k+m,e+this.model.height).lineTo(k,e+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?
"-":""}).drag(b.makeMove(this),b.start,b.up(this));var n=.05*this.model.width,d=k+m+h+n+d/2,h=e+h;this.paths[1]=a.circle(d,h,n).attr({fill:"white","stroke-width":f*(l?.5:1),"stroke-dasharray":l?"-":""});l=.2*this.model.height;m=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k,e+l).lineTo(k-m,e+l).toPath(a).attr("stroke-width",f);var g="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-m,e+l,7.5).attr("fill","white").attr("stroke",g);
this.labels[0]=a.text(k-m,e+l,this.model.inputs[0]).attr("stroke",g);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(k,e+this.model.height-l).lineTo(k-m,e+this.model.height-l).toPath(a).attr("stroke-width",f);g="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(k-m,e+this.model.height-l,7.5).attr("fill","white").attr("stroke",g);this.labels[1]=a.text(k-m,e+this.model.height-l,this.model.inputs[1]).attr("stroke",
g);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+m,y:h};this.paths[4]=(new b.PathBuilder).moveTo(d+n,h).lineTo(d+m,h).toPath(a).attr("stroke-width",f);null!=this.model.output&&(g="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(d+m,h,7.5).attr("fill","white").attr("stroke",g),this.labels[2]=a.text(d+m,h,this.model.output).attr("stroke",g),this.labels[2].node.setAttribute("class","intermediate"))};b.NandView=f;return b}(NAND||
{});NAND=function(b){function f(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}f.prototype.render=function(a){var d=this.model.heavyStrokeWidth,f=this.model.lightStrokeWidth,m=this.model.width/2,h=this.model.height/2,k=this.model.x-m,e=this.model.y-h,l="?"==this.model.inputs[0],n=.4*this.model.width,g=2*this.model.width/3,C=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(k,e).lineTo(k+n,e).arc(g,g,0,0,1,k+this.model.width-C,e+h).arc(g,g,0,0,1,k+n,e+this.model.height).lineTo(k,
e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""});this.paths[1]=(new b.PathBuilder).moveTo(k,e).arc(n,n,0,0,1,k,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""});n=.05*this.model.width;d=k+m+h+n+d/2;h=e+h;a.circle(d,h,n).attr({fill:"white","stroke-width":f*(l?.5:1),"stroke-dasharray":l?"-":""});l=.2*this.model.height;m=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k+m-1-.5*
m,e+l).lineTo(k-m,e+l).toPath(a).attr("stroke-width",f);g="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-m,e+l,7.5).attr("fill","white").attr("stroke",g);this.labels[0]=a.text(k-m,e+l,this.model.inputs[0]).attr("stroke",g);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(k+m-1-.5*m,e+this.model.height-l).lineTo(k-m,e+this.model.height-l).toPath(a).attr("stroke-width",f);g="?"==this.model.inputs[1]?
"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(k-m,e+this.model.height-l,7.5).attr("fill","white").attr("stroke",g);this.labels[1]=a.text(k-m,e+this.model.height-l,this.model.inputs[1]).attr("stroke",g);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+m,y:h};(new b.PathBuilder).moveTo(d+n,h).lineTo(d+m,h).toPath(a).attr("stroke-width",f);null!=this.model.output&&(g="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=
a.circle(d+m,h,7.5).attr("fill","white").attr("stroke",g),this.labels[2]=a.text(d+m,h,this.model.output).attr("stroke",g),this.labels[2].node.setAttribute("class","intermediate"))};f.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",
a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.NorView=f;return b}(NAND||{});NAND=function(b){function f(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}f.prototype.render=function(a){var d=this.model.heavyStrokeWidth,f=this.model.lightStrokeWidth,m=this.model.width/2,h=this.model.height/2,k=this.model.x-m,e=this.model.y-h,l="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(k,e).lineTo(k+this.model.width-20,e+h).lineTo(k,e+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""}).drag(b.makeMove(this),
b.start,b.up(this));var n=.05*this.model.width,d=k+m+h+n+d/2-11,m=e+h;this.paths[1]=a.circle(d,m,n).attr({fill:"white","stroke-width":f*(l?.5:1),"stroke-dasharray":l?"-":""});l=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k,e+h).lineTo(k-l,e+h).toPath(a).attr("stroke-width",f);var g="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-l,e+h,7.5).attr("fill","white").attr("stroke",g);this.labels[0]=a.text(k-l,e+h,this.model.inputs[0]).attr("stroke",
g);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(d+n,m).lineTo(d+l,m).toPath(a).attr("stroke-width",f);null!=this.model.output&&(g="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[1]=a.circle(d+l,m,7.5).attr("fill","white").attr("stroke",g),this.labels[1]=a.text(d+l,m,this.model.output).attr("stroke",g),this.labels[1].node.setAttribute("class","intermediate"))};b.NotView=f;return b}(NAND||{});NAND=function(b){function f(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}f.prototype.render=function(a){var d=this.model.heavyStrokeWidth,f=this.model.lightStrokeWidth,m=this.model.width/2,h=this.model.height/2,k=this.model.x-m,e=this.model.y-h,l="?"==this.model.inputs[0],n=.4*this.model.width,g=2*this.model.width/3,C=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(k,e).lineTo(k+n,e).arc(g,g,0,0,1,k+this.model.width-C,e+h).arc(g,g,0,0,1,k+n,e+this.model.height).lineTo(k,
e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""}).drag(b.makeMove(this),b.start,b.up(this));this.paths[1]=(new b.PathBuilder).moveTo(k,e).arc(n,n,0,0,1,k,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""});l=.05*this.model.width;d=k+m+h+l+d/2;h=e+h;m=.2*this.model.height;n=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(k+n-1-.5*n,e+m).lineTo(k-n,e+m).toPath(a).attr("stroke-width",
f);g="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-n,e+m,7.5).attr("fill","white").attr("stroke",g);this.labels[0]=a.text(k-n,e+m,this.model.inputs[0]).attr("stroke",g);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(k+n-1-.5*n,e+this.model.height-m).lineTo(k-n,e+this.model.height-m).toPath(a).attr("stroke-width",f);g="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=
a.circle(k-n,e+this.model.height-m,7.5).attr("fill","white").attr("stroke",g);this.labels[1]=a.text(k-n,e+this.model.height-m,this.model.inputs[1]).attr("stroke",g);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+n,y:h};this.outlines[3]=(new b.PathBuilder).moveTo(d+l,h).lineTo(d+n,h).toPath(a).attr("stroke-width",f);null!=this.model.output&&(g="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(d+n,h,7.5).attr("fill","white").attr("stroke",
g),this.labels[2]=a.text(d+n,h,this.model.output).attr("stroke",g),this.labels[2].node.setAttribute("class","intermediate"))};f.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",
a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.OrView=f;return b}(NAND||{});NAND=function(b){function f(){this.commands=[]}f.prototype.moveTo=function(a,b){this.commands.push("M"+a+","+b);return this};f.prototype.lineTo=function(a,b){this.commands.push("L"+a+","+b);return this};f.prototype.arc=function(a,b,f,m,h,k,e){this.commands.push("A"+a+","+b+" "+f+" "+m+" "+h+" "+k+","+e);return this};f.prototype.close=function(){this.commands.push("Z");return this};f.prototype.toPath=function(a){return a.path(this.commands.join(" "))};b.PathBuilder=f;return b}(NAND||{});NAND=function(b){function f(a){this.id=a;this.kind="sink";this.inputs=[]}f.prototype.connect=function(a){this.inputs.push(a);a.outputs.push(this)};f.prototype.traverse=function(a,b,f){a(this,b,f)};f.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.Sink=f;return b}(NAND||{});NAND=function(b){function f(a){this.model=a;this.paths=[];this.outlines=[];this.labels=[]}f.prototype.render=function(a){var d=this.model.value,f=this.model.x,m=this.model.y,h="?"==d?"black":"0"==d?"#a00":"#0a0";this.outlines[0]=a.rect(f-7,m-7,14,14).attr("stroke",h).attr("fill","white").drag(b.makeMove(this),b.start,b.up(this));this.labels[0]=a.text(f,m,d).attr("stroke",h).drag(b.makeMove(this),b.start,b.up(this));this.labels[0].node.setAttribute("class","output")};f.prototype.update=function(){var a=
this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};f.prototype.bounds=function(){return{width:14,height:14}};b.SinkView=f;return b}(NAND||{});NAND=function(b){function f(a,b){this.id=a;this.kind="source";this.value=b;this.outputs=[]}f.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};f.prototype.traverse=function(a,b,f){a(this,b,f);this.outputs.map(function(m){m.traverse(a,b,f+1)})};f.prototype.evaluate=function(){return this.value};f.prototype.toggle=function(){this.value=!this.value};b.Source=f;return b}(NAND||{});NAND=function(b){function f(a,b){this.node=a;this.model=b;this.paths=[];this.labels=[];this.outlines=[]}f.prototype.render=function(a){var d=this.model.value,f=this.model.x,m=this.model.y,h="?"==d?"black":"0"==d?"#a00":"#0a0";this.outlines[0]=a.rect(f-7,m-7,14,14).attr("stroke",h).attr("fill","white").drag(b.makeMove(this),b.start,b.up(this));this.labels[0]=a.text(f,m,d).attr("stroke",h).click(this.model.click.bind(this)).drag(b.makeMove(this),b.start,b.up(this));this.labels[0].node.setAttribute("class",
"input")};f.prototype.update=function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};f.prototype.bounds=function(){return{width:14,height:14}};b.SourceView=f;return b}(NAND||{});NAND=function(b){function f(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}f.prototype.render=function(a){var d=this.model.heavyStrokeWidth,f=this.model.lightStrokeWidth,m=this.model.width/2,h=this.model.height/2,k=this.model.x-m,e=this.model.y-h,l="?"==this.model.inputs[0],n=.4*this.model.width,g=2*this.model.width/3,C=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(k,e).lineTo(k+n,e).arc(g,g,0,0,1,k+this.model.width-C,e+h).arc(g,g,0,0,1,k+n,e+this.model.height).lineTo(k,
e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""}).drag(b.makeMove(this),b.start,b.up(this));this.paths[1]=(new b.PathBuilder).moveTo(k,e).arc(n,n,0,0,1,k,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""});this.paths[2]=(new b.PathBuilder).moveTo(k-5,e).arc(n,n,0,0,1,k-5,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(l?.5:1),"stroke-dasharray":l?"-":""});l=.05*this.model.width;
d=k+m+h+l+d/2;h=e+h;m=.2*this.model.height;n=.3*this.model.width;this.paths[3]=(new b.PathBuilder).moveTo(k+n-1-.5*n,e+m).lineTo(k-n,e+m).toPath(a).attr("stroke-width",f);g="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(k-n,e+m,7.5).attr("fill","white").attr("stroke",g);this.labels[0]=a.text(k-n,e+m,this.model.inputs[0]).attr("stroke",g);this.labels[0].node.setAttribute("class","intermediate");this.paths[4]=(new b.PathBuilder).moveTo(k+n-1-.5*n,
e+this.model.height-m).lineTo(k-n,e+this.model.height-m).toPath(a).attr("stroke-width",f);g="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(k-n,e+this.model.height-m,7.5).attr("fill","white").attr("stroke",g);this.labels[1]=a.text(k-n,e+this.model.height-m,this.model.inputs[1]).attr("stroke",g);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+n,y:h};this.outlines[3]=(new b.PathBuilder).moveTo(d+l,h).lineTo(d+n,h).toPath(a).attr("stroke-width",
f);null!=this.model.output&&(g="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(d+n,h,7.5).attr("fill","white").attr("stroke",g),this.labels[2]=a.text(d+n,h,this.model.output).attr("stroke",g),this.labels[2].node.setAttribute("class","intermediate"))};b.XorView=f;return b}(NAND||{});NAND=function(b){function f(a){return!a.reduce(function(a,b){return a&&b})}function a(a,b,d){0>h?h=0:h>=d&&(h=d-1);a.traverse(function(a,e,f){b.map(function(b){var e=b.node,g=b.view;if(e.id==a.id){var n=f>h;switch(e.kind){case "gate":e.inputs.map(function(a,b){g.model.inputs[b]=n?"?":a.evaluate()?"1":"0"});g.model.output=n?"?":e.evaluate()?"1":"0";g.update();break;case "sink":g.model.value=h<d-1?"?":e.evaluate()?"1":"0",g.update()}}})});document.getElementById("time").textContent="t = "+h}function d(d){A=
new Raphael(0,0,window.innerWidth,window.innerHeight);var g=document.getElementById("controls");g.style.left=A.width/2-g.clientWidth/2+"px";g.style.top=A.height/2-g.clientHeight/2-200+"px";var g=new b.Source("source1",!1),C=new b.Source("source2",!1),x=new b.Source("source3",!1),p=new b.Sink("sink1"),q=new b.Sink("sink2");new b.Sink("sink3");new b.Delay("delay1");new b.Delay("delay2");new b.Delay("delay3");var r=new b.FanOut("fanout1"),t=new b.FanOut("fanout2"),u=new b.FanOut("fanout3"),w=new b.FanOut("fanout4"),
z=new b.FanOut("fanout5"),v=new b.FanOut("fanout6"),B=new b.Gate("gate1","nand",f),y=new b.Gate("gate2","nand",f),D=new b.Gate("gate3","nand",f),F=new b.Gate("gate4","nand",f),G=new b.Gate("gate5","nand",f),H=new b.Gate("gate6","nand",f),I=new b.Gate("gate7","nand",f),J=new b.Gate("gate8","nand",f),K=new b.Gate("gate9","nand",f);m=new b.Circuit("circuit");g.connect(r);C.connect(t);x.connect(z);r.connect(B);r.connect(y);t.connect(B);t.connect(D);B.connect(u);u.connect(y);u.connect(D);u.connect(K);
y.connect(F);D.connect(F);F.connect(w);w.connect(G);w.connect(H);z.connect(G);z.connect(I);G.connect(v);v.connect(H);v.connect(I);v.connect(K);H.connect(J);I.connect(J);J.connect(p);K.connect(q);m.inputs=[g,C,x];m.outputs=[p,q];k=m.layout3(A,a);l=k.nodeViews;e=k.maxDepth;h=e-1;a(m,l,e);var E=document.getElementById("slider");E.max=e-1;E.value=h;d&&(document.getElementById("forward").addEventListener("click",function(){h++;a(m,l,e);E.value=h},!1),document.getElementById("backward").addEventListener("click",
function(){h--;a(m,l,e);E.value=h},!1),document.getElementById("slider").addEventListener("input",function(){h=this.value;a(m,l,e);E.value=h}))}var A,m;b.makeMove=function(a){return function(b,d){for(var e=0;e<a.paths.length;e++){var f=a.paths[e];null!=f&&f.translate(b-this.tx,d-this.ty)}for(e=0;e<a.labels.length;e++)f=a.labels[e],null!=f&&f.translate(b-this.tx,d-this.ty);for(e=0;e<a.outlines.length;e++)f=a.outlines[e],null!=f&&f.translate(b-this.tx,d-this.ty);this.tx=b;this.ty=d;a.model.viewModel.dx=
b;a.model.viewModel.dy=d;m.layoutWires(A)}};b.start=function(){this.ty=this.tx=0};b.up=function(a){return function(){a.model.x+=a.model.viewModel.dx;a.model.y+=a.model.viewModel.dy;a.model.viewModel.dx=0;a.model.viewModel.dy=0}};var h=0,k,e,l;window.addEventListener("load",function(){d(!0)});window.addEventListener("resize",function(){A.clear();d(!1)});return b}(NAND||{});
