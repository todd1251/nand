function NandView(l){this.model=l;this.outlines=[];this.labels=[];this.paths=[]}
NandView.prototype.render=function(l){var q=this.model.heavyStrokeWidth,z=this.model.lightStrokeWidth,m=this.model.width/2,v=this.model.height/2,p=this.model.x-m,t=this.model.y-v,u="?"==this.model.inputs[0];this.paths[0]=(new PathBuilder).moveTo(p,t).lineTo(p+m,t).arc(1,1,0,0,1,p+m,t+this.model.height).lineTo(p,t+this.model.height).close().toPath(l).attr({fill:"white","stroke-width":q*(u?.5:1),"stroke-dasharray":u?"-":""});var y=.05*this.model.width,q=p+m+v+y+q/2,v=t+v;l.circle(q,v,y).attr({fill:"white",
"stroke-width":z*(u?.5:1),"stroke-dasharray":u?"-":""});u=.2*this.model.height;m=.3*this.model.width;this.paths[2]=(new PathBuilder).moveTo(p,t+u).lineTo(p-m,t+u).toPath(l).attr("stroke-width",z);var w="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=l.circle(p-m,t+u,7.5).attr("fill","white").attr("stroke",w);this.labels[0]=l.text(p-m,t+u,this.model.inputs[0]).attr("stroke",w);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new PathBuilder).moveTo(p,
t+this.model.height-u).lineTo(p-m,t+this.model.height-u).toPath(l).attr("stroke-width",z);w="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=l.circle(p-m,t+this.model.height-u,7.5).attr("fill","white").attr("stroke",w);this.labels[1]=l.text(p-m,t+this.model.height-u,this.model.inputs[1]).attr("stroke",w);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:q+m,y:v};(new PathBuilder).moveTo(q+y,v).lineTo(q+m,v).toPath(l).attr("stroke-width",
z);null!=this.model.output&&(w="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=l.circle(q+m,v,7.5).attr("fill","white").attr("stroke",w),this.labels[2]=l.text(q+m,v,this.model.output).attr("stroke",w),this.labels[2].node.setAttribute("class","intermediate"))};
NandView.prototype.update=function(){var l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",l);this.outlines[0].attr("stroke",l);l="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",l);this.outlines[1].attr("stroke",l);l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",
l);this.outlines[2].attr("stroke",l);l="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",l?"-":"");this.paths[2].attr("stroke-dasharray",l?"-":"");this.paths[3].attr("stroke-dasharray",l?"-":"")};var NAND=function(l){function q(){this.commands=[]}q.prototype.moveTo=function(l,m){this.commands.push("M"+l+","+m);return this};q.prototype.lineTo=function(l,m){this.commands.push("L"+l+","+m);return this};q.prototype.arc=function(l,m,q,p,t,u,y){this.commands.push("A"+l+","+m+" "+q+" "+p+" "+t+" "+u+","+y);return this};q.prototype.close=function(){this.commands.push("Z");return this};q.prototype.toPath=function(l){return l.path(this.commands.join(" "))};l.PathBuilder=q;return l}(NAND||{});NAND=function(l){function q(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}function z(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}function m(){this.ty=this.tx=0}function v(a){return function(b,k){for(var g=0;g<a.paths.length;g++){var h=a.paths[g];null!=h&&h.translate(b-this.tx,k-this.ty)}for(g=0;g<a.labels.length;g++)h=a.labels[g],null!=h&&h.translate(b-this.tx,k-this.ty);for(g=0;g<a.outlines.length;g++)h=a.outlines[g],null!=h&&h.translate(b-this.tx,k-this.ty);this.tx=
b;this.ty=k;a.model.viewModel.dx=b;a.model.viewModel.dy=k;A.layoutWires()}}function p(a){return function(){a.model.x+=a.model.viewModel.dx;a.model.y+=a.model.viewModel.dy;a.model.viewModel.dx=0;a.model.viewModel.dy=0}}function t(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}function u(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}function y(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}function w(a,b,k){this.id=a;this.kind="gate";this.gate=b;this.logic=
k;this.inputs=[];this.outputs=[]}function B(a,b){this.id=a;this.kind="source";this.value=b;this.outputs=[]}function D(a){this.id=a;this.kind="sink";this.inputs=[]}function E(a){this.id=a;this.kind="delay";this.inputs=[];this.outputs=[]}function C(a){this.id=a;this.kind="fanout";this.inputs=[];this.outputs=[]}function M(a){return a.reduce(function(a,k){return a&&k})}function O(a){return a.reduce(function(a,k){return a||k})}function N(a){return a.reduce(function(a,k){return a^k})}function I(a,b){this.node=
a;this.model=b;this.paths=[];this.labels=[];this.outlines=[]}function J(a){this.model=a;this.paths=[];this.outlines=[];this.labels=[]}function K(a){this.model=a}function L(a){this.model=a}function G(a){this.id=a;this.inputs=[];this.outputs=[];this.wires=[]}function F(a,b,k){0>x?x=0:x>=k&&(x=k-1);a.traverse(function(a,h,c){b.map(function(b){var f=b.node,e=b.view;if(f.id==a.id){var h=c>x;switch(f.kind){case "gate":f.inputs.map(function(a,b){e.model.inputs[b]=h?"?":a.evaluate()?"1":"0"});e.model.output=
h?"?":f.evaluate()?"1":"0";e.update();break;case "sink":e.model.value=x<k-1?"?":f.evaluate()?"1":"0",e.update()}}})});document.getElementById("time").textContent="t = "+x}q.prototype.render=function(a){var b=this.model.heavyStrokeWidth,k=this.model.lightStrokeWidth,g=this.model.width/2,h=this.model.height/2,c=this.model.x-g,d=this.model.y-h,f="?"==this.model.inputs[0];this.paths[0]=(new l.PathBuilder).moveTo(c,d).lineTo(c+this.model.width-20,d+h).lineTo(c,d+this.model.height).close().toPath(a).attr({fill:"white",
"stroke-width":b*(f?.5:1),"stroke-dasharray":f?"-":""});var e=.05*this.model.width,b=c+g+h+e+b/2-11,g=d+h;a.circle(b,g,e).attr({fill:"white","stroke-width":k*(f?.5:1),"stroke-dasharray":f?"-":""});f=.3*this.model.width;this.paths[1]=(new l.PathBuilder).moveTo(c,d+h).lineTo(c-f,d+h).toPath(a).attr("stroke-width",k);var n="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(c-f,d+h,7.5).attr("fill","white").attr("stroke",n);this.labels[0]=a.text(c-f,d+
h,this.model.inputs[0]).attr("stroke",n);this.labels[0].node.setAttribute("class","intermediate");this.outputWire={x:b+f,y:g};(new l.PathBuilder).moveTo(b+e,g).lineTo(b+f,g).toPath(a).attr("stroke-width",k);null!=this.model.output&&(n="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[1]=a.circle(b+f,g,7.5).attr("fill","white").attr("stroke",n),this.labels[1]=a.text(b+f,g,this.model.output).attr("stroke",n),this.labels[1].node.setAttribute("class","intermediate"))};
q.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[1].attr("text",this.model.output).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"")};
var H,A;z.prototype.render=function(a){var b=this.model.heavyStrokeWidth,k=this.model.lightStrokeWidth,g=this.model.width/2,h=this.model.height/2,c=this.model.x-g,d=this.model.y-h,f="?"==this.model.inputs[0];this.paths[0]=(new l.PathBuilder).moveTo(c,d).lineTo(c+g,d).arc(1,1,0,0,1,c+g,d+this.model.height).lineTo(c,d+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":b*(f?.5:1),"stroke-dasharray":f?"-":""}).drag(v(this),m,p(this));var f=.05*this.model.width,b=c+g+h+f+b/2,h=d+h,
g=.2*this.model.height,e=.3*this.model.width;this.paths[2]=(new l.PathBuilder).moveTo(c,d+g).lineTo(c-e,d+g).toPath(a).attr("stroke-width",k);var n="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(c-e,d+g,7.5).attr("fill","white").attr("stroke",n);this.labels[0]=a.text(c-e,d+g,this.model.inputs[0]).attr("stroke",n);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new l.PathBuilder).moveTo(c,d+this.model.height-g).lineTo(c-e,
d+this.model.height-g).toPath(a).attr("stroke-width",k);n="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(c-e,d+this.model.height-g,7.5).attr("fill","white").attr("stroke",n);this.labels[1]=a.text(c-e,d+this.model.height-g,this.model.inputs[1]).attr("stroke",n);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:b+e,y:h};this.outlines[3]=(new l.PathBuilder).moveTo(b+f,h).lineTo(b+e,h).toPath(a).attr("stroke-width",k);null!=
this.model.output&&(n="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(b+e,h,7.5).attr("fill","white").attr("stroke",n),this.labels[2]=a.text(b+e,h,this.model.output).attr("stroke",n),this.labels[2].node.setAttribute("class","intermediate"))};z.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==
this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":
"")};t.prototype.render=function(a){var b=this.model.heavyStrokeWidth,k=this.model.lightStrokeWidth,g=this.model.width/2,h=this.model.height/2,c=this.model.x-g,d=this.model.y-h,f="?"==this.model.inputs[0],e=.4*this.model.width,n=2*this.model.width/3,m=.15*this.model.width;this.paths[0]=(new l.PathBuilder).moveTo(c,d).lineTo(c+e,d).arc(n,n,0,0,1,c+this.model.width-m,d+h).arc(n,n,0,0,1,c+e,d+this.model.height).lineTo(c,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(f?.5:1),"stroke-dasharray":f?
"-":""});this.paths[1]=(new l.PathBuilder).moveTo(c,d).arc(e,e,0,0,1,c,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(f?.5:1),"stroke-dasharray":f?"-":""});e=.05*this.model.width;b=c+g+h+e+b/2;h=d+h;a.circle(b,h,e).attr({fill:"white","stroke-width":k*(f?.5:1),"stroke-dasharray":f?"-":""});f=.2*this.model.height;g=.3*this.model.width;this.paths[2]=(new l.PathBuilder).moveTo(c+g-1-.5*g,d+f).lineTo(c-g,d+f).toPath(a).attr("stroke-width",k);n="?"==this.model.inputs[0]?"black":"0"==
this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(c-g,d+f,7.5).attr("fill","white").attr("stroke",n);this.labels[0]=a.text(c-g,d+f,this.model.inputs[0]).attr("stroke",n);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new l.PathBuilder).moveTo(c+g-1-.5*g,d+this.model.height-f).lineTo(c-g,d+this.model.height-f).toPath(a).attr("stroke-width",k);n="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(c-g,d+this.model.height-
f,7.5).attr("fill","white").attr("stroke",n);this.labels[1]=a.text(c-g,d+this.model.height-f,this.model.inputs[1]).attr("stroke",n);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:b+g,y:h};(new l.PathBuilder).moveTo(b+e,h).lineTo(b+g,h).toPath(a).attr("stroke-width",k);null!=this.model.output&&(n="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(b+g,h,7.5).attr("fill","white").attr("stroke",n),this.labels[2]=a.text(b+g,h,this.model.output).attr("stroke",
n),this.labels[2].node.setAttribute("class","intermediate"))};t.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?
"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};u.prototype.render=function(a){var b=this.model.heavyStrokeWidth,k=this.model.lightStrokeWidth,g=this.model.width/2,h=this.model.height/2,c=this.model.x-g,d=this.model.y-
h,f="?"==this.model.inputs[0],e=.4*this.model.width,n=2*this.model.width/3,q=.15*this.model.width;this.paths[0]=(new l.PathBuilder).moveTo(c,d).lineTo(c+e,d).arc(n,n,0,0,1,c+this.model.width-q,d+h).arc(n,n,0,0,1,c+e,d+this.model.height).lineTo(c,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(f?.5:1),"stroke-dasharray":f?"-":""}).drag(v(this),m,p(this));this.paths[1]=(new l.PathBuilder).moveTo(c,d).arc(e,e,0,0,1,c,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*
(f?.5:1),"stroke-dasharray":f?"-":""});f=.05*this.model.width;b=c+g+h+f+b/2;h=d+h;g=.2*this.model.height;e=.3*this.model.width;this.paths[2]=(new l.PathBuilder).moveTo(c+e-1-.5*e,d+g).lineTo(c-e,d+g).toPath(a).attr("stroke-width",k);n="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(c-e,d+g,7.5).attr("fill","white").attr("stroke",n);this.labels[0]=a.text(c-e,d+g,this.model.inputs[0]).attr("stroke",n);this.labels[0].node.setAttribute("class","intermediate");
this.paths[3]=(new l.PathBuilder).moveTo(c+e-1-.5*e,d+this.model.height-g).lineTo(c-e,d+this.model.height-g).toPath(a).attr("stroke-width",k);n="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(c-e,d+this.model.height-g,7.5).attr("fill","white").attr("stroke",n);this.labels[1]=a.text(c-e,d+this.model.height-g,this.model.inputs[1]).attr("stroke",n);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:b+e,y:h};this.outlines[3]=
(new l.PathBuilder).moveTo(b+f,h).lineTo(b+e,h).toPath(a).attr("stroke-width",k);null!=this.model.output&&(n="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(b+e,h,7.5).attr("fill","white").attr("stroke",n),this.labels[2]=a.text(b+e,h,this.model.output).attr("stroke",n),this.labels[2].node.setAttribute("class","intermediate"))};u.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",
this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",
a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};y.prototype.render=function(a){var b=this.model.heavyStrokeWidth,k=this.model.lightStrokeWidth,g=this.model.width/2,h=this.model.height/2,c=this.model.x-g,d=this.model.y-h,f="?"==this.model.inputs[0],e=.4*this.model.width,n=2*this.model.width/3,q=.15*this.model.width;this.paths[0]=(new l.PathBuilder).moveTo(c,d).lineTo(c+e,d).arc(n,n,0,0,1,c+this.model.width-q,d+h).arc(n,n,0,0,1,c+e,d+this.model.height).lineTo(c,
d+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(f?.5:1),"stroke-dasharray":f?"-":""}).drag(v(this),m,p(this));this.paths[1]=(new l.PathBuilder).moveTo(c,d).arc(e,e,0,0,1,c,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(f?.5:1),"stroke-dasharray":f?"-":""});this.paths[2]=(new l.PathBuilder).moveTo(c-5,d).arc(e,e,0,0,1,c-5,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(f?.5:1),"stroke-dasharray":f?"-":""});f=.05*this.model.width;b=c+g+h+
f+b/2;h=d+h;g=.2*this.model.height;e=.3*this.model.width;this.paths[3]=(new l.PathBuilder).moveTo(c+e-1-.5*e,d+g).lineTo(c-e,d+g).toPath(a).attr("stroke-width",k);n="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(c-e,d+g,7.5).attr("fill","white").attr("stroke",n);this.labels[0]=a.text(c-e,d+g,this.model.inputs[0]).attr("stroke",n);this.labels[0].node.setAttribute("class","intermediate");this.paths[4]=(new l.PathBuilder).moveTo(c+e-1-.5*e,d+this.model.height-
g).lineTo(c-e,d+this.model.height-g).toPath(a).attr("stroke-width",k);n="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(c-e,d+this.model.height-g,7.5).attr("fill","white").attr("stroke",n);this.labels[1]=a.text(c-e,d+this.model.height-g,this.model.inputs[1]).attr("stroke",n);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:b+e,y:h};this.outlines[3]=(new l.PathBuilder).moveTo(b+f,h).lineTo(b+e,h).toPath(a).attr("stroke-width",
k);null!=this.model.output&&(n="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(b+e,h,7.5).attr("fill","white").attr("stroke",n),this.labels[2]=a.text(b+e,h,this.model.output).attr("stroke",n),this.labels[2].node.setAttribute("class","intermediate"))};y.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",
a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",
a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"");this.paths[4].attr("stroke-dasharray",a?"-":"")};w.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};w.prototype.traverse=function(a,b,k){a(this,b,k);this.outputs.map(function(g){g.traverse(a,b,k+1)})};w.prototype.evaluate=function(){if("not"==this.gate&&1!=this.inputs.length||"not"!=this.gate&&2>this.inputs.length)throw"inputs";var a=[];this.inputs.map(function(b){a.push(b.evaluate())});return this.logic(a)};B.prototype.connect=
function(a){this.outputs.push(a);a.inputs.push(this)};B.prototype.traverse=function(a,b,k){a(this,b,k);this.outputs.map(function(g){g.traverse(a,b,k+1)})};B.prototype.evaluate=function(){return this.value};B.prototype.toggle=function(){this.value=!this.value};D.prototype.connect=function(a){this.inputs.push(a);a.outputs.push(this)};D.prototype.traverse=function(a,b,k){a(this,b,k)};D.prototype.evaluate=function(){return this.inputs[0].evaluate()};E.prototype.connect=function(a){this.outputs.push(a);
a.inputs.push(this)};E.prototype.traverse=function(a,b,k){a(this,b,k);this.outputs.map(function(g){g.traverse(a,b,k+1)})};E.prototype.evaluate=function(){return this.inputs[0].evaluate()};C.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};C.prototype.traverse=function(a,b,k){a(this,b,k);this.outputs.map(function(g){g.traverse(a,b,k+1)})};C.prototype.evaluate=function(){return this.inputs[0].evaluate()};I.prototype.render=function(a){var b=this.model.value,k=this.model.x,g=this.model.y,
h="?"==b?"black":"0"==b?"#a00":"#0a0";this.outlines[0]=a.rect(k-7,g-7,14,14).attr("stroke",h).attr("fill","white").drag(v(this),m,p(this));this.labels[0]=a.text(k,g,b).attr("stroke",h).click(this.model.click.bind(this)).drag(v(this),m,p(this));this.labels[0].node.setAttribute("class","input")};I.prototype.update=function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};J.prototype.render=function(a){var b=
this.model.value,k=this.model.x,g=this.model.y,h="?"==b?"black":"0"==b?"#a00":"#0a0";this.outlines[0]=a.rect(k-7,g-7,14,14).attr("stroke",h).attr("fill","white").drag(v(this),m,p(this));this.labels[0]=a.text(k,g,b).attr("stroke",h).drag(v(this),m,p(this));this.labels[0].node.setAttribute("class","output")};J.prototype.update=function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};K.prototype.render=function(a){};
L.prototype.render=function(a){var b=this.model.x,k=this.model.y;(new l.PathBuilder).moveTo(b+42,k).lineTo(b+42,k+10).toPath(a)};G.prototype.traverse=function(a){this.inputs.map(function(b,k){b.traverse(a,k,0)})};G.prototype.layout=function(a){var b=[],k=null;this.traverse(function(a,c,d){c>=b.length&&(b[c]=[]);b[c][d]={node:a};if(null==k||d>k)k=d});for(var g=a.width/2-90*(b[0].length-1)/2,h=a.height/2-60*(b.length-1)/2,c=0;c<b.length;c++)for(var d=0;d<b[c].length;d++){var f=b[c][d],e=f.node;f.x=
g+90*d;f.y=h+60*c;0<c&&b[c-1][d].node.id==e.id&&(b[c-1][d].skip=!0,null==b[c-1][d].skipCount&&(b[c-1][d].skipCount=1),f.skipCount=b[c-1][d].skipCount+1,f.x=b[c-1][d].x+f.x,f.y=b[c-1][d].y+f.y)}for(c=0;c<b.length;c++)for(d=0;d<b[c].length;d++)f=b[c][d],null!=f.skipCount&&(f.x/=f.skipCount,f.y/=f.skipCount);for(c=0;c<b.length;c++)for(d=0;d<b[c].length;d++)f=b[c][d],e=f.node,f.skip||null==e.outputs||e.outputs.map(function(c){for(var d=[],e=0;e<b.length;e++)for(var g=0;g<b[e].length;g++){var h=b[e][g];
h.node.id!=c.id||h.skip||d.push(h)}if(1!=d.length)throw console.log(d),"outputs";c=d[0];d="gate"==c.node.kind?-48:0;e="gate"==c.node.kind?-5:0;(new l.PathBuilder).moveTo(f.x,f.y).lineTo(c.x+d,f.y).lineTo(c.x+d,c.y<f.y?c.y-e:c.y+e).toPath(a)});var n=this,m=[];b.map(function(b){b.map(function(b){if(!b.skip){var c=b.x,d=b.y,e=b.node;b=null;switch(e.kind){case "source":b=new I({x:c,y:d,value:e.value?"1":"0",click:function(){e.toggle();this.model.value=e.value?"1":"0";this.update();F(n,m,k)}});b.render(a);
break;case "sink":b=new J({x:c,y:d,value:e.evaluate()?"1":"0"});b.render(a);break;case "delay":b=new K({x:c,y:d});b.render(a);break;case "fanout":b=new L({x:c,y:d});b.render(a);break;case "gate":c={id:e.id,x:c,y:d,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:"not"==e.gate?[e.inputs[0].evaluate()?"1":"0"]:[e.inputs[0].evaluate()?"1":"0",e.inputs[1].evaluate()?"1":"0"],output:e.evaluate()?"1":"0"};switch(e.gate){case "not":b=new q(c);break;case "nand":b=new NandView(c);break;case "and":b=
new z(c);break;case "nor":b=new t(c);break;case "or":b=new u(c);break;case "xor":b=new y(c);break;default:throw"gate";}b.render(a);break;default:throw"kind";}null!=b&&m.push({node:e,view:b})}})});return{nodeViews:m,maxDepth:k}};G.prototype.layout2=function(a){var b=null,k=null;this.traverse(function(a,c,e){console.log(a.kind+"["+a.id+"]: breadth="+c+", depth="+e);if(null==b||c>b)b=c;if(null==k||e>k)k=e});console.log("maxBreadth="+b+", maxDepth="+k);var g=[];this.traverse(function(a,b,c){a.seen||(console.log(a.kind+
"["+a.id+"]: breadth="+b+", depth="+c),a.seen=!0,a={node:a,row:b,column:c,dx:0,dy:0},console.log(a),g.push(a))});for(var h=!0;h;)for(var h=!1,c=[],d=0;d<g.length;d++){for(var f=g[d],e=0;e<c.length;e++)if(c[e].row==f.row&&c[e].column==f.column&&c[e].node.id!=f.node.id){console.log("conflict at "+f.row+","+f.column);f.row++;f.column++;h=!0;break}if(h)break;c.push(f)}h=a.width/2-90*(k-1)/2;c=a.height/2-60*(b-1)/2;this.dx=90;this.dy=60;this.cx=h;this.cy=c;this.models=g;this.layoutWires();for(var n=this,
l=[],d=0;d<g.length;d++){var f=g[d],m=h+90*f.column,p=c+60*f.row,e=f.node,r=null;switch(e.kind){case "source":m={viewModel:f,x:m,y:p,value:f.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();F(n,l,k)}};r=new I(e,m);f.options=m;r.render(a);break;case "sink":m={viewModel:f,x:m,y:p,value:e.evaluate()?"1":"0"};r=new J(m);f.options=m;r.render(a);break;case "delay":r=new K({x:m,y:p});r.render(a);break;case "fanout":r=new L({x:m,y:p});r.render(a);
break;case "gate":m={viewModel:f,id:e.id,x:m,y:p,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:"not"==e.gate?[e.inputs[0].evaluate()?"1":"0"]:[e.inputs[0].evaluate()?"1":"0",e.inputs[1].evaluate()?"1":"0"],output:e.evaluate()?"1":"0"};f.options=m;switch(e.gate){case "not":r=new q(m);break;case "nand":r=new NandView(m);break;case "and":r=new z(m);break;case "nor":r=new t(m);break;case "or":r=new u(m);break;case "xor":r=new y(m);break;default:throw"gate";}r.render(a);break;default:throw"kind";
}null!=r&&l.push({node:e,view:r})}return{nodeViews:l,maxDepth:k}};G.prototype.layoutWires=function(){for(var a=0;a<this.wires.length;a++)this.wires[a].remove();this.wires=[];for(var b=this.dx,k=this.dy,g=this.cx,h=this.cy,c=this,a=0;a<this.models.length;a++){var d=this.models[a],f=d.node;null!=f.outputs&&f.outputs.map(function(a){for(var f=[],m=0;m<c.models.length;m++){var p=c.models[m];p.node.id==a.id&&f.push(p)}if(1!=f.length)throw console.log(f),"outputs";a=f[0];var f=d.options?d.options.x+d.dx:
g+d.column*b,m=d.options?d.options.y+d.dy:h+d.row*k,p=a.options?a.options.x+a.dx:g+a.column*b,q=a.options?a.options.y+a.dy:h+a.row*k,r="gate"==a.node.kind?-48:0;a="gate"==a.node.kind?-5:0;c.wires.push((new l.PathBuilder).moveTo(f,m).lineTo(p+r,m).lineTo(p+r,q<m?q-a:q+a).toPath(H).toBack())})}};var x=0;window.addEventListener("load",function(){H=new Raphael(0,0,window.innerWidth,window.innerHeight);var a=document.getElementById("controls");a.style.left=H.width/2-a.clientWidth/2+"px";a.style.top=H.height/
2-a.clientHeight/2-150+"px";var a=0,b=new B(a++,!1),k=new B(a++,!1),g=new B(a++,!1),h=new D(a++),c=new D(a++),d=new D(a++);new E(a++);new E(a++);new E(a++);var f=new C(a++),e=new C(a++);new C(a++);new C(a++);var l=new w(a++,"xor",N),m=new w(a++,"and",M);new w(a++,"xor",N);new w(a++,"and",M);new w(a++,"or",O);b.connect(f);f.connect(h);k.connect(e);e.connect(c);f.connect(m);e.connect(m);m.connect(l);g.connect(l);l.connect(d);A=new G(a++);A.inputs=[b,k,g];A.outputs=[h,c];var a=A.layout2(H),p=a.nodeViews,
q=a.maxDepth;F(A,p,q);var r=document.getElementById("slider");r.max=q-1;document.getElementById("forward").addEventListener("click",function(){x++;F(A,p,q);r.value=x},!1);document.getElementById("backward").addEventListener("click",function(){x--;F(A,p,q);r.value=x},!1);document.getElementById("slider").addEventListener("input",function(){x=this.value;F(A,p,q);r.value=x})});return l}(NAND||{});
