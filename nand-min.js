var NAND=function(b){function c(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}c.prototype.render=function(a){var m=this.model.heavyStrokeWidth,c=this.model.lightStrokeWidth,e=this.model.width/2,k=this.model.height/2,f=this.model.x-e,d=this.model.y-k,h="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(f,d).lineTo(f+e,d).arc(1,1,0,0,1,f+e,d+this.model.height).lineTo(f,d+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":m*(h?.5:1),"stroke-dasharray":h?
"-":""}).drag(b.makeMove(this),b.start,b.up(this));var h=.05*this.model.width,m=f+e+k+h+m/2,k=d+k,e=.2*this.model.height,g=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(f,d+e).lineTo(f-g,d+e).toPath(a).attr("stroke-width",c);var l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-g,d+e,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(f-g,d+e,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class",
"intermediate");this.paths[3]=(new b.PathBuilder).moveTo(f,d+this.model.height-e).lineTo(f-g,d+this.model.height-e).toPath(a).attr("stroke-width",c);l="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(f-g,d+this.model.height-e,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(f-g,d+this.model.height-e,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:m+g,y:k};this.outlines[3]=
(new b.PathBuilder).moveTo(m+h,k).lineTo(m+g,k).toPath(a).attr("stroke-width",c);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(m+g,k,7.5).attr("fill","white").attr("stroke",l),this.labels[2]=a.text(m+g,k,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};c.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",
this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",
a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.AndView=c;return b}(NAND||{});NAND=function(b){function c(a){this.id=a;this.inputs=[];this.outputs=[];this.wires=[]}c.prototype.traverse=function(a){this.inputs.map(function(b,c){b.traverse(a,c,0)})};c.prototype.layout=function(a,m){var c=null,e=null;this.traverse(function(a,b,d){if(null==c||b>c)c=b;if(null==e||d>e)e=d});var k=[];this.traverse(function(a,b,d){a.seen||(a.seen=!0,k.push({node:a,row:b,column:d,dx:0,dy:0}))});for(var f=0,d=0;d<k.length;d++){var h=k[d],g=h.node;h.row+=f;if("sink"==g.kind)h.column=e;else if(null!=g.inputs){var l=
function(a){if(null!=a)for(var b=0;b<k.length;b++){var d=k[b];if(d.node.id==a.id)return d}return null},r=l(g.inputs[0]),g=l(g.inputs[1]);null!=r&&null!=g?(h.row=Math.round((r.row+g.row)/2),f++):null!=r&&null==g&&(h.row=r.row)}}for(g=!0;g;)for(g=!1,f=[],d=0;d<k.length;d++){h=k[d];for(r=0;r<f.length;r++)if(f[r].row==h.row&&f[r].column==h.column&&f[r].node.id!=h.node.id){h.column++;g=!0;break}if(g)break;f.push(h)}f=a.width/2-90*(e-1)/2;r=a.height/2-60*(c-1)/2;this.dx=90;this.dy=60;this.cx=f;this.cy=
r;this.models=k;this.layoutWires(a);for(var n=this,t=[],d=0;d<k.length;d++){var h=k[d],q=f+90*h.column,u=r+60*h.row,g=h.node,l=null;switch(g.kind){case "source":q={viewModel:h,x:q,y:u,value:h.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();m(n,t,e)}};l=new b.SourceView(g,q);h.options=q;l.render(a);break;case "sink":q={viewModel:h,x:q,y:u,value:g.evaluate()?"1":"0"};l=new b.SinkView(q);h.options=q;l.render(a);break;case "delay":l=new b.DelayView({x:q,
y:u});l.render(a);break;case "fanout":l=new b.FanOutView({x:q,y:u,node:g});l.render(a);break;case "gate":q={viewModel:h,id:g.id,x:q,y:u,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:"not"==g.gate?[g.inputs[0].evaluate()?"1":"0"]:[g.inputs[0].evaluate()?"1":"0",g.inputs[1].evaluate()?"1":"0"],output:g.evaluate()?"1":"0"};h.options=q;switch(g.gate){case "not":l=new b.NotView(q);break;case "nand":l=new b.NandView(q);break;case "and":l=new b.AndView(q);break;case "nor":l=new b.NorView(q);
break;case "or":l=new b.OrView(q);break;case "xor":l=new b.XorView(q);break;default:throw"gate";}l.render(a);break;default:throw"kind";}null!=l&&t.push({node:g,view:l})}return{nodeViews:t,maxDepth:e}};c.prototype.layoutWires=function(a){for(var m=0;m<this.wires.length;m++)this.wires[m].remove();this.wires=[];for(var c=this.dx,e=this.dy,k=this.cx,f=this.cy,d=this,m=0;m<this.models.length;m++){var h=this.models[m],g=h.node;null!=g.outputs&&g.outputs.map(function(m){for(var g=[],n=0;n<d.models.length;n++){var t=
d.models[n];t.node.id==m.id&&g.push(t)}if(1!=g.length)throw console.log(g),"outputs";m=g[0];var g=h.options?h.options.x+h.dx:k+h.column*c,n=h.options?h.options.y+h.dy:f+h.row*e,t=m.options?m.options.x+m.dx:k+m.column*c,q=m.options?m.options.y+m.dy:f+m.row*e,u="gate"==m.node.kind?-48:0;m="gate"==m.node.kind?-5:0;d.wires.push((new b.PathBuilder).moveTo(g,n).lineTo(t+u,n).lineTo(t+u,q<n?q-m:q+m).toPath(a).toBack())})}};b.Circuit=c;return b}(NAND||{});NAND=function(b){function c(a){this.id=a;this.kind="delay";this.inputs=[];this.outputs=[]}c.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};c.prototype.traverse=function(a,b,c){a(this,b,c);this.outputs.map(function(e){e.traverse(a,b,c+1)})};c.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.Delay=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a}c.prototype.render=function(a){};b.DelayView=c;return b}(NAND||{});NAND=function(b){function c(a){this.id=a;this.kind="fanout";this.inputs=[];this.outputs=[]}c.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};c.prototype.traverse=function(a,b,c){a(this,b,c);this.outputs.map(function(e){e.traverse(a,b,c+1)})};c.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.FanOut=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a}c.prototype.render=function(a){if("gate"==this.model.node.outputs[0].kind&&"gate"==this.model.node.outputs[1].kind){var m=this.model.x,c=this.model.y;(new b.PathBuilder).moveTo(m+42,c).lineTo(m+42,c+10).toPath(a)}};b.FanOutView=c;return b}(NAND||{});NAND=function(b){function c(a,b,c){this.id=a;this.kind="gate";this.gate=b;this.logic=c;this.inputs=[];this.outputs=[]}c.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};c.prototype.traverse=function(a,b,c){a(this,b,c);this.outputs.map(function(e){e.traverse(a,b,c+1)})};c.prototype.evaluate=function(){if("not"==this.gate&&1!=this.inputs.length||"not"!=this.gate&&2>this.inputs.length)throw"inputs";var a=[];this.inputs.map(function(b){a.push(b.evaluate())});return this.logic(a)};
b.Gate=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}c.prototype.render=function(a){var b=this.model.heavyStrokeWidth,c=this.model.lightStrokeWidth,e=this.model.width/2,k=this.model.height/2,f=this.model.x-e,d=this.model.y-k,h="?"==this.model.inputs[0];this.paths[0]=(new PathBuilder).moveTo(f,d).lineTo(f+e,d).arc(1,1,0,0,1,f+e,d+this.model.height).lineTo(f,d+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":b*(h?.5:1),"stroke-dasharray":h?
"-":""});var g=.05*this.model.width,b=f+e+k+g+b/2,k=d+k;a.circle(b,k,g).attr({fill:"white","stroke-width":c*(h?.5:1),"stroke-dasharray":h?"-":""});h=.2*this.model.height;e=.3*this.model.width;this.paths[2]=(new PathBuilder).moveTo(f,d+h).lineTo(f-e,d+h).toPath(a).attr("stroke-width",c);var l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-e,d+h,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(f-e,d+h,this.model.inputs[0]).attr("stroke",
l);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new PathBuilder).moveTo(f,d+this.model.height-h).lineTo(f-e,d+this.model.height-h).toPath(a).attr("stroke-width",c);l="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(f-e,d+this.model.height-h,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(f-e,d+this.model.height-h,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");
this.outputWire={x:b+e,y:k};(new PathBuilder).moveTo(b+g,k).lineTo(b+e,k).toPath(a).attr("stroke-width",c);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(b+e,k,7.5).attr("fill","white").attr("stroke",l),this.labels[2]=a.text(b+e,k,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};c.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":
"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",
a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.NandView=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}c.prototype.render=function(a){var c=this.model.heavyStrokeWidth,p=this.model.lightStrokeWidth,e=this.model.width/2,k=this.model.height/2,f=this.model.x-e,d=this.model.y-k,h="?"==this.model.inputs[0],g=.4*this.model.width,l=2*this.model.width/3,r=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(f,d).lineTo(f+g,d).arc(l,l,0,0,1,f+this.model.width-r,d+k).arc(l,l,0,0,1,f+g,d+this.model.height).lineTo(f,
d+this.model.height).toPath(a).attr({fill:"white","stroke-width":c*(h?.5:1),"stroke-dasharray":h?"-":""});this.paths[1]=(new b.PathBuilder).moveTo(f,d).arc(g,g,0,0,1,f,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":c*(h?.5:1),"stroke-dasharray":h?"-":""});g=.05*this.model.width;c=f+e+k+g+c/2;k=d+k;a.circle(c,k,g).attr({fill:"white","stroke-width":p*(h?.5:1),"stroke-dasharray":h?"-":""});h=.2*this.model.height;e=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(f+e-1-.5*
e,d+h).lineTo(f-e,d+h).toPath(a).attr("stroke-width",p);l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-e,d+h,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(f-e,d+h,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(f+e-1-.5*e,d+this.model.height-h).lineTo(f-e,d+this.model.height-h).toPath(a).attr("stroke-width",p);l="?"==this.model.inputs[1]?
"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(f-e,d+this.model.height-h,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(f-e,d+this.model.height-h,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:c+e,y:k};(new b.PathBuilder).moveTo(c+g,k).lineTo(c+e,k).toPath(a).attr("stroke-width",p);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=
a.circle(c+e,k,7.5).attr("fill","white").attr("stroke",l),this.labels[2]=a.text(c+e,k,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};c.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",
a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.NorView=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}c.prototype.render=function(a){var c=this.model.heavyStrokeWidth,p=this.model.lightStrokeWidth,e=this.model.width/2,k=this.model.height/2,f=this.model.x-e,d=this.model.y-k,h="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(f,d).lineTo(f+this.model.width-20,d+k).lineTo(f,d+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":c*(h?.5:1),"stroke-dasharray":h?"-":""});var g=.05*
this.model.width,c=f+e+k+g+c/2-11,e=d+k;a.circle(c,e,g).attr({fill:"white","stroke-width":p*(h?.5:1),"stroke-dasharray":h?"-":""});h=.3*this.model.width;this.paths[1]=(new b.PathBuilder).moveTo(f,d+k).lineTo(f-h,d+k).toPath(a).attr("stroke-width",p);var l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-h,d+k,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(f-h,d+k,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class",
"intermediate");this.outputWire={x:c+h,y:e};(new b.PathBuilder).moveTo(c+g,e).lineTo(c+h,e).toPath(a).attr("stroke-width",p);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[1]=a.circle(c+h,e,7.5).attr("fill","white").attr("stroke",l),this.labels[1]=a.text(c+h,e,this.model.output).attr("stroke",l),this.labels[1].node.setAttribute("class","intermediate"))};c.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?
"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[1].attr("text",this.model.output).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"")};b.NotView=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}c.prototype.render=function(a){var c=this.model.heavyStrokeWidth,p=this.model.lightStrokeWidth,e=this.model.width/2,k=this.model.height/2,f=this.model.x-e,d=this.model.y-k,h="?"==this.model.inputs[0],g=.4*this.model.width,l=2*this.model.width/3,r=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(f,d).lineTo(f+g,d).arc(l,l,0,0,1,f+this.model.width-r,d+k).arc(l,l,0,0,1,f+g,d+this.model.height).lineTo(f,
d+this.model.height).toPath(a).attr({fill:"white","stroke-width":c*(h?.5:1),"stroke-dasharray":h?"-":""}).drag(b.makeMove(this),b.start,b.up(this));this.paths[1]=(new b.PathBuilder).moveTo(f,d).arc(g,g,0,0,1,f,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":c*(h?.5:1),"stroke-dasharray":h?"-":""});h=.05*this.model.width;c=f+e+k+h+c/2;k=d+k;e=.2*this.model.height;g=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(f+g-1-.5*g,d+e).lineTo(f-g,d+e).toPath(a).attr("stroke-width",
p);l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-g,d+e,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(f-g,d+e,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(f+g-1-.5*g,d+this.model.height-e).lineTo(f-g,d+this.model.height-e).toPath(a).attr("stroke-width",p);l="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=
a.circle(f-g,d+this.model.height-e,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(f-g,d+this.model.height-e,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:c+g,y:k};this.outlines[3]=(new b.PathBuilder).moveTo(c+h,k).lineTo(c+g,k).toPath(a).attr("stroke-width",p);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(c+g,k,7.5).attr("fill","white").attr("stroke",
l),this.labels[2]=a.text(c+g,k,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};c.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",
a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.OrView=c;return b}(NAND||{});NAND=function(b){function c(){this.commands=[]}c.prototype.moveTo=function(a,b){this.commands.push("M"+a+","+b);return this};c.prototype.lineTo=function(a,b){this.commands.push("L"+a+","+b);return this};c.prototype.arc=function(a,b,c,e,k,f,d){this.commands.push("A"+a+","+b+" "+c+" "+e+" "+k+" "+f+","+d);return this};c.prototype.close=function(){this.commands.push("Z");return this};c.prototype.toPath=function(a){return a.path(this.commands.join(" "))};b.PathBuilder=c;return b}(NAND||{});NAND=function(b){function c(a){this.id=a;this.kind="sink";this.inputs=[]}c.prototype.connect=function(a){this.inputs.push(a);a.outputs.push(this)};c.prototype.traverse=function(a,b,c){a(this,b,c)};c.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.Sink=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a;this.paths=[];this.outlines=[];this.labels=[]}c.prototype.render=function(a){var c=this.model.value,p=this.model.x,e=this.model.y,k="?"==c?"black":"0"==c?"#a00":"#0a0";this.outlines[0]=a.rect(p-7,e-7,14,14).attr("stroke",k).attr("fill","white").drag(b.makeMove(this),b.start,b.up(this));this.labels[0]=a.text(p,e,c).attr("stroke",k).drag(b.makeMove(this),b.start,b.up(this));this.labels[0].node.setAttribute("class","output")};c.prototype.update=function(){var a=
this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};b.SinkView=c;return b}(NAND||{});NAND=function(b){function c(a,b){this.id=a;this.kind="source";this.value=b;this.outputs=[]}c.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};c.prototype.traverse=function(a,b,c){a(this,b,c);this.outputs.map(function(e){e.traverse(a,b,c+1)})};c.prototype.evaluate=function(){return this.value};c.prototype.toggle=function(){this.value=!this.value};b.Source=c;return b}(NAND||{});NAND=function(b){function c(a,b){this.node=a;this.model=b;this.paths=[];this.labels=[];this.outlines=[]}c.prototype.render=function(a){var c=this.model.value,p=this.model.x,e=this.model.y,k="?"==c?"black":"0"==c?"#a00":"#0a0";this.outlines[0]=a.rect(p-7,e-7,14,14).attr("stroke",k).attr("fill","white").drag(b.makeMove(this),b.start,b.up(this));this.labels[0]=a.text(p,e,c).attr("stroke",k).click(this.model.click.bind(this)).drag(b.makeMove(this),b.start,b.up(this));this.labels[0].node.setAttribute("class",
"input")};c.prototype.update=function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};b.SourceView=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}c.prototype.render=function(a){var c=this.model.heavyStrokeWidth,p=this.model.lightStrokeWidth,e=this.model.width/2,k=this.model.height/2,f=this.model.x-e,d=this.model.y-k,h="?"==this.model.inputs[0],g=.4*this.model.width,l=2*this.model.width/3,r=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(f,d).lineTo(f+g,d).arc(l,l,0,0,1,f+this.model.width-r,d+k).arc(l,l,0,0,1,f+g,d+this.model.height).lineTo(f,
d+this.model.height).toPath(a).attr({fill:"white","stroke-width":c*(h?.5:1),"stroke-dasharray":h?"-":""}).drag(b.makeMove(this),b.start,b.up(this));this.paths[1]=(new b.PathBuilder).moveTo(f,d).arc(g,g,0,0,1,f,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":c*(h?.5:1),"stroke-dasharray":h?"-":""});this.paths[2]=(new b.PathBuilder).moveTo(f-5,d).arc(g,g,0,0,1,f-5,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":c*(h?.5:1),"stroke-dasharray":h?"-":""});h=.05*this.model.width;
c=f+e+k+h+c/2;k=d+k;e=.2*this.model.height;g=.3*this.model.width;this.paths[3]=(new b.PathBuilder).moveTo(f+g-1-.5*g,d+e).lineTo(f-g,d+e).toPath(a).attr("stroke-width",p);l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-g,d+e,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(f-g,d+e,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class","intermediate");this.paths[4]=(new b.PathBuilder).moveTo(f+g-1-.5*g,
d+this.model.height-e).lineTo(f-g,d+this.model.height-e).toPath(a).attr("stroke-width",p);l="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(f-g,d+this.model.height-e,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(f-g,d+this.model.height-e,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:c+g,y:k};this.outlines[3]=(new b.PathBuilder).moveTo(c+h,k).lineTo(c+g,k).toPath(a).attr("stroke-width",
p);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(c+g,k,7.5).attr("fill","white").attr("stroke",l),this.labels[2]=a.text(c+g,k,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};c.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",
a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",
a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"");this.paths[4].attr("stroke-dasharray",a?"-":"")};b.XorView=c;return b}(NAND||{});NAND=function(b){function c(a){return a.reduce(function(a,b){return a&&b})}function a(a){return a.reduce(function(a,b){return a||b})}function m(a){return a.reduce(function(a,b){return a^b})}function p(a,b,c){0>d?d=0:d>=c&&(d=c-1);a.traverse(function(a,f,g){b.map(function(b){var f=b.node,e=b.view;if(f.id==a.id){var h=g>d;switch(f.kind){case "gate":f.inputs.map(function(a,b){e.model.inputs[b]=h?"?":a.evaluate()?"1":"0"});e.model.output=h?"?":f.evaluate()?"1":"0";e.update();break;case "sink":e.model.value=
d<c-1?"?":f.evaluate()?"1":"0",e.update()}}})});document.getElementById("time").textContent="t = "+d}function e(e){k=new Raphael(0,0,window.innerWidth,window.innerHeight);var n=document.getElementById("controls");n.style.left=k.width/2-n.clientWidth/2+"px";n.style.top=k.height/2-n.clientHeight/2-150+"px";var n=0,t=new b.Source(n++,!1),q=new b.Source(n++,!1),u=new b.Source(n++,!1),A=new b.Sink(n++),B=new b.Sink(n++),C=new b.Sink(n++);new b.Delay(n++);new b.Delay(n++);new b.Delay(n++);var w=new b.FanOut(n++),
x=new b.FanOut(n++);new b.FanOut(n++);new b.FanOut(n++);var y=new b.Gate(n++,"xor",m),z=new b.Gate(n++,"and",c);new b.Gate(n++,"xor",m);new b.Gate(n++,"and",c);new b.Gate(n++,"or",a);t.connect(w);w.connect(A);q.connect(x);x.connect(B);w.connect(z);x.connect(z);z.connect(y);u.connect(y);y.connect(C);f=new b.Circuit(n++);f.inputs=[t,q,u];f.outputs=[A,B];h=f.layout(k,p);l=h.nodeViews;g=h.maxDepth;p(f,l,g);var v=document.getElementById("slider");v.max=g-1;e&&(document.getElementById("forward").addEventListener("click",
function(){d++;p(f,l,g);v.value=d},!1),document.getElementById("backward").addEventListener("click",function(){d--;p(f,l,g);v.value=d},!1),document.getElementById("slider").addEventListener("input",function(){d=this.value;p(f,l,g);v.value=d}))}var k,f;b.makeMove=function(a){return function(b,c){for(var d=0;d<a.paths.length;d++){var e=a.paths[d];null!=e&&e.translate(b-this.tx,c-this.ty)}for(d=0;d<a.labels.length;d++)e=a.labels[d],null!=e&&e.translate(b-this.tx,c-this.ty);for(d=0;d<a.outlines.length;d++)e=
a.outlines[d],null!=e&&e.translate(b-this.tx,c-this.ty);this.tx=b;this.ty=c;a.model.viewModel.dx=b;a.model.viewModel.dy=c;f.layoutWires(k)}};b.start=function(){this.ty=this.tx=0};b.up=function(a){return function(){a.model.x+=a.model.viewModel.dx;a.model.y+=a.model.viewModel.dy;a.model.viewModel.dx=0;a.model.viewModel.dy=0}};var d=0,h,g,l;window.addEventListener("load",function(){e(!0)});window.addEventListener("resize",function(){k.clear();e(!1)});return b}(NAND||{});
