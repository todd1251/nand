var NAND=function(b){function c(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}c.prototype.render=function(a){var n=this.model.heavyStrokeWidth,c=this.model.lightStrokeWidth,h=this.model.width/2,k=this.model.height/2,e=this.model.x-h,d=this.model.y-k,f="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(e,d).lineTo(e+h,d).arc(1,1,0,0,1,e+h,d+this.model.height).lineTo(e,d+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":n*(f?.5:1),"stroke-dasharray":f?
"-":""}).drag(b.makeMove(this),b.start,b.up(this));var f=.05*this.model.width,n=e+h+k+f+n/2,k=d+k,h=.2*this.model.height,g=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(e,d+h).lineTo(e-g,d+h).toPath(a).attr("stroke-width",c);var l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(e-g,d+h,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(e-g,d+h,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class",
"intermediate");this.paths[3]=(new b.PathBuilder).moveTo(e,d+this.model.height-h).lineTo(e-g,d+this.model.height-h).toPath(a).attr("stroke-width",c);l="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(e-g,d+this.model.height-h,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(e-g,d+this.model.height-h,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:n+g,y:k};this.outlines[3]=
(new b.PathBuilder).moveTo(n+f,k).lineTo(n+g,k).toPath(a).attr("stroke-width",c);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(n+g,k,7.5).attr("fill","white").attr("stroke",l),this.labels[2]=a.text(n+g,k,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};b.AndView=c;return b}(NAND||{});NAND=function(b){function c(a){this.id=a;this.inputs=[];this.outputs=[];this.wires=[]}c.prototype.traverse=function(a){this.inputs.map(function(b,c){b.traverse(a,c,0)})};c.prototype.layout=function(a,n){var c=null,h=null;this.traverse(function(a,d,b){if(null==c||d>c)c=d;if(null==h||b>h)h=b});var k=[];this.traverse(function(a,d,b){a.seen||(a.seen=!0,k.push({node:a,row:d,column:b,dx:0,dy:0}))});for(var e=0,d=0;d<k.length;d++){var f=k[d],g=f.node;f.row+=e;if(null!=g.inputs){var l=function(a){if(null!=
a)for(var d=0;d<k.length;d++){var b=k[d];if(b.node.id==a.id)return b}return null},m=l(g.inputs[0]),g=l(g.inputs[1]);null!=m&&null!=g?(f.row=Math.round((m.row+g.row)/2),e++):null!=m&&null==g&&(f.row=m.row)}}for(g=!0;g;)for(g=!1,e=[],d=0;d<k.length;d++){f=k[d];for(m=0;m<e.length;m++)if(e[m].row==f.row&&e[m].column==f.column&&e[m].node.id!=f.node.id){f.column++;g=!0;break}if(g)break;e.push(f)}for(var p=this,r=[],d=0;d<k.length;d++){f=k[d];g=f.node;e=null;switch(g.kind){case "source":m={viewModel:f,value:f.node.value?
"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();n(p,r,h)}};e=new b.SourceView(g,m);f.options=m;break;case "sink":m={viewModel:f,value:g.evaluate()?"1":"0"};e=new b.SinkView(m);f.options=m;break;case "delay":e=new b.DelayView({viewModel:f});break;case "fanout":e=new b.FanOutView({viewModel:f,node:g});break;case "gate":m={viewModel:f,id:g.id,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:"not"==g.gate?[g.inputs[0].evaluate()?"1":
"0"]:[g.inputs[0].evaluate()?"1":"0",g.inputs[1].evaluate()?"1":"0"],output:g.evaluate()?"1":"0"};f.options=m;switch(g.gate){case "not":e=new b.GateView(new b.NotView(m));break;case "nand":e=new b.NandView(m);break;case "and":e=new b.GateView(new b.AndView(m));break;case "nor":e=new b.NorView(m);break;case "or":e=new b.OrView(m);break;case "xor":e=new b.GateView(new b.XorView(m));break;default:throw"gate";}break;default:throw"kind";}null!=e&&r.push({node:g,view:e})}l=m=null;for(d=0;d<r.length;d++){e=
r[d].view;f=e.bounds();if(null==m||f.width>m)m=f.width;if(null==l||f.height>l)l=f.height}var m=m+10,l=l+10,t=a.width/2-(h-1)*m/2,u=a.height/2-(c-1)*l/2;this.dx=m;this.dy=l;this.cx=t;this.cy=u;for(d=0;d<r.length;d++)g=r[d].node,e=r[d].view,f=e.model.viewModel,g=u+f.row*l,e.model.x=t+f.column*m,e.model.y=g,e.render(a);this.models=k;this.layoutWires(a);return{nodeViews:r,maxDepth:h}};c.prototype.layoutWires=function(a){for(var n=0;n<this.wires.length;n++)this.wires[n].remove();this.wires=[];for(var c=
this.dx,h=this.dy,k=this.cx,e=this.cy,d=this,n=0;n<this.models.length;n++){var f=this.models[n],g=f.node;null!=g.outputs&&g.outputs.map(function(n){for(var g=[],p=0;p<d.models.length;p++){var r=d.models[p];r.node.id==n.id&&g.push(r)}if(1!=g.length)throw console.log(g),"outputs";n=g[0];var g=f.options?f.options.x+f.dx:k+f.column*c,p=f.options?f.options.y+f.dy:e+f.row*h,r=n.options?n.options.x+n.dx:k+n.column*c,t=n.options?n.options.y+n.dy:e+n.row*h,u="gate"==n.node.kind?-48:0;n="gate"==n.node.kind?
-5:0;d.wires.push((new b.PathBuilder).moveTo(g,p).lineTo(r+u,p).lineTo(r+u,t<p?t-n:t+n).toPath(a).toBack())})}};c.prototype.layout2=function(a,n){var c=a.width/2,h=a.height/2,k=[],e=0,d=[];this.traverse(function(a,b,n){a.seen||(a.seen=!0,d.push({node:a,dx:0,dy:0}));if(null==e||n>e)e=n});var f=d[0],g=f.node,l=this,m={viewModel:f,value:f.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();n(l,k,e)},x:c-80,y:h},p=new b.SourceView(g,m);p.render(a);
f.options=m;k.push({node:g,view:p});f=d[1];g=f.node;m={viewModel:f,id:g.id,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:[g.inputs[0].evaluate()?"1":"0"],output:g.evaluate()?"1":"0",x:c,y:h};p=new b.GateView(new b.NotView(m));p.render(a);f.options=m;k.push({node:g,view:p});f=d[2];g=f.node;m={viewModel:f,value:g.evaluate()?"1":"0",x:c+80,y:h};p=new b.SinkView(m);p.render(a);f.options=m;k.push({node:g,view:p});this.models=d;this.layoutWires(a);return{nodeViews:k,maxDepth:e}};b.Circuit=
c;return b}(NAND||{});NAND=function(b){function c(a){this.id=a;this.kind="delay";this.inputs=[];this.outputs=[]}c.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};c.prototype.traverse=function(a,b,c){a(this,b,c);this.outputs.map(function(h){h.traverse(a,b,c+1)})};c.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.Delay=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a}c.prototype.render=function(a){};b.DelayView=c;return b}(NAND||{});NAND=function(b){function c(a){this.id=a;this.kind="fanout";this.inputs=[];this.outputs=[]}c.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};c.prototype.traverse=function(a,b,c){a(this,b,c);this.outputs.map(function(h){h.traverse(a,b,c+1)})};c.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.FanOut=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a}c.prototype.render=function(a){};c.prototype.bounds=function(){return{width:10,height:10}};b.FanOutView=c;return b}(NAND||{});NAND=function(b){function c(a,b,c){this.id=a;this.kind="gate";this.gate=b;this.logic=c;this.inputs=[];this.outputs=[]}c.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};c.prototype.traverse=function(a,b,c){a(this,b,c);this.outputs.map(function(h){h.traverse(a,b,c+1)})};c.prototype.evaluate=function(){if("not"==this.gate&&1!=this.inputs.length||"not"!=this.gate&&2>this.inputs.length)throw"inputs";var a=[];this.inputs.map(function(b){a.push(b.evaluate())});return this.logic(a)};
b.Gate=c;return b}(NAND||{});NAND=function(b){function c(a){this.delegate=a;this.model=a.model}c.prototype.render=function(a){this.delegate.render(a)};c.prototype.update=function(){for(var a=this.delegate.model.inputs,b=this.delegate.model.output,c=this.delegate.labels,h=this.delegate.outlines,k=this.delegate.paths,e="?"==a[0],d=0;d<a.length;d++){var f="?"==a[d]?"black":"0"==a[d]?"#a00":"#0a0";c[d].attr("text",a[d]).attr("stroke",f);h[d].attr("stroke",f)}c[a.length].attr("text",b).attr("stroke","?"==b?"black":"0"==b?"#a00":"#0a0");
h[a.length].attr("stroke","?"==b?"black":"0"==b?"#a00":"#0a0");for(d=0;d<k.length;d++)null!=k[d]&&k[d].attr("stroke-dasharray",e?"-":"")};c.prototype.bounds=function(){return{width:1.4*this.delegate.model.width,height:1.1*this.delegate.model.height}};b.GateView=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}c.prototype.render=function(a){var b=this.model.heavyStrokeWidth,c=this.model.lightStrokeWidth,h=this.model.width/2,k=this.model.height/2,e=this.model.x-h,d=this.model.y-k,f="?"==this.model.inputs[0];this.paths[0]=(new PathBuilder).moveTo(e,d).lineTo(e+h,d).arc(1,1,0,0,1,e+h,d+this.model.height).lineTo(e,d+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":b*(f?.5:1),"stroke-dasharray":f?
"-":""});var g=.05*this.model.width,b=e+h+k+g+b/2,k=d+k;a.circle(b,k,g).attr({fill:"white","stroke-width":c*(f?.5:1),"stroke-dasharray":f?"-":""});f=.2*this.model.height;h=.3*this.model.width;this.paths[2]=(new PathBuilder).moveTo(e,d+f).lineTo(e-h,d+f).toPath(a).attr("stroke-width",c);var l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(e-h,d+f,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(e-h,d+f,this.model.inputs[0]).attr("stroke",
l);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new PathBuilder).moveTo(e,d+this.model.height-f).lineTo(e-h,d+this.model.height-f).toPath(a).attr("stroke-width",c);l="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(e-h,d+this.model.height-f,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(e-h,d+this.model.height-f,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");
this.outputWire={x:b+h,y:k};(new PathBuilder).moveTo(b+g,k).lineTo(b+h,k).toPath(a).attr("stroke-width",c);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(b+h,k,7.5).attr("fill","white").attr("stroke",l),this.labels[2]=a.text(b+h,k,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};c.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":
"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",
a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.NandView=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}c.prototype.render=function(a){var c=this.model.heavyStrokeWidth,q=this.model.lightStrokeWidth,h=this.model.width/2,k=this.model.height/2,e=this.model.x-h,d=this.model.y-k,f="?"==this.model.inputs[0],g=.4*this.model.width,l=2*this.model.width/3,m=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(e,d).lineTo(e+g,d).arc(l,l,0,0,1,e+this.model.width-m,d+k).arc(l,l,0,0,1,e+g,d+this.model.height).lineTo(e,
d+this.model.height).toPath(a).attr({fill:"white","stroke-width":c*(f?.5:1),"stroke-dasharray":f?"-":""});this.paths[1]=(new b.PathBuilder).moveTo(e,d).arc(g,g,0,0,1,e,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":c*(f?.5:1),"stroke-dasharray":f?"-":""});g=.05*this.model.width;c=e+h+k+g+c/2;k=d+k;a.circle(c,k,g).attr({fill:"white","stroke-width":q*(f?.5:1),"stroke-dasharray":f?"-":""});f=.2*this.model.height;h=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(e+h-1-.5*
h,d+f).lineTo(e-h,d+f).toPath(a).attr("stroke-width",q);l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(e-h,d+f,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(e-h,d+f,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(e+h-1-.5*h,d+this.model.height-f).lineTo(e-h,d+this.model.height-f).toPath(a).attr("stroke-width",q);l="?"==this.model.inputs[1]?
"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(e-h,d+this.model.height-f,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(e-h,d+this.model.height-f,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:c+h,y:k};(new b.PathBuilder).moveTo(c+g,k).lineTo(c+h,k).toPath(a).attr("stroke-width",q);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=
a.circle(c+h,k,7.5).attr("fill","white").attr("stroke",l),this.labels[2]=a.text(c+h,k,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};c.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",
a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.NorView=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}c.prototype.render=function(a){var c=this.model.heavyStrokeWidth,q=this.model.lightStrokeWidth,h=this.model.width/2,k=this.model.height/2,e=this.model.x-h,d=this.model.y-k,f="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(e,d).lineTo(e+this.model.width-20,d+k).lineTo(e,d+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":c*(f?.5:1),"stroke-dasharray":f?"-":""}).drag(b.makeMove(this),
b.start,b.up(this));var g=.05*this.model.width,c=e+h+k+g+c/2-11,h=d+k;a.circle(c,h,g).attr({fill:"white","stroke-width":q*(f?.5:1),"stroke-dasharray":f?"-":""});f=.3*this.model.width;this.paths[1]=(new b.PathBuilder).moveTo(e,d+k).lineTo(e-f,d+k).toPath(a).attr("stroke-width",q);var l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(e-f,d+k,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(e-f,d+k,this.model.inputs[0]).attr("stroke",
l);this.labels[0].node.setAttribute("class","intermediate");(new b.PathBuilder).moveTo(c+g,h).lineTo(c+f,h).toPath(a).attr("stroke-width",q);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[1]=a.circle(c+f,h,7.5).attr("fill","white").attr("stroke",l),this.labels[1]=a.text(c+f,h,this.model.output).attr("stroke",l),this.labels[1].node.setAttribute("class","intermediate"))};b.NotView=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}c.prototype.render=function(a){var c=this.model.heavyStrokeWidth,q=this.model.lightStrokeWidth,h=this.model.width/2,k=this.model.height/2,e=this.model.x-h,d=this.model.y-k,f="?"==this.model.inputs[0],g=.4*this.model.width,l=2*this.model.width/3,m=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(e,d).lineTo(e+g,d).arc(l,l,0,0,1,e+this.model.width-m,d+k).arc(l,l,0,0,1,e+g,d+this.model.height).lineTo(e,
d+this.model.height).toPath(a).attr({fill:"white","stroke-width":c*(f?.5:1),"stroke-dasharray":f?"-":""}).drag(b.makeMove(this),b.start,b.up(this));this.paths[1]=(new b.PathBuilder).moveTo(e,d).arc(g,g,0,0,1,e,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":c*(f?.5:1),"stroke-dasharray":f?"-":""});f=.05*this.model.width;c=e+h+k+f+c/2;k=d+k;h=.2*this.model.height;g=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(e+g-1-.5*g,d+h).lineTo(e-g,d+h).toPath(a).attr("stroke-width",
q);l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(e-g,d+h,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(e-g,d+h,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(e+g-1-.5*g,d+this.model.height-h).lineTo(e-g,d+this.model.height-h).toPath(a).attr("stroke-width",q);l="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=
a.circle(e-g,d+this.model.height-h,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(e-g,d+this.model.height-h,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:c+g,y:k};this.outlines[3]=(new b.PathBuilder).moveTo(c+f,k).lineTo(c+g,k).toPath(a).attr("stroke-width",q);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(c+g,k,7.5).attr("fill","white").attr("stroke",
l),this.labels[2]=a.text(c+g,k,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};c.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",
a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.OrView=c;return b}(NAND||{});NAND=function(b){function c(){this.commands=[]}c.prototype.moveTo=function(a,b){this.commands.push("M"+a+","+b);return this};c.prototype.lineTo=function(a,b){this.commands.push("L"+a+","+b);return this};c.prototype.arc=function(a,b,c,h,k,e,d){this.commands.push("A"+a+","+b+" "+c+" "+h+" "+k+" "+e+","+d);return this};c.prototype.close=function(){this.commands.push("Z");return this};c.prototype.toPath=function(a){return a.path(this.commands.join(" "))};b.PathBuilder=c;return b}(NAND||{});NAND=function(b){function c(a){this.id=a;this.kind="sink";this.inputs=[]}c.prototype.connect=function(a){this.inputs.push(a);a.outputs.push(this)};c.prototype.traverse=function(a,b,c){a(this,b,c)};c.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.Sink=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a;this.paths=[];this.outlines=[];this.labels=[]}c.prototype.render=function(a){var c=this.model.value,q=this.model.x,h=this.model.y,k="?"==c?"black":"0"==c?"#a00":"#0a0";this.outlines[0]=a.rect(q-7,h-7,14,14).attr("stroke",k).attr("fill","white").drag(b.makeMove(this),b.start,b.up(this));this.labels[0]=a.text(q,h,c).attr("stroke",k).drag(b.makeMove(this),b.start,b.up(this));this.labels[0].node.setAttribute("class","output")};c.prototype.update=function(){var a=
this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};c.prototype.bounds=function(){return{width:14,height:14}};b.SinkView=c;return b}(NAND||{});NAND=function(b){function c(a,b){this.id=a;this.kind="source";this.value=b;this.outputs=[]}c.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};c.prototype.traverse=function(a,b,c){a(this,b,c);this.outputs.map(function(h){h.traverse(a,b,c+1)})};c.prototype.evaluate=function(){return this.value};c.prototype.toggle=function(){this.value=!this.value};b.Source=c;return b}(NAND||{});NAND=function(b){function c(a,b){this.node=a;this.model=b;this.paths=[];this.labels=[];this.outlines=[]}c.prototype.render=function(a){var c=this.model.value,q=this.model.x,h=this.model.y,k="?"==c?"black":"0"==c?"#a00":"#0a0";this.outlines[0]=a.rect(q-7,h-7,14,14).attr("stroke",k).attr("fill","white").drag(b.makeMove(this),b.start,b.up(this));this.labels[0]=a.text(q,h,c).attr("stroke",k).click(this.model.click.bind(this)).drag(b.makeMove(this),b.start,b.up(this));this.labels[0].node.setAttribute("class",
"input")};c.prototype.update=function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};c.prototype.bounds=function(){return{width:14,height:14}};b.SourceView=c;return b}(NAND||{});NAND=function(b){function c(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}c.prototype.render=function(a){var c=this.model.heavyStrokeWidth,q=this.model.lightStrokeWidth,h=this.model.width/2,k=this.model.height/2,e=this.model.x-h,d=this.model.y-k,f="?"==this.model.inputs[0],g=.4*this.model.width,l=2*this.model.width/3,m=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(e,d).lineTo(e+g,d).arc(l,l,0,0,1,e+this.model.width-m,d+k).arc(l,l,0,0,1,e+g,d+this.model.height).lineTo(e,
d+this.model.height).toPath(a).attr({fill:"white","stroke-width":c*(f?.5:1),"stroke-dasharray":f?"-":""}).drag(b.makeMove(this),b.start,b.up(this));this.paths[1]=(new b.PathBuilder).moveTo(e,d).arc(g,g,0,0,1,e,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":c*(f?.5:1),"stroke-dasharray":f?"-":""});this.paths[2]=(new b.PathBuilder).moveTo(e-5,d).arc(g,g,0,0,1,e-5,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":c*(f?.5:1),"stroke-dasharray":f?"-":""});f=.05*this.model.width;
c=e+h+k+f+c/2;k=d+k;h=.2*this.model.height;g=.3*this.model.width;this.paths[3]=(new b.PathBuilder).moveTo(e+g-1-.5*g,d+h).lineTo(e-g,d+h).toPath(a).attr("stroke-width",q);l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(e-g,d+h,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(e-g,d+h,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class","intermediate");this.paths[4]=(new b.PathBuilder).moveTo(e+g-1-.5*g,
d+this.model.height-h).lineTo(e-g,d+this.model.height-h).toPath(a).attr("stroke-width",q);l="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(e-g,d+this.model.height-h,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(e-g,d+this.model.height-h,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:c+g,y:k};this.outlines[3]=(new b.PathBuilder).moveTo(c+f,k).lineTo(c+g,k).toPath(a).attr("stroke-width",
q);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(c+g,k,7.5).attr("fill","white").attr("stroke",l),this.labels[2]=a.text(c+g,k,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};b.XorView=c;return b}(NAND||{});NAND=function(b){function c(a){return!a[0]}function a(a){return a.reduce(function(a,b){return a&&b})}function n(a){return a.reduce(function(a,b){return a^b})}function q(a,b,c){0>d?d=0:d>=c&&(d=c-1);a.traverse(function(a,e,g){b.map(function(b){var e=b.node,f=b.view;if(e.id==a.id){var h=g>d;switch(e.kind){case "gate":e.inputs.map(function(a,b){f.model.inputs[b]=h?"?":a.evaluate()?"1":"0"});f.model.output=h?"?":e.evaluate()?"1":"0";f.update();break;case "sink":f.model.value=d<c-1?"?":e.evaluate()?"1":
"0",f.update()}}})});document.getElementById("time").textContent="t = "+d}function h(h){k=new Raphael(0,0,window.innerWidth,window.innerHeight);var p=document.getElementById("controls");p.style.left=k.width/2-p.clientWidth/2+"px";p.style.top=k.height/2-p.clientHeight/2-150+"px";var p=0,r=new b.Source(p++,!1);new b.Source(p++,!1);new b.Source(p++,!1);var t=new b.Sink(p++);new b.Sink(p++);new b.Sink(p++);new b.Delay(p++);new b.Delay(p++);new b.Delay(p++);new b.FanOut(p++);new b.FanOut(p++);new b.FanOut(p++);
var u=new b.Gate(p++,"not",c);new b.Gate(p++,"and",a);new b.Gate(p++,"xor",n);r.connect(u);u.connect(t);e=new b.Circuit(p++);e.inputs=[r];e.outputs=[t];f=e.layout2(k,q);l=f.nodeViews;g=f.maxDepth;d=g-1;q(e,l,g);var v=document.getElementById("slider");v.max=g-1;v.value=d;h&&(document.getElementById("forward").addEventListener("click",function(){d++;q(e,l,g);v.value=d},!1),document.getElementById("backward").addEventListener("click",function(){d--;q(e,l,g);v.value=d},!1),document.getElementById("slider").addEventListener("input",
function(){d=this.value;q(e,l,g);v.value=d}))}var k,e;b.makeMove=function(a){return function(b,c){for(var d=0;d<a.paths.length;d++){var f=a.paths[d];null!=f&&f.translate(b-this.tx,c-this.ty)}for(d=0;d<a.labels.length;d++)f=a.labels[d],null!=f&&f.translate(b-this.tx,c-this.ty);for(d=0;d<a.outlines.length;d++)f=a.outlines[d],null!=f&&f.translate(b-this.tx,c-this.ty);this.tx=b;this.ty=c;a.model.viewModel.dx=b;a.model.viewModel.dy=c;e.layoutWires(k)}};b.start=function(){this.ty=this.tx=0};b.up=function(a){return function(){a.model.x+=
a.model.viewModel.dx;a.model.y+=a.model.viewModel.dy;a.model.viewModel.dx=0;a.model.viewModel.dy=0}};var d=0,f,g,l;window.addEventListener("load",function(){h(!0)});window.addEventListener("resize",function(){k.clear();h(!1)});return b}(NAND||{});
