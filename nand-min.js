var NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var n=this.model.heavyStrokeWidth,d=this.model.lightStrokeWidth,k=this.model.width/2,l=this.model.height/2,f=this.model.x-k,e=this.model.y-l,h="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(f,e).lineTo(f+k,e).arc(1,1,0,0,1,f+k,e+this.model.height).lineTo(f,e+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":n*(h?.5:1),"stroke-dasharray":h?
"-":""}).drag(b.makeMove(this),b.start,b.up(this));var h=.05*this.model.width,n=f+k+l+h+n/2,l=e+l,k=.2*this.model.height,g=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(f,e+k).lineTo(f-g,e+k).toPath(a).attr("stroke-width",d);var m="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-g,e+k,7.5).attr("fill","white").attr("stroke",m);this.labels[0]=a.text(f-g,e+k,this.model.inputs[0]).attr("stroke",m);this.labels[0].node.setAttribute("class",
"intermediate");this.paths[3]=(new b.PathBuilder).moveTo(f,e+this.model.height-k).lineTo(f-g,e+this.model.height-k).toPath(a).attr("stroke-width",d);m="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(f-g,e+this.model.height-k,7.5).attr("fill","white").attr("stroke",m);this.labels[1]=a.text(f-g,e+this.model.height-k,this.model.inputs[1]).attr("stroke",m);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:n+g,y:l};this.outlines[3]=
(new b.PathBuilder).moveTo(n+h,l).lineTo(n+g,l).toPath(a).attr("stroke-width",d);null!=this.model.output&&(m="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(n+g,l,7.5).attr("fill","white").attr("stroke",m),this.labels[2]=a.text(n+g,l,this.model.output).attr("stroke",m),this.labels[2].node.setAttribute("class","intermediate"))};b.AndView=d;return b}(NAND||{});NAND=function(b){function d(a){this.id=a;this.inputs=[];this.outputs=[];this.wires=[]}d.prototype.traverse=function(a){this.inputs.map(function(b,d){b.traverse(a,d,0)})};d.prototype.layout=function(a,n){var d=null,k=null;this.traverse(function(a,e,f){if(null==d||e>d)d=e;if(null==k||f>k)k=f});var l=[];this.traverse(function(a,e,f){a.seen||(a.seen=!0,l.push({node:a,row:e,column:f,dx:0,dy:0}))});for(var f=0,e=0;e<l.length;e++){var h=l[e],g=h.node;h.row+=f;if(null!=g.inputs){var m=function(a){if(null!=
a)for(var e=0;e<l.length;e++){var f=l[e];if(f.node.id==a.id)return f}return null},p=m(g.inputs[0]),g=m(g.inputs[1]);null!=p&&null!=g?(h.row=Math.round((p.row+g.row)/2),f++):null!=p&&null==g&&(h.row=p.row)}}for(g=!0;g;)for(g=!1,f=[],e=0;e<l.length;e++){h=l[e];for(p=0;p<f.length;p++)if(f[p].row==h.row&&f[p].column==h.column&&f[p].node.id!=h.node.id){h.column++;g=!0;break}if(g)break;f.push(h)}for(var q=this,t=[],e=0;e<l.length;e++){h=l[e];g=h.node;f=null;switch(g.kind){case "source":p={viewModel:h,value:h.node.value?
"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();n(q,t,k)}};f=new b.SourceView(g,p);h.options=p;break;case "sink":p={viewModel:h,value:g.evaluate()?"1":"0"};f=new b.SinkView(p);h.options=p;break;case "delay":f=new b.DelayView({viewModel:h});break;case "fanout":f=new b.FanOutView({viewModel:h,node:g});break;case "gate":p={viewModel:h,id:g.id,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:"not"==g.gate?[g.inputs[0].evaluate()?"1":
"0"]:[g.inputs[0].evaluate()?"1":"0",g.inputs[1].evaluate()?"1":"0"],output:g.evaluate()?"1":"0"};h.options=p;switch(g.gate){case "not":f=new b.GateView(new b.NotView(p));break;case "nand":f=new b.NandView(p);break;case "and":f=new b.GateView(new b.AndView(p));break;case "nor":f=new b.NorView(p);break;case "or":f=new b.OrView(p);break;case "xor":f=new b.GateView(new b.XorView(p));break;default:throw"gate";}break;default:throw"kind";}null!=f&&t.push({node:g,view:f})}m=p=null;for(e=0;e<t.length;e++){f=
t[e].view;h=f.bounds();if(null==p||h.width>p)p=h.width;if(null==m||h.height>m)m=h.height}var p=p+10,m=m+10,u=a.width/2-(k-1)*p/2,w=a.height/2-(d-1)*m/2;this.dx=p;this.dy=m;this.cx=u;this.cy=w;for(e=0;e<t.length;e++)g=t[e].node,f=t[e].view,h=f.model.viewModel,g=w+h.row*m,f.model.x=u+h.column*p,f.model.y=g,f.render(a);this.models=l;this.layoutWires(a);return{nodeViews:t,maxDepth:k}};d.prototype.layoutWires=function(a){for(var n=0;n<this.wires.length;n++)this.wires[n].remove();this.wires=[];for(var d=
this.dx,k=this.dy,l=this.cx,f=this.cy,e=this,n=0;n<this.models.length;n++){var h=this.models[n],g=h.node;null!=g.outputs&&g.outputs.map(function(n){for(var g=[],q=0;q<e.models.length;q++){var t=e.models[q];t.node.id==n.id&&g.push(t)}if(1!=g.length)throw console.log(g),"outputs";n=g[0];var g=h.options?h.options.x+h.dx:l+h.column*d,q=h.options?h.options.y+h.dy:f+h.row*k,t=n.options?n.options.x+n.dx:l+n.column*d,u=n.options?n.options.y+n.dy:f+n.row*k,w="gate"==n.node.kind?-48:0;n="gate"==n.node.kind?
-5:0;e.wires.push((new b.PathBuilder).moveTo(g,q).lineTo(t+w,q).lineTo(t+w,u<q?u-n:u+n).toPath(a).toBack())})}};d.prototype.layout2=function(a,n){var d=a.width/2,k=a.height/2,l=c.Expression.fromConstant(0),f=c.Expression.fromConstant(a.width),e=new c.Variable({name:"source1x"}),h=new c.Variable({name:"source2x"}),g=new c.Variable({name:"gate1x"}),m=new c.Variable({name:"sink1x"});(new c.SimplexSolver).addConstraint(new c.Inequality(e,c.GEQ,l)).addConstraint(new c.Inequality(h,c.GEQ,l)).addConstraint(new c.Inequality(g,
c.GEQ,l)).addConstraint(new c.Inequality(m,c.GEQ,l)).addConstraint(new c.Inequality(e,c.LEQ,f)).addConstraint(new c.Inequality(h,c.LEQ,f)).addConstraint(new c.Inequality(g,c.LEQ,f)).addConstraint(new c.Inequality(m,c.LEQ,f)).addConstraint(new c.Inequality(c.plus(e,80),c.LEQ,g)).addConstraint(new c.Inequality(c.plus(h,80),c.LEQ,g)).addConstraint(new c.Inequality(c.plus(g,80),c.LEQ,m)).solve();console.log("source1x = "+e.value);console.log("source2x = "+h.value);console.log("gate1x = "+g.value);console.log("sink1x = "+
m.value);var l=m.value-e.value,p=[],q=0,t=[];this.traverse(function(a,e,f){a.seen||(a.seen=!0,t.push({node:a,dx:0,dy:0}));if(null==q||f>q)q=f});var f=t[0],u=f.node,w=this,e={viewModel:f,value:f.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();n(w,p,q)},x:d-l/2+e.value,y:k},v=new b.SourceView(u,e);v.render(a);f.options=e;p.push({node:u,view:v});f=t[3];u=f.node;w=this;e={viewModel:f,value:f.node.value?"1":"0",click:function(){this.node.toggle();
this.model.value=this.node.value?"1":"0";this.update();n(w,p,q)},x:d-l/2+h.value,y:k+20};v=new b.SourceView(u,e);v.render(a);f.options=e;p.push({node:u,view:v});f=t[1];u=f.node;e={viewModel:f,id:u.id,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:[u.inputs[0].evaluate()?"1":"0",u.inputs[1].evaluate()?"1":"0"],output:u.evaluate()?"1":"0",x:d-l/2+g.value,y:k};v=new b.GateView(new b.NandView(e));v.render(a);f.options=e;p.push({node:u,view:v});f=t[2];u=f.node;e={viewModel:f,value:u.evaluate()?
"1":"0",x:d-l/2+m.value,y:k};v=new b.SinkView(e);v.render(a);f.options=e;p.push({node:u,view:v});this.models=t;this.layoutWires(a);return{nodeViews:p,maxDepth:q}};b.Circuit=d;return b}(NAND||{});NAND=function(b){function d(a){this.id=a;this.kind="delay";this.inputs=[];this.outputs=[]}d.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d);this.outputs.map(function(k){k.traverse(a,b,d+1)})};d.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.Delay=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a}d.prototype.render=function(a){};b.DelayView=d;return b}(NAND||{});NAND=function(b){function d(a){this.id=a;this.kind="fanout";this.inputs=[];this.outputs=[]}d.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d);this.outputs.map(function(k){k.traverse(a,b,d+1)})};d.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.FanOut=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a}d.prototype.render=function(a){};d.prototype.bounds=function(){return{width:10,height:10}};b.FanOutView=d;return b}(NAND||{});NAND=function(b){function d(a,b,d){this.id=a;this.kind="gate";this.gate=b;this.logic=d;this.inputs=[];this.outputs=[]}d.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d);this.outputs.map(function(k){k.traverse(a,b,d+1)})};d.prototype.evaluate=function(){if("not"==this.gate&&1!=this.inputs.length||"not"!=this.gate&&2>this.inputs.length)throw"inputs";var a=[];this.inputs.map(function(b){a.push(b.evaluate())});return this.logic(a)};
b.Gate=d;return b}(NAND||{});NAND=function(b){function d(a){this.delegate=a;this.model=a.model}d.prototype.render=function(a){this.delegate.render(a)};d.prototype.update=function(){for(var a=this.delegate.model.inputs,b=this.delegate.model.output,d=this.delegate.labels,k=this.delegate.outlines,l=this.delegate.paths,f="?"==a[0],e=0;e<a.length;e++){var h="?"==a[e]?"black":"0"==a[e]?"#a00":"#0a0";d[e].attr("text",a[e]).attr("stroke",h);k[e].attr("stroke",h)}d[a.length].attr("text",b).attr("stroke","?"==b?"black":"0"==b?"#a00":"#0a0");
k[a.length].attr("stroke","?"==b?"black":"0"==b?"#a00":"#0a0");for(e=0;e<l.length;e++)null!=l[e]&&l[e].attr("stroke-dasharray",f?"-":"")};d.prototype.bounds=function(){return{width:1.4*this.delegate.model.width,height:1.1*this.delegate.model.height}};b.GateView=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var n=this.model.heavyStrokeWidth,d=this.model.lightStrokeWidth,k=this.model.width/2,l=this.model.height/2,f=this.model.x-k,e=this.model.y-l,h="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(f,e).lineTo(f+k,e).arc(1,1,0,0,1,f+k,e+this.model.height).lineTo(f,e+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":n*(h?.5:1),"stroke-dasharray":h?
"-":""}).drag(b.makeMove(this),b.start,b.up(this));var g=.05*this.model.width,n=f+k+l+g+n/2,l=e+l;this.paths[1]=a.circle(n,l,g).attr({fill:"white","stroke-width":d*(h?.5:1),"stroke-dasharray":h?"-":""});h=.2*this.model.height;k=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(f,e+h).lineTo(f-k,e+h).toPath(a).attr("stroke-width",d);var m="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-k,e+h,7.5).attr("fill","white").attr("stroke",m);
this.labels[0]=a.text(f-k,e+h,this.model.inputs[0]).attr("stroke",m);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(f,e+this.model.height-h).lineTo(f-k,e+this.model.height-h).toPath(a).attr("stroke-width",d);m="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(f-k,e+this.model.height-h,7.5).attr("fill","white").attr("stroke",m);this.labels[1]=a.text(f-k,e+this.model.height-h,this.model.inputs[1]).attr("stroke",
m);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:n+k,y:l};this.paths[4]=(new b.PathBuilder).moveTo(n+g,l).lineTo(n+k,l).toPath(a).attr("stroke-width",d);null!=this.model.output&&(m="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(n+k,l,7.5).attr("fill","white").attr("stroke",m),this.labels[2]=a.text(n+k,l,this.model.output).attr("stroke",m),this.labels[2].node.setAttribute("class","intermediate"))};b.NandView=d;return b}(NAND||
{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var d=this.model.heavyStrokeWidth,r=this.model.lightStrokeWidth,k=this.model.width/2,l=this.model.height/2,f=this.model.x-k,e=this.model.y-l,h="?"==this.model.inputs[0],g=.4*this.model.width,m=2*this.model.width/3,p=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(f,e).lineTo(f+g,e).arc(m,m,0,0,1,f+this.model.width-p,e+l).arc(m,m,0,0,1,f+g,e+this.model.height).lineTo(f,
e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(h?.5:1),"stroke-dasharray":h?"-":""});this.paths[1]=(new b.PathBuilder).moveTo(f,e).arc(g,g,0,0,1,f,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(h?.5:1),"stroke-dasharray":h?"-":""});g=.05*this.model.width;d=f+k+l+g+d/2;l=e+l;a.circle(d,l,g).attr({fill:"white","stroke-width":r*(h?.5:1),"stroke-dasharray":h?"-":""});h=.2*this.model.height;k=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(f+k-1-.5*
k,e+h).lineTo(f-k,e+h).toPath(a).attr("stroke-width",r);m="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-k,e+h,7.5).attr("fill","white").attr("stroke",m);this.labels[0]=a.text(f-k,e+h,this.model.inputs[0]).attr("stroke",m);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(f+k-1-.5*k,e+this.model.height-h).lineTo(f-k,e+this.model.height-h).toPath(a).attr("stroke-width",r);m="?"==this.model.inputs[1]?
"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(f-k,e+this.model.height-h,7.5).attr("fill","white").attr("stroke",m);this.labels[1]=a.text(f-k,e+this.model.height-h,this.model.inputs[1]).attr("stroke",m);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+k,y:l};(new b.PathBuilder).moveTo(d+g,l).lineTo(d+k,l).toPath(a).attr("stroke-width",r);null!=this.model.output&&(m="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=
a.circle(d+k,l,7.5).attr("fill","white").attr("stroke",m),this.labels[2]=a.text(d+k,l,this.model.output).attr("stroke",m),this.labels[2].node.setAttribute("class","intermediate"))};d.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",
a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.NorView=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var d=this.model.heavyStrokeWidth,r=this.model.lightStrokeWidth,k=this.model.width/2,l=this.model.height/2,f=this.model.x-k,e=this.model.y-l,h="?"==this.model.inputs[0];this.paths[0]=(new b.PathBuilder).moveTo(f,e).lineTo(f+this.model.width-20,e+l).lineTo(f,e+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":d*(h?.5:1),"stroke-dasharray":h?"-":""}).drag(b.makeMove(this),
b.start,b.up(this));var g=.05*this.model.width,d=f+k+l+g+d/2-11,k=e+l;this.paths[1]=a.circle(d,k,g).attr({fill:"white","stroke-width":r*(h?.5:1),"stroke-dasharray":h?"-":""});h=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(f,e+l).lineTo(f-h,e+l).toPath(a).attr("stroke-width",r);var m="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-h,e+l,7.5).attr("fill","white").attr("stroke",m);this.labels[0]=a.text(f-h,e+l,this.model.inputs[0]).attr("stroke",
m);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(d+g,k).lineTo(d+h,k).toPath(a).attr("stroke-width",r);null!=this.model.output&&(m="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[1]=a.circle(d+h,k,7.5).attr("fill","white").attr("stroke",m),this.labels[1]=a.text(d+h,k,this.model.output).attr("stroke",m),this.labels[1].node.setAttribute("class","intermediate"))};b.NotView=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var d=this.model.heavyStrokeWidth,r=this.model.lightStrokeWidth,k=this.model.width/2,l=this.model.height/2,f=this.model.x-k,e=this.model.y-l,h="?"==this.model.inputs[0],g=.4*this.model.width,m=2*this.model.width/3,p=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(f,e).lineTo(f+g,e).arc(m,m,0,0,1,f+this.model.width-p,e+l).arc(m,m,0,0,1,f+g,e+this.model.height).lineTo(f,
e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(h?.5:1),"stroke-dasharray":h?"-":""}).drag(b.makeMove(this),b.start,b.up(this));this.paths[1]=(new b.PathBuilder).moveTo(f,e).arc(g,g,0,0,1,f,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(h?.5:1),"stroke-dasharray":h?"-":""});h=.05*this.model.width;d=f+k+l+h+d/2;l=e+l;k=.2*this.model.height;g=.3*this.model.width;this.paths[2]=(new b.PathBuilder).moveTo(f+g-1-.5*g,e+k).lineTo(f-g,e+k).toPath(a).attr("stroke-width",
r);m="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-g,e+k,7.5).attr("fill","white").attr("stroke",m);this.labels[0]=a.text(f-g,e+k,this.model.inputs[0]).attr("stroke",m);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new b.PathBuilder).moveTo(f+g-1-.5*g,e+this.model.height-k).lineTo(f-g,e+this.model.height-k).toPath(a).attr("stroke-width",r);m="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=
a.circle(f-g,e+this.model.height-k,7.5).attr("fill","white").attr("stroke",m);this.labels[1]=a.text(f-g,e+this.model.height-k,this.model.inputs[1]).attr("stroke",m);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+g,y:l};this.outlines[3]=(new b.PathBuilder).moveTo(d+h,l).lineTo(d+g,l).toPath(a).attr("stroke-width",r);null!=this.model.output&&(m="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(d+g,l,7.5).attr("fill","white").attr("stroke",
m),this.labels[2]=a.text(d+g,l,this.model.output).attr("stroke",m),this.labels[2].node.setAttribute("class","intermediate"))};d.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",
a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};b.OrView=d;return b}(NAND||{});NAND=function(b){function d(){this.commands=[]}d.prototype.moveTo=function(a,b){this.commands.push("M"+a+","+b);return this};d.prototype.lineTo=function(a,b){this.commands.push("L"+a+","+b);return this};d.prototype.arc=function(a,b,d,k,l,f,e){this.commands.push("A"+a+","+b+" "+d+" "+k+" "+l+" "+f+","+e);return this};d.prototype.close=function(){this.commands.push("Z");return this};d.prototype.toPath=function(a){return a.path(this.commands.join(" "))};b.PathBuilder=d;return b}(NAND||{});NAND=function(b){function d(a){this.id=a;this.kind="sink";this.inputs=[]}d.prototype.connect=function(a){this.inputs.push(a);a.outputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d)};d.prototype.evaluate=function(){return this.inputs[0].evaluate()};b.Sink=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.paths=[];this.outlines=[];this.labels=[]}d.prototype.render=function(a){var d=this.model.value,r=this.model.x,k=this.model.y,l="?"==d?"black":"0"==d?"#a00":"#0a0";this.outlines[0]=a.rect(r-7,k-7,14,14).attr("stroke",l).attr("fill","white").drag(b.makeMove(this),b.start,b.up(this));this.labels[0]=a.text(r,k,d).attr("stroke",l).drag(b.makeMove(this),b.start,b.up(this));this.labels[0].node.setAttribute("class","output")};d.prototype.update=function(){var a=
this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};d.prototype.bounds=function(){return{width:14,height:14}};b.SinkView=d;return b}(NAND||{});NAND=function(b){function d(a,b){this.id=a;this.kind="source";this.value=b;this.outputs=[]}d.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};d.prototype.traverse=function(a,b,d){a(this,b,d);this.outputs.map(function(k){k.traverse(a,b,d+1)})};d.prototype.evaluate=function(){return this.value};d.prototype.toggle=function(){this.value=!this.value};b.Source=d;return b}(NAND||{});NAND=function(b){function d(a,b){this.node=a;this.model=b;this.paths=[];this.labels=[];this.outlines=[]}d.prototype.render=function(a){var d=this.model.value,r=this.model.x,k=this.model.y,l="?"==d?"black":"0"==d?"#a00":"#0a0";this.outlines[0]=a.rect(r-7,k-7,14,14).attr("stroke",l).attr("fill","white").drag(b.makeMove(this),b.start,b.up(this));this.labels[0]=a.text(r,k,d).attr("stroke",l).click(this.model.click.bind(this)).drag(b.makeMove(this),b.start,b.up(this));this.labels[0].node.setAttribute("class",
"input")};d.prototype.update=function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.labels[0].attr("text",a).attr("stroke",b);this.outlines[0].attr("stroke",b)};d.prototype.bounds=function(){return{width:14,height:14}};b.SourceView=d;return b}(NAND||{});NAND=function(b){function d(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}d.prototype.render=function(a){var d=this.model.heavyStrokeWidth,r=this.model.lightStrokeWidth,k=this.model.width/2,l=this.model.height/2,f=this.model.x-k,e=this.model.y-l,h="?"==this.model.inputs[0],g=.4*this.model.width,m=2*this.model.width/3,p=.15*this.model.width;this.paths[0]=(new b.PathBuilder).moveTo(f,e).lineTo(f+g,e).arc(m,m,0,0,1,f+this.model.width-p,e+l).arc(m,m,0,0,1,f+g,e+this.model.height).lineTo(f,
e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(h?.5:1),"stroke-dasharray":h?"-":""}).drag(b.makeMove(this),b.start,b.up(this));this.paths[1]=(new b.PathBuilder).moveTo(f,e).arc(g,g,0,0,1,f,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(h?.5:1),"stroke-dasharray":h?"-":""});this.paths[2]=(new b.PathBuilder).moveTo(f-5,e).arc(g,g,0,0,1,f-5,e+this.model.height).toPath(a).attr({fill:"white","stroke-width":d*(h?.5:1),"stroke-dasharray":h?"-":""});h=.05*this.model.width;
d=f+k+l+h+d/2;l=e+l;k=.2*this.model.height;g=.3*this.model.width;this.paths[3]=(new b.PathBuilder).moveTo(f+g-1-.5*g,e+k).lineTo(f-g,e+k).toPath(a).attr("stroke-width",r);m="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(f-g,e+k,7.5).attr("fill","white").attr("stroke",m);this.labels[0]=a.text(f-g,e+k,this.model.inputs[0]).attr("stroke",m);this.labels[0].node.setAttribute("class","intermediate");this.paths[4]=(new b.PathBuilder).moveTo(f+g-1-.5*g,
e+this.model.height-k).lineTo(f-g,e+this.model.height-k).toPath(a).attr("stroke-width",r);m="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(f-g,e+this.model.height-k,7.5).attr("fill","white").attr("stroke",m);this.labels[1]=a.text(f-g,e+this.model.height-k,this.model.inputs[1]).attr("stroke",m);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:d+g,y:l};this.outlines[3]=(new b.PathBuilder).moveTo(d+h,l).lineTo(d+g,l).toPath(a).attr("stroke-width",
r);null!=this.model.output&&(m="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(d+g,l,7.5).attr("fill","white").attr("stroke",m),this.labels[2]=a.text(d+g,l,this.model.output).attr("stroke",m),this.labels[2].node.setAttribute("class","intermediate"))};b.XorView=d;return b}(NAND||{});NAND=function(b){function d(a){return!a.reduce(function(a,b){return a&&b})}function a(a){return a.reduce(function(a,b){return a&&b})}function n(a){return a.reduce(function(a,b){return a^b})}function r(a,b,d){0>e?e=0:e>=d&&(e=d-1);a.traverse(function(a,f,g){b.map(function(b){var f=b.node,h=b.view;if(f.id==a.id){var k=g>e;switch(f.kind){case "gate":f.inputs.map(function(a,b){h.model.inputs[b]=k?"?":a.evaluate()?"1":"0"});h.model.output=k?"?":f.evaluate()?"1":"0";h.update();break;case "sink":h.model.value=
e<d-1?"?":f.evaluate()?"1":"0",h.update()}}})});document.getElementById("time").textContent="t = "+e}function k(k){l=new Raphael(0,0,window.innerWidth,window.innerHeight);var q=document.getElementById("controls");q.style.left=l.width/2-q.clientWidth/2+"px";q.style.top=l.height/2-q.clientHeight/2-150+"px";var q=0,t=new b.Source(q++,!1),u=new b.Source(q++,!1);new b.Source(q++,!1);var w=new b.Sink(q++);new b.Sink(q++);new b.Sink(q++);new b.Delay(q++);new b.Delay(q++);new b.Delay(q++);new b.FanOut(q++);
new b.FanOut(q++);new b.FanOut(q++);var v=new b.Gate(q++,"nand",d);new b.Gate(q++,"and",a);new b.Gate(q++,"xor",n);t.connect(v);u.connect(v);v.connect(w);f=new b.Circuit(q++);f.inputs=[t,u];f.outputs=[w];h=f.layout2(l,r);m=h.nodeViews;g=h.maxDepth;e=g-1;r(f,m,g);var x=document.getElementById("slider");x.max=g-1;x.value=e;k&&(document.getElementById("forward").addEventListener("click",function(){e++;r(f,m,g);x.value=e},!1),document.getElementById("backward").addEventListener("click",function(){e--;
r(f,m,g);x.value=e},!1),document.getElementById("slider").addEventListener("input",function(){e=this.value;r(f,m,g);x.value=e}))}var l,f;b.makeMove=function(a){return function(b,d){for(var e=0;e<a.paths.length;e++){var g=a.paths[e];null!=g&&g.translate(b-this.tx,d-this.ty)}for(e=0;e<a.labels.length;e++)g=a.labels[e],null!=g&&g.translate(b-this.tx,d-this.ty);for(e=0;e<a.outlines.length;e++)g=a.outlines[e],null!=g&&g.translate(b-this.tx,d-this.ty);this.tx=b;this.ty=d;a.model.viewModel.dx=b;a.model.viewModel.dy=
d;f.layoutWires(l)}};b.start=function(){this.ty=this.tx=0};b.up=function(a){return function(){a.model.x+=a.model.viewModel.dx;a.model.y+=a.model.viewModel.dy;a.model.viewModel.dx=0;a.model.viewModel.dy=0}};var e=0,h,g,m;window.addEventListener("load",function(){k(!0)});window.addEventListener("resize",function(){l.clear();k(!1)});return b}(NAND||{});
