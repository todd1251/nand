(function(){function l(){this.commands=[]}function t(b){this.model=b;this.outlines=[];this.labels=[]}function n(b,a){this.id=b;this.kind="gate";this.logic=a;this.inputs=[];this.outputs=[]}function k(b,a){this.id=b;this.kind="source";this.value=a;this.outputs=[]}function q(b){this.id=b;this.kind="sink";this.inputs=[]}function r(b){this.id=b;this.kind="delay";this.inputs=[];this.outputs=[]}function p(b){return!b.reduce(function(b,g){return b&&g})}function u(b){this.model=b;this.outline=this.label=null}
function v(b){this.model=b}function x(b){this.model=b}function w(b){this.id=b;this.inputs=[];this.outputs=[]}l.prototype.moveTo=function(b,a){this.commands.push("M"+b+","+a);return this};l.prototype.lineTo=function(b,a){this.commands.push("L"+b+","+a);return this};l.prototype.arc=function(b,a,g,f,c,e,d){this.commands.push("A"+b+","+a+" "+g+" "+f+" "+c+" "+e+","+d);return this};l.prototype.close=function(){this.commands.push("Z");return this};l.prototype.toPath=function(b){return b.path(this.commands.join(" "))};
t.prototype.render=function(b){var a=this.model.heavyStrokeWidth,g=this.model.lightStrokeWidth,f=this.model.width/2,c=this.model.height/2,e=this.model.x-f,d=this.model.y-c,h="?"==this.model.inputs[0];(new l).moveTo(e,d).lineTo(e+f,d).arc(1,1,0,0,1,e+f,d+this.model.height).lineTo(e,d+this.model.height).close().toPath(b).attr({fill:"white","stroke-width":this.heavyStrokeWidth*(h?.5:1),"stroke-dasharray":h?"-":""});var k=.05*this.model.width,a=e+f+c+k+a/2,c=d+c;b.circle(a,c,k).attr({fill:"white","stroke-width":this.lightStrokeWidth*
(h?.5:1),"stroke-dasharray":h?"-":""});h=.2*this.model.height;f=.3*this.model.width;(new l).moveTo(e,d+h).lineTo(e-f,d+h).toPath(b).attr("stroke-width",g);var m="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=b.circle(e-f,d+h,7.5).attr("fill","white").attr("stroke",m);this.labels[0]=b.text(e-f,d+h,this.model.inputs[0]).attr("stroke",m);this.labels[0].node.setAttribute("class","intermediate");(new l).moveTo(e,d+this.model.height-h).lineTo(e-f,d+this.model.height-
h).toPath(b).attr("stroke-width",g);m="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=b.circle(e-f,d+this.model.height-h,7.5).attr("fill","white").attr("stroke",m);this.labels[1]=b.text(e-f,d+this.model.height-h,this.model.inputs[1]).attr("stroke",m);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:a+f,y:c};(new l).moveTo(a+k,c).lineTo(a+f,c).toPath(b).attr("stroke-width",g);null!=this.model.output&&(m="?"==this.model.output?"black":
"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=b.circle(a+f,c,7.5).attr("fill","white").attr("stroke",m),this.labels[2]=b.text(a+f,c,this.model.output).attr("stroke",m),this.labels[2].node.setAttribute("class","intermediate"))};t.prototype.update=function(){var b="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",b);this.outlines[0].attr("stroke",b);b="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?
"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",b);this.outlines[1].attr("stroke",b);b="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",b);this.outlines[2].attr("stroke",b)};n.prototype.connect=function(b){this.outputs.push(b);b.inputs.push(this)};n.prototype.traverse=function(b,a,g){b(this,a,g);this.outputs.map(function(f){f.traverse(b,a,g+1)})};n.prototype.evaluate=function(){if(2>this.inputs.length)throw"inputs";
var b=[];this.inputs.map(function(a){b.push(a.evaluate())});return this.logic(b)};k.prototype.connect=function(b){this.outputs.push(b);b.inputs.push(this)};k.prototype.traverse=function(b,a,g){b(this,a,g);this.outputs.map(function(f){f.traverse(b,a,g+1)})};k.prototype.evaluate=function(){return this.value};k.prototype.toggle=function(){this.value=!this.value};q.prototype.connect=function(b){this.inputs.push(b);b.outputs.push(this)};q.prototype.traverse=function(b,a,g){b(this,a,g)};q.prototype.evaluate=
function(){return this.inputs[0].evaluate()};r.prototype.connect=function(b){this.outputs.push(b);b.inputs.push(this)};r.prototype.traverse=function(b,a,g){b(this,a,g);this.outputs.map(function(f){f.traverse(b,a,g+1)})};r.prototype.evaluate=function(){return this.inputs[0].evaluate()};u.prototype.render=function(b){var a=this.model.value,g=this.model.x,f=this.model.y,c="?"==a?"black":"0"==a?"#a00":"#0a0";this.outline=b.rect(g-7,f-7,14,14).attr("stroke",c).attr("fill","white");this.label=b.text(g,
f,a).attr("stroke",c).click(this.model.click.bind(this));this.label.node.setAttribute("class","input")};u.prototype.update=function(){var b=this.model.value,a="?"==b?"black":"0"==b?"#a00":"#0a0";this.label.attr("text",b).attr("stroke",a);this.outline.attr("stroke",a)};v.prototype.render=function(b){var a=this.model.value,g=this.model.x,f=this.model.y,c="?"==a?"black":"0"==a?"#a00":"#0a0";this.outline=b.rect(g-7,f-7,14,14).attr("stroke",c).attr("fill","white");this.label=b.text(g,f,a).attr("stroke",
c);this.label.node.setAttribute("class","output")};v.prototype.update=function(){var b=this.model.value,a="?"==b?"black":"0"==b?"#a00":"#0a0";this.label.attr("text",b).attr("stroke",a);this.outline.attr("stroke",a)};x.prototype.render=function(b){};w.prototype.traverse=function(b){this.inputs.map(function(a,g){a.traverse(b,g,0)})};w.prototype.layout=function(b){var a=[];this.traverse(function(b,c,d){c>=a.length&&(a[c]=[]);a[c][d]={node:b}});for(var g=b.width/2-90*(a[0].length-1)/2,f=b.height/2-60*
(a.length-1)/2,c=0;c<a.length;c++)for(var e=0;e<a[c].length;e++){var d=a[c][e],h=d.node;d.x=g+90*e;d.y=f+60*c;0<c&&a[c-1][e].node.id==h.id&&(a[c-1][e].skip=!0,null==a[c-1][e].skipCount&&(a[c-1][e].skipCount=1),d.skipCount=a[c-1][e].skipCount+1,d.x=a[c-1][e].x+d.x,d.y=a[c-1][e].y+d.y)}for(c=0;c<a.length;c++)for(e=0;e<a[c].length;e++)d=a[c][e],null!=d.skipCount&&(d.x/=d.skipCount,d.y/=d.skipCount);for(c=0;c<a.length;c++)for(e=0;e<a[c].length;e++)d=a[c][e],h=d.node,d.skip||null==h.outputs||h.outputs.map(function(c){for(var e=
[],f=0;f<a.length;f++)for(var g=0;g<a[f].length;g++){var h=a[f][g];h.node.id!=c.id||h.skip||e.push(h)}if(1!=e.length)throw"outputs";c=e[0];e="gate"==c.node.kind?-48:0;f="gate"==c.node.kind?-5:0;(new l).moveTo(d.x,d.y).lineTo(c.x+e,d.y).lineTo(c.x+e,c.y<d.y?c.y-f:c.y+f).toPath(b)});var k=[];a.map(function(a){a.map(function(a){if(!a.skip){var c=a.x,e=a.y,d=a.node;a=null;switch(d.kind){case "source":a=new u({x:c,y:e,value:d.value?"1":"0",click:function(){d.toggle();this.model.value=d.value?"1":"0";this.update();
d.traverse(function(a){k.map(function(a){var b=a.node,c=a.view;switch(b.kind){case "gate":b.inputs.map(function(a,b){c.model.inputs[b]=a.evaluate()?"1":"0"});c.model.output=b.evaluate()?"1":"0";c.update();break;case "sink":c.model.value=b.evaluate()?"1":"0",c.update()}})})}});a.render(b);break;case "sink":a=new v({x:c,y:e,value:d.evaluate()?"1":"0"});a.render(b);break;case "delay":a=new x({x:c,y:e});a.render(b);break;case "gate":a=new t({x:c,y:e,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,
inputs:[d.inputs[0].evaluate()?"1":"0",d.inputs[1].evaluate()?"1":"0"],output:d.evaluate()?"1":"0"});a.render(b);break;default:throw"kind";}null!=a&&k.push({node:d,view:a})}})})};window.addEventListener("load",function(){var b=new Raphael(0,0,window.innerWidth,window.innerHeight),a=0,g=new k(a++,!0),f=new k(a++,!0),c=new k(a++,!0),e=new k(a++,!0);new k(a++,!0);new k(a++,!0);var d=new n(a++,p),h=new n(a++,p),l=new n(a++,p);new n(a++,p);new n(a++,p);new n(a++,p);var m=new q(a++);new r(a++);g.connect(d);
f.connect(d);d.connect(h);h.connect(m);c.connect(l);e.connect(l);l.connect(h);a=new w(a++);a.inputs=[g,f,c,e];a.outputs=[m];a.layout(b)})})();
