(function(){function m(){this.commands=[]}function t(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}function u(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}function v(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}function I(){this.ty=this.tx=0}function J(a){return function(b,k){for(var e=0;e<a.paths.length;e++){var f=a.paths[e];null!=f&&f.translate(b-this.tx,k-this.ty)}for(e=0;e<a.labels.length;e++)f=a.labels[e],null!=f&&f.translate(b-this.tx,k-this.ty);
for(e=0;e<a.outlines.length;e++)f=a.outlines[e],null!=f&&f.translate(b-this.tx,k-this.ty);this.tx=b;this.ty=k}}function K(){}function w(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}function x(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}function y(a){this.model=a;this.outlines=[];this.labels=[];this.paths=[]}function q(a,b,k){this.id=a;this.kind="gate";this.gate=b;this.logic=k;this.inputs=[];this.outputs=[]}function z(a,b){this.id=a;this.kind="source";this.value=
b;this.outputs=[]}function B(a){this.id=a;this.kind="sink";this.inputs=[]}function C(a){this.id=a;this.kind="delay";this.inputs=[];this.outputs=[]}function A(a){this.id=a;this.kind="fanout";this.inputs=[];this.outputs=[]}function N(a){return a.reduce(function(a,k){return a&&k})}function P(a){return a.reduce(function(a,k){return a||k})}function O(a){return a.reduce(function(a,k){return a^k})}function F(a,b){this.node=a;this.model=b;this.outline=this.label=null}function G(a){this.model=a}function L(a){this.model=
a}function M(a){this.model=a}function H(a){this.id=a;this.inputs=[];this.outputs=[]}function E(a,b,k){0>r?r=0:r>=k&&(r=k-1);a.traverse(function(a,f,c){b.map(function(b){var g=b.node,f=b.view;if(g.id==a.id){var l=c>r;switch(g.kind){case "gate":g.inputs.map(function(a,b){f.model.inputs[b]=l?"?":a.evaluate()?"1":"0"});f.model.output=l?"?":g.evaluate()?"1":"0";f.update();break;case "sink":f.model.value=r<k-1?"?":g.evaluate()?"1":"0",f.update()}}})});document.getElementById("time").textContent="t = "+
r}m.prototype.moveTo=function(a,b){this.commands.push("M"+a+","+b);return this};m.prototype.lineTo=function(a,b){this.commands.push("L"+a+","+b);return this};m.prototype.arc=function(a,b,k,e,f,c,d){this.commands.push("A"+a+","+b+" "+k+" "+e+" "+f+" "+c+","+d);return this};m.prototype.close=function(){this.commands.push("Z");return this};m.prototype.toPath=function(a){return a.path(this.commands.join(" "))};t.prototype.render=function(a){var b=this.model.heavyStrokeWidth,k=this.model.lightStrokeWidth,
e=this.model.width/2,f=this.model.height/2,c=this.model.x-e,d=this.model.y-f,g="?"==this.model.inputs[0];this.paths[0]=(new m).moveTo(c,d).lineTo(c+e,d).arc(1,1,0,0,1,c+e,d+this.model.height).lineTo(c,d+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""});var h=.05*this.model.width,b=c+e+f+h+b/2,f=d+f;a.circle(b,f,h).attr({fill:"white","stroke-width":k*(g?.5:1),"stroke-dasharray":g?"-":""});g=.2*this.model.height;e=.3*this.model.width;this.paths[2]=
(new m).moveTo(c,d+g).lineTo(c-e,d+g).toPath(a).attr("stroke-width",k);var l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(c-e,d+g,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(c-e,d+g,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new m).moveTo(c,d+this.model.height-g).lineTo(c-e,d+this.model.height-g).toPath(a).attr("stroke-width",k);l="?"==this.model.inputs[1]?
"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(c-e,d+this.model.height-g,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(c-e,d+this.model.height-g,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:b+e,y:f};(new m).moveTo(b+h,f).lineTo(b+e,f).toPath(a).attr("stroke-width",k);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(b+
e,f,7.5).attr("fill","white").attr("stroke",l),this.labels[2]=a.text(b+e,f,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};t.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",
a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};u.prototype.render=function(a){var b=this.model.heavyStrokeWidth,k=this.model.lightStrokeWidth,e=this.model.width/2,f=this.model.height/
2,c=this.model.x-e,d=this.model.y-f,g="?"==this.model.inputs[0];this.paths[0]=(new m).moveTo(c,d).lineTo(c+this.model.width-20,d+f).lineTo(c,d+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""});var h=.05*this.model.width,b=c+e+f+h+b/2-11,e=d+f;a.circle(b,e,h).attr({fill:"white","stroke-width":k*(g?.5:1),"stroke-dasharray":g?"-":""});g=.3*this.model.width;this.paths[1]=(new m).moveTo(c,d+f).lineTo(c-g,d+f).toPath(a).attr("stroke-width",k);
var l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(c-g,d+f,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(c-g,d+f,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class","intermediate");this.outputWire={x:b+g,y:e};(new m).moveTo(b+h,e).lineTo(b+g,e).toPath(a).attr("stroke-width",k);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[1]=a.circle(b+
g,e,7.5).attr("fill","white").attr("stroke",l),this.labels[1]=a.text(b+g,e,this.model.output).attr("stroke",l),this.labels[1].node.setAttribute("class","intermediate"))};u.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[1].attr("text",this.model.output).attr("stroke",
a);this.outlines[1].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"")};v.prototype.render=function(a){var b=this.model.heavyStrokeWidth,k=this.model.lightStrokeWidth,e=this.model.width/2,f=this.model.height/2,c=this.model.x-e,d=this.model.y-f,g="?"==this.model.inputs[0];this.paths[0]=(new m).moveTo(c,d).lineTo(c+e,d).arc(1,1,0,0,1,c+e,d+this.model.height).lineTo(c,d+this.model.height).close().toPath(a).attr({fill:"white",
"stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""}).drag(J(this),I,K);var g=.05*this.model.width,b=c+e+f+g+b/2,f=d+f,e=.2*this.model.height,h=.3*this.model.width;this.paths[2]=(new m).moveTo(c,d+e).lineTo(c-h,d+e).toPath(a).attr("stroke-width",k);var l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(c-h,d+e,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(c-h,d+e,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class",
"intermediate");this.paths[3]=(new m).moveTo(c,d+this.model.height-e).lineTo(c-h,d+this.model.height-e).toPath(a).attr("stroke-width",k);l="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(c-h,d+this.model.height-e,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(c-h,d+this.model.height-e,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:b+h,y:f};this.outlines[3]=(new m).moveTo(b+
g,f).lineTo(b+h,f).toPath(a).attr("stroke-width",k);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(b+h,f,7.5).attr("fill","white").attr("stroke",l),this.labels[2]=a.text(b+h,f,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};v.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",
a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");
this.paths[3].attr("stroke-dasharray",a?"-":"")};w.prototype.render=function(a){var b=this.model.heavyStrokeWidth,k=this.model.lightStrokeWidth,e=this.model.width/2,f=this.model.height/2,c=this.model.x-e,d=this.model.y-f,g="?"==this.model.inputs[0],h=.4*this.model.width,l=2*this.model.width/3,p=.15*this.model.width;this.paths[0]=(new m).moveTo(c,d).lineTo(c+h,d).arc(l,l,0,0,1,c+this.model.width-p,d+f).arc(l,l,0,0,1,c+h,d+this.model.height).lineTo(c,d+this.model.height).toPath(a).attr({fill:"white",
"stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""});this.paths[1]=(new m).moveTo(c,d).arc(h,h,0,0,1,c,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""});h=.05*this.model.width;b=c+e+f+h+b/2;f=d+f;a.circle(b,f,h).attr({fill:"white","stroke-width":k*(g?.5:1),"stroke-dasharray":g?"-":""});g=.2*this.model.height;e=.3*this.model.width;this.paths[2]=(new m).moveTo(c+e-1-.5*e,d+g).lineTo(c-e,d+g).toPath(a).attr("stroke-width",k);l="?"==this.model.inputs[0]?
"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(c-e,d+g,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(c-e,d+g,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new m).moveTo(c+e-1-.5*e,d+this.model.height-g).lineTo(c-e,d+this.model.height-g).toPath(a).attr("stroke-width",k);l="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(c-e,d+this.model.height-
g,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(c-e,d+this.model.height-g,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:b+e,y:f};(new m).moveTo(b+h,f).lineTo(b+e,f).toPath(a).attr("stroke-width",k);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(b+e,f,7.5).attr("fill","white").attr("stroke",l),this.labels[2]=a.text(b+e,f,this.model.output).attr("stroke",
l),this.labels[2].node.setAttribute("class","intermediate"))};w.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?
"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};x.prototype.render=function(a){var b=this.model.heavyStrokeWidth,k=this.model.lightStrokeWidth,e=this.model.width/2,f=this.model.height/2,c=this.model.x-e,d=this.model.y-
f,g="?"==this.model.inputs[0],h=.4*this.model.width,l=2*this.model.width/3,p=.15*this.model.width;this.paths[0]=(new m).moveTo(c,d).lineTo(c+h,d).arc(l,l,0,0,1,c+this.model.width-p,d+f).arc(l,l,0,0,1,c+h,d+this.model.height).lineTo(c,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""}).drag(J(this),I,K);this.paths[1]=(new m).moveTo(c,d).arc(h,h,0,0,1,c,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(g?.5:1),"stroke-dasharray":g?
"-":""});g=.05*this.model.width;b=c+e+f+g+b/2;f=d+f;e=.2*this.model.height;h=.3*this.model.width;this.paths[2]=(new m).moveTo(c+h-1-.5*h,d+e).lineTo(c-h,d+e).toPath(a).attr("stroke-width",k);l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(c-h,d+e,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(c-h,d+e,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class","intermediate");this.paths[3]=(new m).moveTo(c+
h-1-.5*h,d+this.model.height-e).lineTo(c-h,d+this.model.height-e).toPath(a).attr("stroke-width",k);l="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(c-h,d+this.model.height-e,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(c-h,d+this.model.height-e,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:b+h,y:f};this.outlines[3]=(new m).moveTo(b+g,f).lineTo(b+h,f).toPath(a).attr("stroke-width",
k);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(b+h,f,7.5).attr("fill","white").attr("stroke",l),this.labels[2]=a.text(b+h,f,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};x.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",
a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",
a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"")};y.prototype.render=function(a){var b=this.model.heavyStrokeWidth,k=this.model.lightStrokeWidth,e=this.model.width/2,f=this.model.height/2,c=this.model.x-e,d=this.model.y-f,g="?"==this.model.inputs[0],h=.4*this.model.width,l=2*this.model.width/3,p=.15*this.model.width;this.paths[0]=(new m).moveTo(c,d).lineTo(c+h,d).arc(l,l,0,0,1,c+this.model.width-p,d+f).arc(l,l,0,0,1,c+h,d+this.model.height).lineTo(c,d+this.model.height).toPath(a).attr({fill:"white",
"stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""}).drag(J(this),I,K);this.paths[1]=(new m).moveTo(c,d).arc(h,h,0,0,1,c,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""});this.paths[2]=(new m).moveTo(c-5,d).arc(h,h,0,0,1,c-5,d+this.model.height).toPath(a).attr({fill:"white","stroke-width":b*(g?.5:1),"stroke-dasharray":g?"-":""});g=.05*this.model.width;b=c+e+f+g+b/2;f=d+f;e=.2*this.model.height;h=.3*this.model.width;this.paths[3]=(new m).moveTo(c+
h-1-.5*h,d+e).lineTo(c-h,d+e).toPath(a).attr("stroke-width",k);l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(c-h,d+e,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=a.text(c-h,d+e,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class","intermediate");this.paths[4]=(new m).moveTo(c+h-1-.5*h,d+this.model.height-e).lineTo(c-h,d+this.model.height-e).toPath(a).attr("stroke-width",k);l="?"==this.model.inputs[1]?"black":
"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(c-h,d+this.model.height-e,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=a.text(c-h,d+this.model.height-e,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:b+h,y:f};this.outlines[3]=(new m).moveTo(b+g,f).lineTo(b+h,f).toPath(a).attr("stroke-width",k);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=
a.circle(b+h,f,7.5).attr("fill","white").attr("stroke",l),this.labels[2]=a.text(b+h,f,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};y.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",
a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a);a="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",a?"-":"");this.paths[1].attr("stroke-dasharray",a?"-":"");this.paths[2].attr("stroke-dasharray",a?"-":"");this.paths[3].attr("stroke-dasharray",a?"-":"");this.paths[4].attr("stroke-dasharray",a?"-":"")};q.prototype.connect=function(a){this.outputs.push(a);
a.inputs.push(this)};q.prototype.traverse=function(a,b,k){a(this,b,k);this.outputs.map(function(e){e.traverse(a,b,k+1)})};q.prototype.evaluate=function(){if("not"==this.gate&&1!=this.inputs.length||"not"!=this.gate&&2>this.inputs.length)throw"inputs";var a=[];this.inputs.map(function(b){a.push(b.evaluate())});return this.logic(a)};z.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};z.prototype.traverse=function(a,b,k){a(this,b,k);this.outputs.map(function(e){e.traverse(a,b,k+
1)})};z.prototype.evaluate=function(){return this.value};z.prototype.toggle=function(){this.value=!this.value};B.prototype.connect=function(a){this.inputs.push(a);a.outputs.push(this)};B.prototype.traverse=function(a,b,k){a(this,b,k)};B.prototype.evaluate=function(){return this.inputs[0].evaluate()};C.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};C.prototype.traverse=function(a,b,k){a(this,b,k);this.outputs.map(function(e){e.traverse(a,b,k+1)})};C.prototype.evaluate=function(){return this.inputs[0].evaluate()};
A.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};A.prototype.traverse=function(a,b,k){a(this,b,k);this.outputs.map(function(e){e.traverse(a,b,k+1)})};A.prototype.evaluate=function(){return this.inputs[0].evaluate()};F.prototype.render=function(a){var b=this.model.value,k=this.model.x,e=this.model.y,f="?"==b?"black":"0"==b?"#a00":"#0a0";this.outline=a.rect(k-7,e-7,14,14).attr("stroke",f).attr("fill","white");this.label=a.text(k,e,b).attr("stroke",f).click(this.model.click.bind(this));
this.label.node.setAttribute("class","input")};F.prototype.update=function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.label.attr("text",a).attr("stroke",b);this.outline.attr("stroke",b)};G.prototype.render=function(a){var b=this.model.value,k=this.model.x,e=this.model.y,f="?"==b?"black":"0"==b?"#a00":"#0a0";this.outline=a.rect(k-7,e-7,14,14).attr("stroke",f).attr("fill","white");this.label=a.text(k,e,b).attr("stroke",f);this.label.node.setAttribute("class","output")};G.prototype.update=
function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.label.attr("text",a).attr("stroke",b);this.outline.attr("stroke",b)};L.prototype.render=function(a){};M.prototype.render=function(a){var b=this.model.x,k=this.model.y;(new m).moveTo(b+42,k).lineTo(b+42,k+10).toPath(a)};H.prototype.traverse=function(a){this.inputs.map(function(b,k){b.traverse(a,k,0)})};H.prototype.layout=function(a){var b=[],k=null;this.traverse(function(a,c,d){c>=b.length&&(b[c]=[]);b[c][d]={node:a};if(null==
k||d>k)k=d});for(var e=a.width/2-90*(b[0].length-1)/2,f=a.height/2-60*(b.length-1)/2,c=0;c<b.length;c++)for(var d=0;d<b[c].length;d++){var g=b[c][d],h=g.node;g.x=e+90*d;g.y=f+60*c;0<c&&b[c-1][d].node.id==h.id&&(b[c-1][d].skip=!0,null==b[c-1][d].skipCount&&(b[c-1][d].skipCount=1),g.skipCount=b[c-1][d].skipCount+1,g.x=b[c-1][d].x+g.x,g.y=b[c-1][d].y+g.y)}for(c=0;c<b.length;c++)for(d=0;d<b[c].length;d++)g=b[c][d],null!=g.skipCount&&(g.x/=g.skipCount,g.y/=g.skipCount);for(c=0;c<b.length;c++)for(d=0;d<
b[c].length;d++)g=b[c][d],h=g.node,g.skip||null==h.outputs||h.outputs.map(function(c){for(var d=[],e=0;e<b.length;e++)for(var f=0;f<b[e].length;f++){var h=b[e][f];h.node.id!=c.id||h.skip||d.push(h)}if(1!=d.length)throw console.log(d),"outputs";c=d[0];d="gate"==c.node.kind?-48:0;e="gate"==c.node.kind?-5:0;(new m).moveTo(g.x,g.y).lineTo(c.x+d,g.y).lineTo(c.x+d,c.y<g.y?c.y-e:c.y+e).toPath(a)});var l=this,p=[];b.map(function(b){b.map(function(b){if(!b.skip){var c=b.x,d=b.y,e=b.node;b=null;switch(e.kind){case "source":b=
new F({x:c,y:d,value:e.value?"1":"0",click:function(){e.toggle();this.model.value=e.value?"1":"0";this.update();E(l,p,k)}});b.render(a);break;case "sink":b=new G({x:c,y:d,value:e.evaluate()?"1":"0"});b.render(a);break;case "delay":b=new L({x:c,y:d});b.render(a);break;case "fanout":b=new M({x:c,y:d});b.render(a);break;case "gate":c={id:e.id,x:c,y:d,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:"not"==e.gate?[e.inputs[0].evaluate()?"1":"0"]:[e.inputs[0].evaluate()?"1":"0",e.inputs[1].evaluate()?
"1":"0"],output:e.evaluate()?"1":"0"};switch(e.gate){case "not":b=new u(c);break;case "nand":b=new t(c);break;case "and":b=new v(c);break;case "nor":b=new w(c);break;case "or":b=new x(c);break;case "xor":b=new y(c);break;default:throw"gate";}b.render(a);break;default:throw"kind";}null!=b&&p.push({node:e,view:b})}})});return{nodeViews:p,maxDepth:k}};H.prototype.layout2=function(a){var b=null,k=null;this.traverse(function(a,c,e){console.log(a.kind+"["+a.id+"]: breadth="+c+", depth="+e);if(null==b||
c>b)b=c;if(null==k||e>k)k=e});console.log("maxBreadth="+b+", maxDepth="+k);var e=[];this.traverse(function(a,b,c){a.seen||(console.log(a.kind+"["+a.id+"]: breadth="+b+", depth="+c),a.seen=!0,a={node:a,row:b,column:c},console.log(a),e.push(a))});for(var f=!0;f;)for(var f=!1,c=[],d=0;d<e.length;d++){for(var g=e[d],h=0;h<c.length;h++)if(c[h].row==g.row&&c[h].column==g.column&&c[h].node.id!=g.node.id){console.log("conflict at "+g.row+","+g.column);g.row++;f=!0;break}if(f)break;c.push(g)}for(var l=a.width/
2-90*(k-1)/2,p=a.height/2-60*(b-1)/2,d=0;d<e.length;d++)g=e[d],f=g.node,null!=f.outputs&&f.outputs.map(function(b){for(var c=[],d=0;d<e.length;d++){var f=e[d];f.node.id==b.id&&c.push(f)}if(1!=c.length)throw console.log(c),"outputs";b=c[0];var c=l+90*g.column,d=p+60*g.row,f=l+90*b.column,h=p+60*b.row,k="gate"==b.node.kind?-48:0;b="gate"==b.node.kind?-5:0;(new m).moveTo(c,d).lineTo(f+k,d).lineTo(f+k,h<d?h-b:h+b).toPath(a)});for(var r=this,q=[],d=0;d<e.length;d++){var g=e[d],c=l+90*g.column,h=p+60*g.row,
f=g.node,n=null;switch(f.kind){case "source":n=new F(f,{x:c,y:h,value:g.node.value?"1":"0",click:function(){this.node.toggle();this.model.value=this.node.value?"1":"0";this.update();E(r,q,k)}});n.render(a);break;case "sink":n=new G({x:c,y:h,value:f.evaluate()?"1":"0"});n.render(a);break;case "delay":n=new L({x:c,y:h});n.render(a);break;case "fanout":n=new M({x:c,y:h});n.render(a);break;case "gate":c={id:f.id,x:c,y:h,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:"not"==f.gate?
[f.inputs[0].evaluate()?"1":"0"]:[f.inputs[0].evaluate()?"1":"0",f.inputs[1].evaluate()?"1":"0"],output:f.evaluate()?"1":"0"};switch(f.gate){case "not":n=new u(c);break;case "nand":n=new t(c);break;case "and":n=new v(c);break;case "nor":n=new w(c);break;case "or":n=new x(c);break;case "xor":n=new y(c);break;default:throw"gate";}n.render(a);break;default:throw"kind";}null!=n&&q.push({node:f,view:n})}return{nodeViews:q,maxDepth:k}};var r=0;window.addEventListener("load",function(){var a=new Raphael(0,
0,window.innerWidth,window.innerHeight),b=document.getElementById("controls");b.style.left=a.width/2-b.clientWidth/2+"px";b.style.top=a.height/2-b.clientHeight/2-150+"px";var b=0,k=new z(b++,!1),e=new z(b++,!1),f=new z(b++,!1),c=new B(b++),d=new B(b++);new B(b++);new C(b++);new C(b++);new C(b++);var g=new A(b++),h=new A(b++),l=new A(b++),m=new A(b++),t=new q(b++,"xor",O),u=new q(b++,"and",N),n=new q(b++,"xor",O),v=new q(b++,"and",N),w=new q(b++,"or",P);k.connect(g);g.connect(t);g.connect(u);e.connect(h);
h.connect(t);h.connect(u);t.connect(l);l.connect(n);l.connect(v);f.connect(m);m.connect(n);m.connect(v);n.connect(c);u.connect(w);v.connect(w);w.connect(d);var D=new H(b++);D.inputs=[k,e,f];D.outputs=[c,d];var a=D.layout2(a),x=a.nodeViews,y=a.maxDepth;E(D,x,y);document.getElementById("forward").addEventListener("click",function(){r++;E(D,x,y)},!1);document.getElementById("backward").addEventListener("click",function(){r--;E(D,x,y)},!1)})})();
