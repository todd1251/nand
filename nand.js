(function(){function n(){this.commands=[]}function q(b){this.model=b;this.outlines=[];this.labels=[];this.paths=[]}function m(b,a){this.id=b;this.kind="gate";this.logic=a;this.inputs=[];this.outputs=[]}function k(b,a){this.id=b;this.kind="source";this.value=a;this.outputs=[]}function y(b){this.id=b;this.kind="sink";this.inputs=[]}function r(b){this.id=b;this.kind="delay";this.inputs=[];this.outputs=[]}function t(b){return!b.reduce(function(b,f){return b&&f})}function u(b){this.model=b;this.outline=
this.label=null}function v(b){this.model=b}function x(b){this.model=b}function A(b){this.id=b;this.inputs=[];this.outputs=[]}function z(b,a,f){0>p?p=0:p>=f&&(p=f-1);b.traverse(function(b,h,c){a.map(function(a){var e=a.node,h=a.view;if(e.id==b.id){var l=c>p;switch(e.kind){case "gate":e.inputs.map(function(b,a){h.model.inputs[a]=l?"?":b.evaluate()?"1":"0"});h.model.output=l?"?":e.evaluate()?"1":"0";h.update();break;case "sink":h.model.value=p<f-1?"?":e.evaluate()?"1":"0",h.update()}}})});document.getElementById("time").textContent=
"t = "+p}n.prototype.moveTo=function(b,a){this.commands.push("M"+b+","+a);return this};n.prototype.lineTo=function(b,a){this.commands.push("L"+b+","+a);return this};n.prototype.arc=function(b,a,f,g,h,c,d){this.commands.push("A"+b+","+a+" "+f+" "+g+" "+h+" "+c+","+d);return this};n.prototype.close=function(){this.commands.push("Z");return this};n.prototype.toPath=function(b){return b.path(this.commands.join(" "))};q.prototype.render=function(b){var a=this.model.heavyStrokeWidth,f=this.model.lightStrokeWidth,
g=this.model.width/2,h=this.model.height/2,c=this.model.x-g,d=this.model.y-h,e="?"==this.model.inputs[0];this.paths[0]=(new n).moveTo(c,d).lineTo(c+g,d).arc(1,1,0,0,1,c+g,d+this.model.height).lineTo(c,d+this.model.height).close().toPath(b).attr({fill:"white","stroke-width":this.heavyStrokeWidth*(e?.5:1),"stroke-dasharray":e?"-":""});var k=.05*this.model.width,a=c+g+h+k+a/2,h=d+h;b.circle(a,h,k).attr({fill:"white","stroke-width":this.lightStrokeWidth*(e?.5:1),"stroke-dasharray":e?"-":""});e=.2*this.model.height;
g=.3*this.model.width;this.paths[1]=(new n).moveTo(c,d+e).lineTo(c-g,d+e).toPath(b).attr("stroke-width",f);var l="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=b.circle(c-g,d+e,7.5).attr("fill","white").attr("stroke",l);this.labels[0]=b.text(c-g,d+e,this.model.inputs[0]).attr("stroke",l);this.labels[0].node.setAttribute("class","intermediate");this.paths[2]=(new n).moveTo(c,d+this.model.height-e).lineTo(c-g,d+this.model.height-e).toPath(b).attr("stroke-width",
f);l="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=b.circle(c-g,d+this.model.height-e,7.5).attr("fill","white").attr("stroke",l);this.labels[1]=b.text(c-g,d+this.model.height-e,this.model.inputs[1]).attr("stroke",l);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:a+g,y:h};(new n).moveTo(a+k,h).lineTo(a+g,h).toPath(b).attr("stroke-width",f);null!=this.model.output&&(l="?"==this.model.output?"black":"0"==this.model.output?"#a00":
"#0a0",this.outlines[2]=b.circle(a+g,h,7.5).attr("fill","white").attr("stroke",l),this.labels[2]=b.text(a+g,h,this.model.output).attr("stroke",l),this.labels[2].node.setAttribute("class","intermediate"))};q.prototype.update=function(){var b="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",b);this.outlines[0].attr("stroke",b);b="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.labels[1].attr("text",
this.model.inputs[1]).attr("stroke",b);this.outlines[1].attr("stroke",b);b="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",b);this.outlines[2].attr("stroke",b);b="?"==this.model.inputs[0];this.paths[0].attr("stroke-dasharray",b?"-":"");this.paths[1].attr("stroke-dasharray",b?"-":"");this.paths[2].attr("stroke-dasharray",b?"-":"")};m.prototype.connect=function(b){this.outputs.push(b);b.inputs.push(this)};m.prototype.traverse=
function(b,a,f){b(this,a,f);this.outputs.map(function(g){g.traverse(b,a,f+1)})};m.prototype.evaluate=function(){if(2>this.inputs.length)throw"inputs";var b=[];this.inputs.map(function(a){b.push(a.evaluate())});return this.logic(b)};k.prototype.connect=function(b){this.outputs.push(b);b.inputs.push(this)};k.prototype.traverse=function(b,a,f){b(this,a,f);this.outputs.map(function(g){g.traverse(b,a,f+1)})};k.prototype.evaluate=function(){return this.value};k.prototype.toggle=function(){this.value=!this.value};
y.prototype.connect=function(b){this.inputs.push(b);b.outputs.push(this)};y.prototype.traverse=function(b,a,f){b(this,a,f)};y.prototype.evaluate=function(){return this.inputs[0].evaluate()};r.prototype.connect=function(b){this.outputs.push(b);b.inputs.push(this)};r.prototype.traverse=function(b,a,f){b(this,a,f);this.outputs.map(function(g){g.traverse(b,a,f+1)})};r.prototype.evaluate=function(){return this.inputs[0].evaluate()};u.prototype.render=function(b){var a=this.model.value,f=this.model.x,g=
this.model.y,h="?"==a?"black":"0"==a?"#a00":"#0a0";this.outline=b.rect(f-7,g-7,14,14).attr("stroke",h).attr("fill","white");this.label=b.text(f,g,a).attr("stroke",h).click(this.model.click.bind(this));this.label.node.setAttribute("class","input")};u.prototype.update=function(){var b=this.model.value,a="?"==b?"black":"0"==b?"#a00":"#0a0";this.label.attr("text",b).attr("stroke",a);this.outline.attr("stroke",a)};v.prototype.render=function(b){var a=this.model.value,f=this.model.x,g=this.model.y,h="?"==
a?"black":"0"==a?"#a00":"#0a0";this.outline=b.rect(f-7,g-7,14,14).attr("stroke",h).attr("fill","white");this.label=b.text(f,g,a).attr("stroke",h);this.label.node.setAttribute("class","output")};v.prototype.update=function(){var b=this.model.value,a="?"==b?"black":"0"==b?"#a00":"#0a0";this.label.attr("text",b).attr("stroke",a);this.outline.attr("stroke",a)};x.prototype.render=function(b){};A.prototype.traverse=function(b){this.inputs.map(function(a,f){a.traverse(b,f,0)})};A.prototype.layout=function(b){var a=
[],f=null;this.traverse(function(b,e,c){e>=a.length&&(a[e]=[]);a[e][c]={node:b};if(null==f||c>f)f=c});for(var g=b.width/2-90*(a[0].length-1)/2,h=b.height/2-60*(a.length-1)/2,c=0;c<a.length;c++)for(var d=0;d<a[c].length;d++){var e=a[c][d],k=e.node;e.x=g+90*d;e.y=h+60*c;0<c&&a[c-1][d].node.id==k.id&&(a[c-1][d].skip=!0,null==a[c-1][d].skipCount&&(a[c-1][d].skipCount=1),e.skipCount=a[c-1][d].skipCount+1,e.x=a[c-1][d].x+e.x,e.y=a[c-1][d].y+e.y)}for(c=0;c<a.length;c++)for(d=0;d<a[c].length;d++)e=a[c][d],
null!=e.skipCount&&(e.x/=e.skipCount,e.y/=e.skipCount);for(c=0;c<a.length;c++)for(d=0;d<a[c].length;d++)e=a[c][d],k=e.node,e.skip||null==k.outputs||k.outputs.map(function(c){for(var f=[],d=0;d<a.length;d++)for(var g=0;g<a[d].length;g++){var h=a[d][g];h.node.id!=c.id||h.skip||f.push(h)}if(1!=f.length)throw"outputs";c=f[0];f="gate"==c.node.kind?-48:0;d="gate"==c.node.kind?-5:0;(new n).moveTo(e.x,e.y).lineTo(c.x+f,e.y).lineTo(c.x+f,c.y<e.y?c.y-d:c.y+d).toPath(b)});var l=this,m=[];a.map(function(a){a.map(function(a){if(!a.skip){var c=
a.x,e=a.y,d=a.node;a=null;switch(d.kind){case "source":a=new u({x:c,y:e,value:d.value?"1":"0",click:function(){d.toggle();this.model.value=d.value?"1":"0";this.update();z(l,m,f)}});a.render(b);break;case "sink":a=new v({x:c,y:e,value:d.evaluate()?"1":"0"});a.render(b);break;case "delay":a=new x({x:c,y:e});a.render(b);break;case "gate":a=new q({x:c,y:e,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:[d.inputs[0].evaluate()?"1":"0",d.inputs[1].evaluate()?"1":"0"],output:d.evaluate()?
"1":"0"});a.render(b);break;default:throw"kind";}null!=a&&m.push({node:d,view:a})}})});return{nodeViews:m,maxDepth:f}};var p=0;window.addEventListener("load",function(){var b=new Raphael(0,0,window.innerWidth,window.innerHeight),a=document.getElementById("controls");a.style.left=b.width/2-a.clientWidth/2+"px";a.style.top=b.height/2-a.clientHeight/2-250+"px";var a=0,f=new k(a++,!0),g=new k(a++,!0),h=new k(a++,!0),c=new k(a++,!0),d=new k(a++,!0),e=new k(a++,!0),n=new k(a++,!0),l=new k(a++,!0),q=new m(a++,
t),r=new m(a++,t),u=new m(a++,t),v=new m(a++,t),B=new m(a++,t),C=new m(a++,t),D=new m(a++,t),x=new y(a++);f.connect(q);g.connect(q);h.connect(r);c.connect(r);d.connect(u);e.connect(u);n.connect(v);l.connect(v);q.connect(B);r.connect(B);u.connect(C);v.connect(C);B.connect(D);C.connect(D);D.connect(x);var w=new A(a++);w.inputs=[f,g,h,c,d,e,n,l];w.outputs=[x];var b=w.layout(b),E=b.nodeViews,F=b.maxDepth;z(w,E,F);document.getElementById("forward").addEventListener("click",function(){p++;z(w,E,F)},!1);
document.getElementById("backward").addEventListener("click",function(){p--;z(w,E,F)},!1)})})();
