(function(){function l(){this.commands=[]}function t(a){this.model=a;this.outlines=[];this.labels=[]}function m(a,b){this.id=a;this.kind="gate";this.logic=b;this.inputs=[];this.outputs=[]}function k(a,b){this.id=a;this.kind="source";this.value=b;this.outputs=[]}function q(a){this.id=a;this.kind="sink";this.inputs=[]}function r(a){this.id=a;this.kind="delay";this.inputs=[];this.outputs=[]}function p(a){return!a.reduce(function(a,f){return a&&f})}function u(a){this.model=a;this.outline=this.label=null}
function v(a){this.model=a}function x(a){this.model=a}function w(a){this.id=a;this.inputs=[];this.outputs=[]}l.prototype.moveTo=function(a,b){this.commands.push("M"+a+","+b);return this};l.prototype.lineTo=function(a,b){this.commands.push("L"+a+","+b);return this};l.prototype.arc=function(a,b,f,e,c,d,g){this.commands.push("A"+a+","+b+" "+f+" "+e+" "+c+" "+d+","+g);return this};l.prototype.close=function(){this.commands.push("Z");return this};l.prototype.toPath=function(a){return a.path(this.commands.join(" "))};
t.prototype.render=function(a){var b=this.model.heavyStrokeWidth,f=this.model.lightStrokeWidth,e=this.model.width/2,c=this.model.height/2,d=this.model.x-e,g=this.model.y-c,h="?"==this.model.inputs[0];(new l).moveTo(d,g).lineTo(d+e,g).arc(1,1,0,0,1,d+e,g+this.model.height).lineTo(d,g+this.model.height).close().toPath(a).attr({fill:"white","stroke-width":this.heavyStrokeWidth*(h?.5:1),"stroke-dasharray":h?"-":""});var k=.05*this.model.width,b=d+e+c+k+b/2,c=g+c;a.circle(b,c,k).attr({fill:"white","stroke-width":this.lightStrokeWidth*
(h?.5:1),"stroke-dasharray":h?"-":""});h=.2*this.model.height;e=.3*this.model.width;(new l).moveTo(d,g+h).lineTo(d-e,g+h).toPath(a).attr("stroke-width",f);var n="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=a.circle(d-e,g+h,7.5).attr("fill","white").attr("stroke",n);this.labels[0]=a.text(d-e,g+h,this.model.inputs[0]).attr("stroke",n);this.labels[0].node.setAttribute("class","intermediate");(new l).moveTo(d,g+this.model.height-h).lineTo(d-e,g+this.model.height-
h).toPath(a).attr("stroke-width",f);n="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=a.circle(d-e,g+this.model.height-h,7.5).attr("fill","white").attr("stroke",n);this.labels[1]=a.text(d-e,g+this.model.height-h,this.model.inputs[1]).attr("stroke",n);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:b+e,y:c};(new l).moveTo(b+k,c).lineTo(b+e,c).toPath(a).attr("stroke-width",f);null!=this.model.output&&(n="?"==this.model.output?"black":
"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=a.circle(b+e,c,7.5).attr("fill","white").attr("stroke",n),this.labels[2]=a.text(b+e,c,this.model.output).attr("stroke",n),this.labels[2].node.setAttribute("class","intermediate"))};t.prototype.update=function(){var a="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",a);this.outlines[0].attr("stroke",a);a="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?
"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",a);this.outlines[1].attr("stroke",a);a="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",a);this.outlines[2].attr("stroke",a)};m.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};m.prototype.traverse=function(a,b,f){a(this,b,f);this.outputs.map(function(e){e.traverse(a,b,f+1)})};m.prototype.evaluate=function(){if(2>this.inputs.length)throw"inputs";
var a=[];this.inputs.map(function(b){a.push(b.evaluate())});return this.logic(a)};k.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};k.prototype.traverse=function(a,b,f){a(this,b,f);this.outputs.map(function(e){e.traverse(a,b,f+1)})};k.prototype.evaluate=function(){return this.value};k.prototype.toggle=function(){this.value=!this.value};q.prototype.connect=function(a){this.inputs.push(a);a.outputs.push(this)};q.prototype.traverse=function(a,b,f){a(this,b,f)};q.prototype.evaluate=
function(){return this.inputs[0].evaluate()};r.prototype.connect=function(a){this.outputs.push(a);a.inputs.push(this)};r.prototype.traverse=function(a,b,f){a(this,b,f);this.outputs.map(function(e){e.traverse(a,b,f+1)})};r.prototype.evaluate=function(){return this.inputs[0].evaluate()};u.prototype.render=function(a){var b=this.model.value,f=this.model.x,e=this.model.y,c="?"==b?"black":"0"==b?"#a00":"#0a0";this.outline=a.rect(f-7,e-7,14,14).attr("stroke",c).attr("fill","white");this.label=a.text(f,
e,b).attr("stroke",c).click(this.model.click.bind(this));this.label.node.setAttribute("class","input")};u.prototype.update=function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.label.attr("text",a).attr("stroke",b);this.outline.attr("stroke",b)};v.prototype.render=function(a){var b=this.model.value,f=this.model.x,e=this.model.y,c="?"==b?"black":"0"==b?"#a00":"#0a0";this.outline=a.rect(f-7,e-7,14,14).attr("stroke",c).attr("fill","white");this.label=a.text(f,e,b).attr("stroke",
c);this.label.node.setAttribute("class","output")};v.prototype.update=function(){var a=this.model.value,b="?"==a?"black":"0"==a?"#a00":"#0a0";this.label.attr("text",a).attr("stroke",b);this.outline.attr("stroke",b)};x.prototype.render=function(a){};w.prototype.traverse=function(a){this.inputs.map(function(b,f){b.traverse(a,f,0)})};w.prototype.layout=function(a){var b=[];this.traverse(function(a,c,e){c>=b.length&&(b[c]=[]);b[c][e]={node:a}});for(var f=a.width/2-90*(b[0].length-1)/2,e=a.height/2-60*
(b.length-1)/2,c=0;c<b.length;c++)for(var d=0;d<b[c].length;d++){var g=b[c][d],h=g.node;g.x=f+90*d;g.y=e+60*c;0<c&&b[c-1][d].node.id==h.id&&(b[c-1][d].skip=!0,g.x=(b[c-1][d].x+g.x)/2,g.y=(b[c-1][d].y+g.y)/2)}for(c=0;c<b.length;c++)for(d=0;d<b[c].length;d++)g=b[c][d],h=g.node,g.skip||null==h.outputs||h.outputs.map(function(c){for(var e=[],d=0;d<b.length;d++)for(var f=0;f<b[d].length;f++){var h=b[d][f];h.node.id!=c.id||h.skip||e.push(h)}if(1!=e.length)throw"outputs";c=e[0];(new l).moveTo(g.x,g.y).lineTo(c.x,
c.y).toPath(a)});var k=[];b.map(function(b){b.map(function(b){if(!b.skip){var c=b.x,e=b.y,d=b.node;b=null;switch(d.kind){case "source":b=new u({x:c,y:e,value:d.value?"1":"0",click:function(){d.toggle();this.model.value=d.value?"1":"0";this.update();d.traverse(function(a){k.map(function(a){var b=a.node,c=a.view;switch(b.kind){case "gate":b.inputs.map(function(a,b){c.model.inputs[b]=a.evaluate()?"1":"0"});c.model.output=b.evaluate()?"1":"0";c.update();break;case "sink":c.model.value=b.evaluate()?"1":
"0",c.update()}})})}});b.render(a);break;case "sink":b=new v({x:c,y:e,value:d.evaluate()?"1":"0"});b.render(a);break;case "delay":b=new x({x:c,y:e});b.render(a);break;case "gate":b=new t({x:c,y:e,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:[d.inputs[0].evaluate()?"1":"0",d.inputs[1].evaluate()?"1":"0"],output:d.evaluate()?"1":"0"});b.render(a);break;default:a.rect(c,e,14,14),a.text(c+7,e+7,d.id)}null!=b&&k.push({node:d,view:b})}})})};window.addEventListener("load",function(){var a=
new Raphael(0,0,window.innerWidth,window.innerHeight),b=0,f=new k(b++,!0),e=new k(b++,!0),c=new k(b++,!0);new k(b++,!0);new k(b++,!0);new k(b++,!0);var d=new m(b++,p),g=new m(b++,p);new m(b++,p);new m(b++,p);new m(b++,p);new m(b++,p);var h=new q(b++),l=new r(b++);f.connect(d);e.connect(d);d.connect(g);g.connect(h);c.connect(l);l.connect(g);b=new w(b++);b.inputs=[f,e,c];b.outputs=[h];b.layout(a)})})();
