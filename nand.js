(function(){function l(){this.commands=[]}function t(b){this.model=b;this.outlines=[];this.labels=[]}function m(b,a){this.id=b;this.kind="gate";this.logic=a;this.inputs=[];this.outputs=[]}function k(b,a){this.id=b;this.kind="source";this.value=a;this.outputs=[]}function q(b){this.id=b;this.kind="sink";this.inputs=[]}function r(b){this.id=b;this.kind="delay";this.inputs=[];this.outputs=[]}function p(b){return!b.reduce(function(b,f){return b&&f})}function u(b){this.model=b;this.outline=this.label=null}
function v(b){this.model=b}function x(b){this.model=b}function w(b){this.id=b;this.inputs=[];this.outputs=[]}l.prototype.moveTo=function(b,a){this.commands.push("M"+b+","+a);return this};l.prototype.lineTo=function(b,a){this.commands.push("L"+b+","+a);return this};l.prototype.arc=function(b,a,f,e,c,d,g){this.commands.push("A"+b+","+a+" "+f+" "+e+" "+c+" "+d+","+g);return this};l.prototype.close=function(){this.commands.push("Z");return this};l.prototype.toPath=function(b){return b.path(this.commands.join(" "))};
t.prototype.render=function(b){var a=this.model.heavyStrokeWidth,f=this.model.lightStrokeWidth,e=this.model.width/2,c=this.model.height/2,d=this.model.x-e,g=this.model.y-c,h="?"==this.model.inputs[0];(new l).moveTo(d,g).lineTo(d+e,g).arc(1,1,0,0,1,d+e,g+this.model.height).lineTo(d,g+this.model.height).close().toPath(b).attr({fill:"white","stroke-width":this.heavyStrokeWidth*(h?.5:1),"stroke-dasharray":h?"-":""});var k=.05*this.model.width,a=d+e+c+k+a/2,c=g+c;b.circle(a,c,k).attr({fill:"white","stroke-width":this.lightStrokeWidth*
(h?.5:1),"stroke-dasharray":h?"-":""});h=.2*this.model.height;e=.3*this.model.width;(new l).moveTo(d,g+h).lineTo(d-e,g+h).toPath(b).attr("stroke-width",f);var n="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.outlines[0]=b.circle(d-e,g+h,7.5).attr("fill","white").attr("stroke",n);this.labels[0]=b.text(d-e,g+h,this.model.inputs[0]).attr("stroke",n);this.labels[0].node.setAttribute("class","intermediate");(new l).moveTo(d,g+this.model.height-h).lineTo(d-e,g+this.model.height-
h).toPath(b).attr("stroke-width",f);n="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?"#a00":"#0a0";this.outlines[1]=b.circle(d-e,g+this.model.height-h,7.5).attr("fill","white").attr("stroke",n);this.labels[1]=b.text(d-e,g+this.model.height-h,this.model.inputs[1]).attr("stroke",n);this.labels[1].node.setAttribute("class","intermediate");this.outputWire={x:a+e,y:c};(new l).moveTo(a+k,c).lineTo(a+e,c).toPath(b).attr("stroke-width",f);null!=this.model.output&&(n="?"==this.model.output?"black":
"0"==this.model.output?"#a00":"#0a0",this.outlines[2]=b.circle(a+e,c,7.5).attr("fill","white").attr("stroke",n),this.labels[2]=b.text(a+e,c,this.model.output).attr("stroke",n),this.labels[2].node.setAttribute("class","intermediate"))};t.prototype.update=function(){var b="?"==this.model.inputs[0]?"black":"0"==this.model.inputs[0]?"#a00":"#0a0";this.labels[0].attr("text",this.model.inputs[0]).attr("stroke",b);this.outlines[0].attr("stroke",b);b="?"==this.model.inputs[1]?"black":"0"==this.model.inputs[1]?
"#a00":"#0a0";this.labels[1].attr("text",this.model.inputs[1]).attr("stroke",b);this.outlines[1].attr("stroke",b);b="?"==this.model.output?"black":"0"==this.model.output?"#a00":"#0a0";this.labels[2].attr("text",this.model.output).attr("stroke",b);this.outlines[2].attr("stroke",b)};m.prototype.connect=function(b){this.outputs.push(b);b.inputs.push(this)};m.prototype.traverse=function(b,a,f){b(this,a,f);this.outputs.map(function(e){e.traverse(b,a,f+1)})};m.prototype.evaluate=function(){if(2>this.inputs.length)throw"inputs";
var b=[];this.inputs.map(function(a){b.push(a.evaluate())});return this.logic(b)};k.prototype.connect=function(b){this.outputs.push(b);b.inputs.push(this)};k.prototype.traverse=function(b,a,f){b(this,a,f);this.outputs.map(function(e){e.traverse(b,a,f+1)})};k.prototype.evaluate=function(){return this.value};k.prototype.toggle=function(){this.value=!this.value};q.prototype.connect=function(b){this.inputs.push(b);b.outputs.push(this)};q.prototype.traverse=function(b,a,f){b(this,a,f)};q.prototype.evaluate=
function(){return this.inputs[0].evaluate()};r.prototype.connect=function(b){this.outputs.push(b);b.inputs.push(this)};r.prototype.traverse=function(b,a,f){b(this,a,f);this.outputs.map(function(e){e.traverse(b,a,f+1)})};r.prototype.evaluate=function(){return this.inputs[0].evaluate()};u.prototype.render=function(b){var a=this.model.value,f=this.model.x,e=this.model.y,c="?"==a?"black":"0"==a?"#a00":"#0a0";this.outline=b.rect(f-7,e-7,14,14).attr("stroke",c).attr("fill","white");this.label=b.text(f,
e,a).attr("stroke",c).click(this.model.click.bind(this));this.label.node.setAttribute("class","input")};u.prototype.update=function(){var b=this.model.value,a="?"==b?"black":"0"==b?"#a00":"#0a0";this.label.attr("text",b).attr("stroke",a);this.outline.attr("stroke",a)};v.prototype.render=function(b){var a=this.model.value,f=this.model.x,e=this.model.y,c="?"==a?"black":"0"==a?"#a00":"#0a0";this.outline=b.rect(f-7,e-7,14,14).attr("stroke",c).attr("fill","white");this.label=b.text(f,e,a).attr("stroke",
c);this.label.node.setAttribute("class","output")};v.prototype.update=function(){var b=this.model.value,a="?"==b?"black":"0"==b?"#a00":"#0a0";this.label.attr("text",b).attr("stroke",a);this.outline.attr("stroke",a)};x.prototype.render=function(b){};w.prototype.traverse=function(b){this.inputs.map(function(a,f){a.traverse(b,f,0)})};w.prototype.layout=function(b){var a=[];this.traverse(function(b,c,e){c>=a.length&&(a[c]=[]);a[c][e]={node:b}});for(var f=b.width/2-90*(a[0].length-1)/2,e=b.height/2-60*
(a.length-1)/2,c=0;c<a.length;c++)for(var d=0;d<a[c].length;d++){var g=a[c][d],h=g.node;g.x=f+90*d;g.y=e+60*c;0<c&&a[c-1][d].node.id==h.id&&(a[c-1][d].skip=!0,g.x=(a[c-1][d].x+g.x)/2,g.y=(a[c-1][d].y+g.y)/2)}for(c=0;c<a.length;c++)for(d=0;d<a[c].length;d++)g=a[c][d],h=g.node,g.skip||null==h.outputs||h.outputs.map(function(c){for(var e=[],d=0;d<a.length;d++)for(var f=0;f<a[d].length;f++){var h=a[d][f];h.node.id!=c.id||h.skip||e.push(h)}if(1!=e.length)throw"outputs";c=e[0];e="gate"==c.node.kind?-48:
0;d="gate"==c.node.kind?-5:0;(new l).moveTo(g.x,g.y).lineTo(c.x+e,g.y).lineTo(c.x+e,c.y<g.y?c.y-d:c.y+d).toPath(b)});var k=[];a.map(function(a){a.map(function(a){if(!a.skip){var c=a.x,e=a.y,d=a.node;a=null;switch(d.kind){case "source":a=new u({x:c,y:e,value:d.value?"1":"0",click:function(){d.toggle();this.model.value=d.value?"1":"0";this.update();d.traverse(function(b){k.map(function(b){var a=b.node,c=b.view;switch(a.kind){case "gate":a.inputs.map(function(a,b){c.model.inputs[b]=a.evaluate()?"1":
"0"});c.model.output=a.evaluate()?"1":"0";c.update();break;case "sink":c.model.value=a.evaluate()?"1":"0",c.update()}})})}});a.render(b);break;case "sink":a=new v({x:c,y:e,value:d.evaluate()?"1":"0"});a.render(b);break;case "delay":a=new x({x:c,y:e});a.render(b);break;case "gate":a=new t({x:c,y:e,width:60,height:40,heavyStrokeWidth:2,lightStrokeWidth:1.25,inputs:[d.inputs[0].evaluate()?"1":"0",d.inputs[1].evaluate()?"1":"0"],output:d.evaluate()?"1":"0"});a.render(b);break;default:throw"kind";}null!=
a&&k.push({node:d,view:a})}})})};window.addEventListener("load",function(){var b=new Raphael(0,0,window.innerWidth,window.innerHeight),a=0,f=new k(a++,!0),e=new k(a++,!0),c=new k(a++,!0);new k(a++,!0);new k(a++,!0);new k(a++,!0);var d=new m(a++,p),g=new m(a++,p);new m(a++,p);new m(a++,p);new m(a++,p);new m(a++,p);var h=new q(a++),l=new r(a++);f.connect(d);e.connect(d);d.connect(g);g.connect(h);c.connect(l);l.connect(g);a=new w(a++);a.inputs=[f,e,c];a.outputs=[h];a.layout(b)})})();
