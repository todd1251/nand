function AndView(b,d,a){var c=a.createPath();c.moveTo({x:0,y:0});c.lineTo({x:d.wideSegmentWidth,y:0});var e={x:d.gateWidth,y:d.halfHeight};c.arcTo({x:d.wideSegmentWidth+1,y:0},e);c=b.decorate(c,d,a);e.x=c.bounds.width;c.arcTo({x:d.wideSegmentWidth+1,y:d.height},{x:d.wideSegmentWidth,y:d.height});c.lineTo({x:0,y:d.height});c.closePath();c.alignmentCentre={x:d.gateWidth/2,y:d.halfHeight};b=d.height/4;c.inputs=[{x:0,y:b},{x:0,y:d.height-b}];c.outputs=[e];return c};function AppearanceProportionalToDimensions(b,d){d=d||{};this.stroke={width:d.strokeWidth||b.width/25,colour:d.strokeColour||"black"};this.wireStrokeWidth=.5*this.stroke.width;this.fill={colour:d.fillColour||"white"}}AppearanceProportionalToDimensions.prototype.createPath=function(){return new paper.Path({strokeWidth:this.stroke.width,strokeColor:this.stroke.colour,fillColor:this.fill.colour})};function BufferView(b,d,a){var c=a.createPath();c.moveTo({x:0,y:0});var e={x:d.wideSegmentWidth-a.stroke.width,y:d.halfHeight};c.lineTo(e);c=b.decorate(c,d,a);e.x=c.bounds.width;c.lineTo({x:0,y:d.height});c.closePath();c.alignmentCentre={x:d.wideSegmentWidth/2,y:d.halfHeight};c.inputs=[{x:0,y:d.halfHeight}];c.outputs=[e];return c};function CircuitView(b,d,a){b=b.map(function(b){return new b(d,a)});for(var c=0;c<b.length;c++){var e=b[c];console.log(e.bounds);if(0==c)e.position={x:0,y:0};else{var f=b[c-1];e.position={x:f.position.x+f.outputs[0].x-f.inputs[0].x,y:f.position.y+f.outputs[0].y-e.inputs[0].y}}}c=new paper.Group(b);e=b[0];b=b[b.length-1];c.inputs=[{x:e.position.x,y:e.position.y+e.inputs[0].y}];c.outputs=[{x:b.position.x+b.outputs[0].x-b.inputs[0].x,y:b.position.y+b.outputs[0].y}];return c};function DimensionsProportionalToWidth(b){this.width=b=b||100;this.wireWidth=b/5;this.gateWidth=b-2*this.wireWidth;this.height=4*this.gateWidth/5;this.halfHeight=this.height/2;this.wideSegmentWidth=3*this.gateWidth/5;this.narrowSegmentWidth=2*this.gateWidth/5;this.inverterRadius=this.gateWidth/12};function dragToCopy(b,d,a,c){function e(b){g=null}var f,g,h;b.onMouseDown=function(e){f=b.position;g=e.point;h=d(a,c);h.position={x:f.x,y:f.y};dragToMove(h,c)};b.onMouseDrag=function(b){var a=b.point;h.position={x:f.x+a.x-g.x,y:f.y+a.y-g.y};b.stopPropagation()};b.onMouseUp=e;b.onMouseOut=e};var wires=[];
function redrawWires(b){wires.map(function(d){var a=d.from,c=d.to,e=d.input;null!=d.path&&d.path.remove();var f=b.createPath();f.strokeWidth=b.wireStrokeWidth;f.fillColor=null;a={x:a.position.x-a.bounds.width/2+a.outputs[0].x-a.inputs[0].x,y:a.position.y-a.bounds.height/2+a.outputs[0].y};c={x:c.position.x-c.bounds.width/2,y:c.position.y-c.bounds.height/2+c.inputs[e].y};e=c.x-a.x;f.moveTo({x:a.x,y:a.y});f.lineTo({x:a.x+e/2,y:a.y});f.lineTo({x:a.x+e/2,y:c.y});f.lineTo({x:c.x,y:c.y});d.path=f})}
function dragToMove(b,d){function a(a){e=null;if(f&&(a=paper.project.hitTest(a.point),null!=a)){var c=a.item.input;null==c?c=0:c++;a.item.input=c;wires.push({from:b,to:a.item,input:c})}redrawWires(d)}var c,e,f;b.onMouseDown=function(a){c=b.position;e=a.point;f=a.event.metaKey?!0:!1};b.onMouseDrag=function(a){var h=a.point;f||(b.position={x:c.x+h.x-e.x,y:c.y+h.y-e.y});redrawWires(d);a.stopPropagation()};b.onMouseUp=a;b.onMouseOut=a};function dragToPan(){function b(a){d=null}var d;paper.view.onMouseDown=function(a){d=a.point};paper.view.onMouseDrag=function(a){a=a.point;paper.view.center=new paper.Point({x:paper.view.center.x-(a.x-d.x),y:paper.view.center.y-(a.y-d.y)})};paper.view.onMouseUp=b;paper.view.onMouseOut=b};function GateView(b,d,a){b=new b(d,a);var c=d.width/2-b.alignmentCentre.x+b.inputs[0].x/2,e=[];e.push(b);d=[{x:d.width-c+b.inputs[0].x,y:b.outputs[0].y}];for(var f=new paper.Path.Line({from:b.outputs[0],to:d[0],strokeWidth:a.wireStrokeWidth,strokeColor:a.stroke.colour}),g=[],h=0;h<b.inputs.length;h++){var k=b.inputs[h];g[h]={x:k.x-c,y:k.y};e.push(new paper.Path.Line({from:g[h],to:{x:k.x,y:k.y},strokeWidth:a.wireStrokeWidth,strokeColor:a.stroke.colour}))}e.push(f);b=new paper.Group(e);b.inputs=g;b.outputs=
d;return b};function clamp(b,d,a){return Math.min(Math.max(b,d),a)};function render(){function b(a){return GateView.bind(null,a)}function d(){}function a(){}paper.project.activeLayer.removeChildren();d.prototype.decorate=function(a,b,c){b=2*b.inverterRadius;a.arcBy({x:b,y:0},!1);a.arcBy({x:-b,y:0},!0);a.arcBy({x:b,y:0},!0);a.arcBy({x:-b,y:0},!1);return a};a.prototype.decorate=function(a,b,c){return a};b(BufferView.bind(null,new a));b(BufferView.bind(null,new d));b(AndView.bind(null,new a));b(AndView.bind(null,new d));new paper.Path.Rectangle({point:[0,0],size:[paper.view.bounds.width,
paper.view.bounds.height],strokeColor:"#ccc"});var c=50;[b(BufferView.bind(null,new a)),b(BufferView.bind(null,new d)),b(AndView.bind(null,new a)),b(AndView.bind(null,new d)),b(OrView.bind(null,new a,new a)),b(OrView.bind(null,new a,new d)),b(OrView.bind(null,new XorDecoration,new a)),b(OrView.bind(null,new XorDecoration,new d))].map(function(a){var b=new DimensionsProportionalToWidth(50),d=new AppearanceProportionalToDimensions(b),h=new AppearanceProportionalToDimensions(b);h.stroke.colour="#ccc";
h=new a(b,h);h.position={x:c,y:50};c+=h.bounds.width;dragToCopy(h,a,b,d)})}window.addEventListener("load",function(){var b=document.getElementById("paper");paper.setup(b);paper.view.onFrame=function(b){paper.view.draw()};paper.view.onResize=function(b){render()};render();dragToPan();stableScrollToZoom(b)});function OrView(b,d,a,c){var e=a.gateWidth/7,f=c.createPath();f.moveTo({x:c.stroke.width/2,y:0});f.lineTo({x:a.narrowSegmentWidth,y:0});var g={x:a.gateWidth,y:a.halfHeight};f.arcTo({x:a.narrowSegmentWidth+a.wideSegmentWidth/2,y:a.halfHeight/4},g);f=d.decorate(f,a,c);g.x=f.bounds.width;f.arcTo({x:a.narrowSegmentWidth+a.wideSegmentWidth/2,y:a.height-a.halfHeight/4},{x:a.narrowSegmentWidth,y:a.height});f.lineTo({x:c.stroke.width/2,y:a.height});f.arcTo({x:e,y:a.halfHeight},{x:c.stroke.width/2,y:0});f.closePath();
f=b.decorate(f,a,c);f.alignmentCentre={x:a.gateWidth/2-e/2,y:a.halfHeight};b=a.height/4;f.inputs=[{x:e,y:b},{x:e,y:a.height-b}];f.outputs=[g];return f};function stableScrollToZoom(b){var d=0;b.addEventListener("mousewheel",function(a){var b=d+a.wheelDelta,e=clamp(Math.pow(1.001,b),.25,100),f=paper.view.zoom;if(e!=f){var g=f/e,h=paper.view.viewToProject({x:a.offsetX,y:a.offsetY}),f=paper.view.center,k=h.subtract(f),g=h.subtract(k.multiply(g)).subtract(f);paper.view.center=f.add(g);d=b;paper.view.zoom=e}a.preventDefault();return!1})};function XorDecoration(){}XorDecoration.prototype.decorate=function(b,d,a){var c=d.gateWidth/7,e=a.createPath(),f=2*a.stroke.width,g=1.2*(a.stroke.width/2-f),c=c-f;a=a.stroke.width/10;e.moveTo({x:g+a,y:0});e.lineTo({x:g,y:0});e.arcTo({x:c,y:d.halfHeight},{x:g,y:d.height});e.lineTo({x:g+a,y:d.height});e.arcTo({x:c,y:d.halfHeight},{x:g,y:0});e.lineTo({x:g+a,y:0});e.arcTo({x:c,y:d.halfHeight},{x:g,y:d.height});return new paper.Group([b,e])};
