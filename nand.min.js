function AndView(a,b,d){var c=d.createPath();c.moveTo({x:0,y:0});c.lineTo({x:b.wideSegmentWidth,y:0});var e={x:b.gateWidth,y:b.halfHeight};c.arcTo({x:b.wideSegmentWidth+1,y:0},e);c=a.decorate(c,b,d);e.x=c.bounds.width;c.arcTo({x:b.wideSegmentWidth+1,y:b.height},{x:b.wideSegmentWidth,y:b.height});c.lineTo({x:0,y:b.height});c.closePath();c.alignmentCentre={x:b.gateWidth/2,y:b.halfHeight};a=b.height/4;c.inputs=[{x:0,y:a},{x:0,y:b.height-a}];c.outputs=[e];return c};function AppearanceProportionalToDimensions(a,b){b=b||{};this.stroke={width:b.strokeWidth||a.width/25,colour:b.strokeColour||"black"};this.wireStrokeWidth=.5*this.stroke.width;this.fill={colour:b.fillColour||"white"}}AppearanceProportionalToDimensions.prototype.createPath=function(){return new paper.Path({strokeWidth:this.stroke.width,strokeColor:this.stroke.colour,fillColor:this.fill.colour})};function BufferView(a,b,d){var c=d.createPath();c.moveTo({x:0,y:0});var e={x:b.wideSegmentWidth-d.stroke.width,y:b.halfHeight};c.lineTo(e);c=a.decorate(c,b,d);e.x=c.bounds.width;c.lineTo({x:0,y:b.height});c.closePath();c.alignmentCentre={x:b.wideSegmentWidth/2,y:b.halfHeight};c.inputs=[{x:0,y:b.halfHeight}];c.outputs=[e];return c};function CircuitView(a,b,d){a=a.map(function(a){return new a(b,d)});for(var c=0;c<a.length;c++){var e=a[c];console.log(e.bounds);if(0==c)e.position={x:0,y:0};else{var f=a[c-1];e.position={x:f.position.x+f.outputs[0].x-f.inputs[0].x,y:f.position.y+f.outputs[0].y-e.inputs[0].y}}}c=new paper.Group(a);e=a[0];a=a[a.length-1];c.inputs=[{x:e.position.x,y:e.position.y+e.inputs[0].y}];c.outputs=[{x:a.position.x+a.outputs[0].x-a.inputs[0].x,y:a.position.y+a.outputs[0].y}];return c};function DimensionsProportionalToWidth(a){this.width=a=a||100;this.wireWidth=a/5;this.gateWidth=a-2*this.wireWidth;this.height=4*this.gateWidth/5;this.halfHeight=this.height/2;this.wideSegmentWidth=3*this.gateWidth/5;this.narrowSegmentWidth=2*this.gateWidth/5;this.inverterRadius=this.gateWidth/12};function dragToMove(a){function b(a){c=null}var d,c;a.onMouseDown=function(b){d=a.position;c=b.point};a.onMouseDrag=function(b){var f=b.point;a.position={x:d.x+f.x-c.x,y:d.y+f.y-c.y};b.stopPropagation()};a.onMouseUp=b;a.onMouseOut=b};function dragToPan(){function a(a){b=null}var b;paper.view.onMouseDown=function(a){b=a.point};paper.view.onMouseDrag=function(a){a=a.point;paper.view.center=new paper.Point({x:paper.view.center.x-(a.x-b.x),y:paper.view.center.y-(a.y-b.y)})};paper.view.onMouseUp=a;paper.view.onMouseOut=a};function GateView(a,b,d){a=new a(b,d);var c=b.width/2-a.alignmentCentre.x+a.inputs[0].x/2,e=[];e.push(a);b=[{x:b.width-c+a.inputs[0].x,y:a.outputs[0].y}];for(var f=new paper.Path.Line({from:a.outputs[0],to:b[0],strokeWidth:d.wireStrokeWidth,strokeColor:d.stroke.colour}),g=[],h=0;h<a.inputs.length;h++){var k=a.inputs[h];g[h]={x:k.x-c,y:k.y};e.push(new paper.Path.Line({from:g[h],to:{x:k.x,y:k.y},strokeWidth:d.wireStrokeWidth,strokeColor:d.stroke.colour}))}e.push(f);a=new paper.Group(e);a.inputs=g;a.outputs=
b;return a};function clamp(a,b,d){return Math.min(Math.max(a,b),d)};function render(){function a(a){return GateView.bind(null,a)}function b(){}function d(){}paper.project.activeLayer.removeChildren();b.prototype.decorate=function(a,b,c){b=2*b.inverterRadius;a.arcBy({x:b,y:0},!1);a.arcBy({x:-b,y:0},!0);a.arcBy({x:b,y:0},!0);a.arcBy({x:-b,y:0},!1);return a};d.prototype.decorate=function(a,b,c){return a};var c=a(BufferView.bind(null,new d));a(BufferView.bind(null,new b));a(AndView.bind(null,new d));a(AndView.bind(null,new b));new paper.Path.Rectangle({point:[0,0],size:[paper.view.bounds.width,
paper.view.bounds.height],strokeColor:"#ccc"});var e=new DimensionsProportionalToWidth,f=new AppearanceProportionalToDimensions(e),a=c(e,f);a.position={x:100,y:100};dragToMove(a)}window.addEventListener("load",function(){var a=document.getElementById("paper");paper.setup(a);paper.view.onFrame=function(a){paper.view.draw()};paper.view.onResize=function(a){render()};render();dragToPan();stableScrollToZoom(a)});function OrView(a,b,d,c){var e=d.gateWidth/7,f=c.createPath();f.moveTo({x:c.stroke.width/2,y:0});f.lineTo({x:d.narrowSegmentWidth,y:0});var g={x:d.gateWidth,y:d.halfHeight};f.arcTo({x:d.narrowSegmentWidth+d.wideSegmentWidth/2,y:d.halfHeight/4},g);f=b.decorate(f,d,c);g.x=f.bounds.width;f.arcTo({x:d.narrowSegmentWidth+d.wideSegmentWidth/2,y:d.height-d.halfHeight/4},{x:d.narrowSegmentWidth,y:d.height});f.lineTo({x:c.stroke.width/2,y:d.height});f.arcTo({x:e,y:d.halfHeight},{x:c.stroke.width/2,y:0});f.closePath();
f=a.decorate(f,d,c);f.alignmentCentre={x:d.gateWidth/2-e/2,y:d.halfHeight};a=d.height/4;f.inputs=[{x:e,y:a},{x:e,y:d.height-a}];f.outputs=[g];return f};function stableScrollToZoom(a){var b=0;a.addEventListener("mousewheel",function(a){var c=b+a.wheelDelta,e=clamp(Math.pow(1.001,c),.01,100),f=paper.view.zoom;if(e!=f){var g=f/e,h=paper.view.viewToProject({x:a.offsetX,y:a.offsetY}),f=paper.view.center,k=h.subtract(f),g=h.subtract(k.multiply(g)).subtract(f);paper.view.center=f.add(g);b=c;paper.view.zoom=e}a.preventDefault();return!1})};function XorDecoration(){}XorDecoration.prototype.decorate=function(a,b,d){var c=b.gateWidth/7,e=d.createPath(),f=2*d.stroke.width,g=1.2*(d.stroke.width/2-f),c=c-f;d=d.stroke.width/10;e.moveTo({x:g+d,y:0});e.lineTo({x:g,y:0});e.arcTo({x:c,y:b.halfHeight},{x:g,y:b.height});e.lineTo({x:g+d,y:b.height});e.arcTo({x:c,y:b.halfHeight},{x:g,y:0});e.lineTo({x:g+d,y:0});e.arcTo({x:c,y:b.halfHeight},{x:g,y:b.height});return new paper.Group([a,e])};
